{"parents": [], "prev": {"link": "../docker/", "title": "Docker Runtime Env"}, "next": {"link": "../security-and-authentication/", "title": "Security and Authentication"}, "title": "Manual Setup and Troubleshooting", "meta": {}, "body": "<section id=\"manual-setup-and-troubleshooting\">\n<h1>Manual Setup and Troubleshooting<a class=\"headerlink\" href=\"#manual-setup-and-troubleshooting\" title=\"Permalink to this heading\">\u00b6</a></h1>\n<p>Below we document steps for manually setting up SSH tunnel and syncing files/packages,\nas well as some commonly encountered errors and solutions. Please create an issue on\n<a class=\"reference external\" href=\"https://github.com/run-house/runhouse/issues\">Github</a> or message us on\n<a class=\"reference external\" href=\"https://discord.gg/RnhB6589Hs\">Discord</a> for more support.</p>\n<section id=\"manual-ssh-tunneling\">\n<h2>Manual SSH Tunneling<a class=\"headerlink\" href=\"#manual-ssh-tunneling\" title=\"Permalink to this heading\">\u00b6</a></h2>\n<p>If you are having trouble forming successful SSH connections with the Runhouse pip package,\nwant more control over SSH tunneling, or want to use latest unreleased features from main,\nyou may perform the following manual setup steps.</p>\n<ol class=\"arabic\">\n<li><p>Install Runhouse on your local box with:</p>\n<div class=\"highlight-shell notranslate\"><div class=\"highlight\"><pre><span></span>pip<span class=\"w\"> </span>install<span class=\"w\"> </span>runhouse<span class=\"w\">  </span><span class=\"c1\"># latest</span>\n<span class=\"c1\"># or</span>\npip<span class=\"w\"> </span>install<span class=\"w\"> </span>git+https://github.com/run-house/runhouse.git<span class=\"w\">  </span><span class=\"c1\"># main branch</span>\n</pre></div>\n</div>\n</li>\n<li><p>SSH into your server with a tunnel. You can use a different local or remote port here as well;\nsteps 5 and 6 contain additional info for setting up your port.</p>\n<div class=\"highlight-shell notranslate\"><div class=\"highlight\"><pre><span></span>ssh<span class=\"w\"> </span>user@host<span class=\"w\"> </span>-L<span class=\"w\"> </span><span class=\"m\">32300</span>:localhost:32300\n</pre></div>\n</div>\n</li>\n<li><p>Install Runhouse on the remote box using the same command as in step 1:</p>\n<div class=\"highlight-shell notranslate\"><div class=\"highlight\"><pre><span></span>pip<span class=\"w\"> </span>install<span class=\"w\"> </span>runhouse<span class=\"w\">  </span><span class=\"c1\"># latest</span>\n<span class=\"c1\"># or</span>\npip<span class=\"w\"> </span>install<span class=\"w\"> </span>git+https://github.com/run-house/runhouse.git<span class=\"w\">  </span><span class=\"c1\"># main branch</span>\n</pre></div>\n</div>\n</li>\n<li><p>Start Ray on the remote box:</p>\n<div class=\"highlight-shell notranslate\"><div class=\"highlight\"><pre><span></span>ray<span class=\"w\"> </span>start<span class=\"w\"> </span>--head\n</pre></div>\n</div>\n<ul class=\"simple\">\n<li><p>If you receive an error <code class=\"docutils literal notranslate\"><span class=\"pre\">\u201cWARNING:</span> <span class=\"pre\">The</span> <span class=\"pre\">scripts</span> <span class=\"pre\">ray,</span> <span class=\"pre\">rllib,</span> <span class=\"pre\">serve</span> <span class=\"pre\">and</span> <span class=\"pre\">tune</span> <span class=\"pre\">are</span> <span class=\"pre\">installed</span>\n<span class=\"pre\">in</span> <span class=\"pre\">'/home/user/.local/bin'</span> <span class=\"pre\">which</span> <span class=\"pre\">is</span> <span class=\"pre\">not</span> <span class=\"pre\">on</span> <span class=\"pre\">PATH.\u201d</span></code>, you may need to add the destination of the installed packages\nto the path, e.g. <code class=\"docutils literal notranslate\"><span class=\"pre\">PATH=$PATH:/home/user/.local/bin</span></code>.</p></li>\n</ul>\n</li>\n<li><p>Start the Runhouse server on the remote box:</p>\n<div class=\"highlight-shell notranslate\"><div class=\"highlight\"><pre><span></span>runhouse<span class=\"w\"> </span>start\n</pre></div>\n</div>\n<p>If you previously already had a version of Runhouse installed and started, you will need to run:</p>\n<div class=\"highlight-shell notranslate\"><div class=\"highlight\"><pre><span></span>runhouse<span class=\"w\"> </span>restart\n</pre></div>\n</div>\n<ul class=\"simple\">\n<li><p>To exit out of the process and run it in the background instead, you can do <code class=\"docutils literal notranslate\"><span class=\"pre\">Ctrl+C</span></code> and then <code class=\"docutils literal notranslate\"><span class=\"pre\">runhouse</span> <span class=\"pre\">start</span> <span class=\"pre\">--screen</span></code>.\nPlease first make sure regular <code class=\"docutils literal notranslate\"><span class=\"pre\">runhouse</span> <span class=\"pre\">start</span></code> does not error out prior to testing it out in a screen.</p></li>\n<li><p>If you previously specified a custom port in step 2, add <code class=\"docutils literal notranslate\"><span class=\"pre\">--port</span> <span class=\"pre\">&lt;my_port&gt;</span></code> to the runhouse start command.</p></li>\n</ul>\n</li>\n<li><p>Initialize the Runhouse cluster in Python as follows. Make sure to use <code class=\"docutils literal notranslate\"><span class=\"pre\">localhost</span></code> as the cluster address rather than the true IP,\nas you manually created the tunnel above.</p>\n<div class=\"highlight-ipython3 notranslate\"><div class=\"highlight\"><pre><span></span>gpu = rh.cluster(name=&#39;rh-a10x&#39;, host=[&quot;localhost&quot;], ssh_creds={&quot;ssh_user&quot;: &quot;user&quot;})\n</pre></div>\n</div>\n<ul class=\"simple\">\n<li><p>To specify another port, you can pass in <code class=\"docutils literal notranslate\"><span class=\"pre\">host=[&quot;localhost:&lt;my_port&gt;&quot;]</span></code></p></li>\n<li><p>If your remote box already has a port open to http traffic, you can directly use it instead of forming a new tunnel.\nPass in <code class=\"docutils literal notranslate\"><span class=\"pre\">host=[&quot;&lt;my</span> <span class=\"pre\">ip&gt;:&lt;my</span> <span class=\"pre\">port&gt;&quot;]</span></code>.</p></li>\n</ul>\n</li>\n</ol>\n</section>\n<section id=\"manual-file-and-package-syncing\">\n<h2>Manual File and Package Syncing<a class=\"headerlink\" href=\"#manual-file-and-package-syncing\" title=\"Permalink to this heading\">\u00b6</a></h2>\n<p>If you are running into an rsync or module not found error, you can work around by manually syncing over local files or\ninstalling any packages on your remote box.</p>\n<ol class=\"arabic\">\n<li><p>To sync over the local folder (e.g. <code class=\"docutils literal notranslate\"><span class=\"pre\">tutorials</span></code>) to remote. Not the trailing slash <code class=\"docutils literal notranslate\"><span class=\"pre\">/</span></code> at the end of the local directory\nto prevent an additional level of folder nesting on the remote cluster. Now is also a good time to install any packages on the remote box,\nincluding <code class=\"docutils literal notranslate\"><span class=\"pre\">requirements.txt</span></code>.</p>\n<div class=\"highlight-shell notranslate\"><div class=\"highlight\"><pre><span></span>rsync<span class=\"w\"> </span>-a<span class=\"w\"> </span>tutorials/<span class=\"w\"> </span>user@216.153.62.74:tutorials\n</pre></div>\n</div>\n<p>To ensure Runhouse doesn\u2019t try to resync over your code again, pass in an empty env object, <code class=\"docutils literal notranslate\"><span class=\"pre\">env=rh.Env()</span></code>,\nwhen sending functions or modules to the cluster.</p>\n<div class=\"highlight-ipython3 notranslate\"><div class=\"highlight\"><pre><span></span>generate_gpu = rh.function(fn=sd_generate).to(gpu, env=rh.Env())\n</pre></div>\n</div>\n</li>\n<li><p>If you\u2019re encountering a Module not found error, you may need to pass a Runhouse package object pointing to the\npackage in the remote filesystem into your Env so the server can find the module properly. You can do that like so:</p>\n<div class=\"highlight-ipython3 notranslate\"><div class=\"highlight\"><pre><span></span>my_env = rh.Env(workdir=rh.Package(path=&quot;tutorials&quot;, system=gpu, install_method=&quot;reqs&quot;))\ngenerate_gpu = rh.function(fn=sd_generate).to(gpu, env=my_env)\n</pre></div>\n</div>\n<ul class=\"simple\">\n<li><p><code class=\"docutils literal notranslate\"><span class=\"pre\">install_method</span></code> can be <code class=\"docutils literal notranslate\"><span class=\"pre\">local</span></code> (to skip install), <code class=\"docutils literal notranslate\"><span class=\"pre\">pip</span></code>, <code class=\"docutils literal notranslate\"><span class=\"pre\">conda</span></code>, or <code class=\"docutils literal notranslate\"><span class=\"pre\">reqs</span></code>\n(pip installs requirements.txt)</p></li>\n</ul>\n</li>\n</ol>\n</section>\n<section id=\"common-errors\">\n<h2>Common Errors<a class=\"headerlink\" href=\"#common-errors\" title=\"Permalink to this heading\">\u00b6</a></h2>\n<p>Q: I\u2019m running into the following error: <code class=\"docutils literal notranslate\"><span class=\"pre\">ImportError:</span> <span class=\"pre\">Failed</span> <span class=\"pre\">to</span> <span class=\"pre\">import</span> <span class=\"pre\">grpc</span> <span class=\"pre\">on</span> <span class=\"pre\">Apple</span> <span class=\"pre\">Silicon.</span></code></p>\n<blockquote>\n<div><p>Please run <code class=\"docutils literal notranslate\"><span class=\"pre\">pip</span> <span class=\"pre\">uninstall</span> <span class=\"pre\">grpcio;</span> <span class=\"pre\">conda</span> <span class=\"pre\">install</span> <span class=\"pre\">grpcio</span></code>, then rerun your code. This is due to the Ray/grpcio\ncompatibility on Apple Silicon during setup.</p>\n</div></blockquote>\n<p>Q: I\u2019m running into an OpenSSL error.</p>\n<blockquote>\n<div><p>Please run <code class=\"docutils literal notranslate\"><span class=\"pre\">pip</span> <span class=\"pre\">install</span> <span class=\"pre\">pip</span> <span class=\"pre\">--upgrade;</span> <span class=\"pre\">pip</span> <span class=\"pre\">install</span> <span class=\"pre\">pyopenssl</span> <span class=\"pre\">--upgrade</span></code>.</p>\n</div></blockquote>\n<p>Q: I\u2019m running into an rsync error.</p>\n<blockquote>\n<div><p>Rsync is finicky and we are working to support more reliable file syncing. In the meantime, please refer to the\nManual Package syncing instructions above. It is also worth noting that rsync will throw an error if <code class=\"docutils literal notranslate\"><span class=\"pre\">.bashrc</span></code>\noutputs anything to the terminal. See <a class=\"reference external\" href=\"https://github.com/run-house/runhouse/issues/91\">Issue</a>.</p>\n</div></blockquote>\n<p>Q: I\u2019m running into a few (usually 5) consecutive errors of the following form:</p>\n<blockquote>\n<div><div class=\"highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">INFO</span>     <span class=\"n\">runhouse</span><span class=\"o\">.</span><span class=\"n\">resources</span><span class=\"o\">.</span><span class=\"n\">hardware</span><span class=\"o\">.</span><span class=\"n\">cluster</span><span class=\"p\">:</span><span class=\"n\">cluster</span><span class=\"o\">.</span><span class=\"n\">py</span><span class=\"p\">:</span><span class=\"mi\">404</span> <span class=\"n\">Checking</span> <span class=\"n\">server</span> <span class=\"n\">rh</span><span class=\"o\">-</span><span class=\"n\">cpu</span> <span class=\"n\">again</span> <span class=\"p\">[</span><span class=\"mi\">1</span><span class=\"o\">/</span><span class=\"mi\">5</span><span class=\"p\">]</span><span class=\"o\">.</span>\n<span class=\"n\">ERROR</span>    <span class=\"n\">paramiko</span><span class=\"o\">.</span><span class=\"n\">transport</span><span class=\"p\">:</span><span class=\"n\">transport</span><span class=\"o\">.</span><span class=\"n\">py</span><span class=\"p\">:</span><span class=\"mi\">1893</span> <span class=\"n\">Secsh</span> <span class=\"n\">channel</span> <span class=\"mi\">1</span> <span class=\"nb\">open</span> <span class=\"n\">FAILED</span><span class=\"p\">:</span> <span class=\"n\">Connection</span> <span class=\"n\">refused</span><span class=\"p\">:</span> <span class=\"n\">Connect</span> <span class=\"n\">failed</span>\n<span class=\"n\">ERROR</span>    <span class=\"n\">sshtunnel</span><span class=\"o\">.</span><span class=\"n\">SSHTunnelForwarder</span><span class=\"p\">:</span><span class=\"n\">sshtunnel</span><span class=\"o\">.</span><span class=\"n\">py</span><span class=\"p\">:</span><span class=\"mi\">394</span> <span class=\"n\">Could</span> <span class=\"ow\">not</span> <span class=\"n\">establish</span> <span class=\"n\">connection</span> <span class=\"kn\">from</span> <span class=\"nn\">local</span> <span class=\"p\">(</span><span class=\"s1\">&#39;127.0.0.1&#39;</span><span class=\"p\">,</span> <span class=\"mi\">50052</span><span class=\"p\">)</span> <span class=\"n\">to</span> <span class=\"n\">remote</span> <span class=\"p\">(</span><span class=\"s1\">&#39;127.0.0.1&#39;</span><span class=\"p\">,</span> <span class=\"mi\">50052</span><span class=\"p\">)</span> <span class=\"n\">side</span> <span class=\"n\">of</span> <span class=\"n\">the</span> <span class=\"n\">tunnel</span><span class=\"p\">:</span> <span class=\"nb\">open</span> <span class=\"n\">new</span> <span class=\"n\">channel</span> <span class=\"n\">ssh</span> <span class=\"n\">error</span><span class=\"p\">:</span> <span class=\"n\">ChannelException</span><span class=\"p\">(</span><span class=\"mi\">2</span><span class=\"p\">,</span> <span class=\"s1\">&#39;Connect failed&#39;</span><span class=\"p\">)</span>\n</pre></div>\n</div>\n<ol class=\"arabic simple\">\n<li><p>Run the tests in <code class=\"docutils literal notranslate\"><span class=\"pre\">test_module.py</span></code> and see if the issue reproduces:</p></li>\n</ol>\n<div class=\"highlight-shell notranslate\"><div class=\"highlight\"><pre><span></span>pytest<span class=\"w\"> </span>tests/test_module.py<span class=\"w\"> </span>-s\n</pre></div>\n</div>\n<ol class=\"arabic simple\" start=\"2\">\n<li><p>If you see the same error(s), SSH into <code class=\"docutils literal notranslate\"><span class=\"pre\">rh-cpu</span></code>:</p></li>\n</ol>\n<div class=\"highlight-shell notranslate\"><div class=\"highlight\"><pre><span></span>ssh<span class=\"w\"> </span>rh-cpu\n</pre></div>\n</div>\n<ol class=\"arabic simple\" start=\"3\">\n<li><p>Check if you can resume the latest screen:</p></li>\n</ol>\n<div class=\"highlight-shell notranslate\"><div class=\"highlight\"><pre><span></span>screen<span class=\"w\"> </span>-r\n</pre></div>\n</div>\n<ol class=\"arabic simple\" start=\"4\">\n<li><p>If the result is <code class=\"docutils literal notranslate\"><span class=\"pre\">There</span> <span class=\"pre\">is</span> <span class=\"pre\">no</span> <span class=\"pre\">screen</span> <span class=\"pre\">to</span> <span class=\"pre\">be</span> <span class=\"pre\">resumed.</span></code>, it means the Runhouse server is not up. Start it using:</p></li>\n</ol>\n<div class=\"highlight-shell notranslate\"><div class=\"highlight\"><pre><span></span>runhouse<span class=\"w\"> </span>start\n</pre></div>\n</div>\n<ol class=\"arabic simple\" start=\"5\">\n<li><p>Observe the output for any errors e.g. <code class=\"docutils literal notranslate\"><span class=\"pre\">ImportError:</span> <span class=\"pre\">...</span></code> and fix them</p></li>\n</ol>\n</div></blockquote>\n</section>\n</section>\n\n    <script type=\"text/x-thebe-config\">\n    {\n        requestKernel: true,\n        binderOptions: {\n            repo: \"binder-examples/jupyter-stacks-datascience\",\n            ref: \"master\",\n        },\n        codeMirrorConfig: {\n            theme: \"abcdef\",\n            mode: \"python\"\n        },\n        kernelOptions: {\n            name: \"python3\",\n            path: \"./.\"\n        },\n        predefinedOutput: true\n    }\n    </script>\n    <script>kernelName = 'python3'</script>", "metatags": "<meta name=\"generator\" content=\"Docutils 0.19: https://docutils.sourceforge.io/\" />\n", "rellinks": [["genindex", "General Index", "I", "index"], ["py-modindex", "Python Module Index", "", "modules"], ["security-and-authentication", "Security and Authentication", "N", "next"], ["docker", "Docker Runtime Env", "P", "previous"]], "sourcename": "troubleshooting.rst.txt", "toc": "<ul>\n<li><a class=\"reference internal\" href=\"#\">Manual Setup and Troubleshooting</a><ul>\n<li><a class=\"reference internal\" href=\"#manual-ssh-tunneling\">Manual SSH Tunneling</a></li>\n<li><a class=\"reference internal\" href=\"#manual-file-and-package-syncing\">Manual File and Package Syncing</a></li>\n<li><a class=\"reference internal\" href=\"#common-errors\">Common Errors</a></li>\n</ul>\n</li>\n</ul>\n", "display_toc": true, "page_source_suffix": ".rst", "globaltoc": "<p class=\"caption\" role=\"heading\"><span class=\"caption-text\">Getting Started</span></p>\n<ul>\n<li class=\"toctree-l1\"><a class=\"reference internal\" href=\"tutorials/quick-start-cloud/\">Cloud Quick Start</a></li>\n<li class=\"toctree-l1\"><a class=\"reference internal\" href=\"tutorials/quick-start-local/\">Local Quick Start</a></li>\n<li class=\"toctree-l1\"><a class=\"reference internal\" href=\"tutorials/quick-start-den/\">Den Quick Start</a></li>\n<li class=\"toctree-l1\"><a class=\"reference internal\" href=\"architecture/\">Architecture Overview</a></li>\n</ul>\n<p class=\"caption\" role=\"heading\"><span class=\"caption-text\">API Basics</span></p>\n<ul>\n<li class=\"toctree-l1\"><a class=\"reference internal\" href=\"tutorials/api-clusters/\">Clusters</a></li>\n<li class=\"toctree-l1\"><a class=\"reference internal\" href=\"tutorials/api-modules/\">Functions and Modules</a></li>\n<li class=\"toctree-l1\"><a class=\"reference internal\" href=\"tutorials/api-envs/\">Envs and Packages</a></li>\n<li class=\"toctree-l1\"><a class=\"reference internal\" href=\"tutorials/api-folders/\">Folders</a></li>\n<li class=\"toctree-l1\"><a class=\"reference internal\" href=\"tutorials/api-secrets/\">Secrets</a></li>\n<li class=\"toctree-l1\"><a class=\"reference internal\" href=\"tutorials/api-resources/\">Resource Management</a></li>\n</ul>\n<p class=\"caption\" role=\"heading\"><span class=\"caption-text\">API Reference</span></p>\n<ul>\n<li class=\"toctree-l1\"><a class=\"reference internal\" href=\"api/python/\">Python API</a><ul>\n<li class=\"toctree-l2\"><a class=\"reference internal\" href=\"api/python/resource/\">Resource</a></li>\n<li class=\"toctree-l2\"><a class=\"reference internal\" href=\"api/python/function/\">Function</a></li>\n<li class=\"toctree-l2\"><a class=\"reference internal\" href=\"api/python/cluster/\">Cluster</a></li>\n<li class=\"toctree-l2\"><a class=\"reference internal\" href=\"api/python/env/\">Env</a></li>\n<li class=\"toctree-l2\"><a class=\"reference internal\" href=\"api/python/package/\">Package</a></li>\n<li class=\"toctree-l2\"><a class=\"reference internal\" href=\"api/python/module/\">Module</a></li>\n<li class=\"toctree-l2\"><a class=\"reference internal\" href=\"api/python/folder/\">Folder</a></li>\n<li class=\"toctree-l2\"><a class=\"reference internal\" href=\"api/python/blob/\">Blob</a></li>\n<li class=\"toctree-l2\"><a class=\"reference internal\" href=\"api/python/file/\">File</a></li>\n<li class=\"toctree-l2\"><a class=\"reference internal\" href=\"api/python/secrets/\">Secrets</a></li>\n<li class=\"toctree-l2\"><a class=\"reference internal\" href=\"api/python/login/\">Login/Logout</a></li>\n</ul>\n</li>\n<li class=\"toctree-l1\"><a class=\"reference internal\" href=\"api/cli/\">Command Line Interface</a></li>\n</ul>\n<p class=\"caption\" role=\"heading\"><span class=\"caption-text\">Other Topics</span></p>\n<ul>\n<li class=\"toctree-l1\"><a class=\"reference internal\" href=\"tutorials/async/\">Asynchronous Programming</a></li>\n<li class=\"toctree-l1\"><a class=\"reference internal\" href=\"installation/\">Installation and Setup</a></li>\n<li class=\"toctree-l1\"><a class=\"reference internal\" href=\"debugging-logging/\">Debugging and Logging</a></li>\n<li class=\"toctree-l1\"><a class=\"reference internal\" href=\"docker/\">Docker Runtime Env</a></li>\n<li class=\"toctree-l1\"><a class=\"reference internal\" href=\"troubleshooting/\">Manual Setup and Troubleshooting</a></li>\n<li class=\"toctree-l1\"><a class=\"reference internal\" href=\"security-and-authentication/\">Security and Authentication</a></li>\n</ul>\n", "current_page_name": "troubleshooting", "sidebars": ["about.html", "navigation.html", "relations.html", "searchbox.html", "donate.html"], "customsidebar": null, "alabaster_version": "0.7.16", "alabaster_version_info": [0, 7, 16]}