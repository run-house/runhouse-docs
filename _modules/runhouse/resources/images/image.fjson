{"parents": [{"link": "../../../../", "title": "Module code"}], "title": "runhouse.resources.images.image", "body": "<h1>Source code for runhouse.resources.images.image</h1><div class=\"highlight\"><pre>\n<span></span><span class=\"kn\">from</span> <span class=\"nn\">enum</span> <span class=\"kn\">import</span> <span class=\"n\">Enum</span>\n<span class=\"kn\">from</span> <span class=\"nn\">typing</span> <span class=\"kn\">import</span> <span class=\"n\">Any</span><span class=\"p\">,</span> <span class=\"n\">Dict</span><span class=\"p\">,</span> <span class=\"n\">List</span><span class=\"p\">,</span> <span class=\"n\">Optional</span><span class=\"p\">,</span> <span class=\"n\">Union</span>\n\n<span class=\"c1\"># Internal class to represent the image construction process</span>\n<div class=\"viewcode-block\" id=\"ImageSetupStepType\"><a class=\"viewcode-back\" href=\"../../../../../api/python/image/#runhouse.ImageSetupStepType\">[docs]</a><span class=\"k\">class</span> <span class=\"nc\">ImageSetupStepType</span><span class=\"p\">(</span><span class=\"n\">Enum</span><span class=\"p\">):</span>\n<span class=\"w\">    </span><span class=\"sd\">&quot;&quot;&quot;Enum for valid Image setup step types&quot;&quot;&quot;</span>\n\n    <span class=\"n\">PACKAGES</span> <span class=\"o\">=</span> <span class=\"s2\">&quot;packages&quot;</span>\n    <span class=\"n\">CMD_RUN</span> <span class=\"o\">=</span> <span class=\"s2\">&quot;cmd_run&quot;</span>\n    <span class=\"n\">SETUP_CONDA_ENV</span> <span class=\"o\">=</span> <span class=\"s2\">&quot;setup_conda_env&quot;</span>\n    <span class=\"n\">RSYNC</span> <span class=\"o\">=</span> <span class=\"s2\">&quot;rsync&quot;</span>\n    <span class=\"n\">SYNC_SECRETS</span> <span class=\"o\">=</span> <span class=\"s2\">&quot;sync_secrets&quot;</span>\n    <span class=\"n\">SET_ENV_VARS</span> <span class=\"o\">=</span> <span class=\"s2\">&quot;set_env_vars&quot;</span>\n    <span class=\"n\">PIP_INSTALL</span> <span class=\"o\">=</span> <span class=\"s2\">&quot;pip_install&quot;</span>\n    <span class=\"n\">UV_INSTALL</span> <span class=\"o\">=</span> <span class=\"s2\">&quot;uv_install&quot;</span>\n    <span class=\"n\">CONDA_INSTALL</span> <span class=\"o\">=</span> <span class=\"s2\">&quot;conda_install&quot;</span>\n    <span class=\"n\">SYNC_PACKAGE</span> <span class=\"o\">=</span> <span class=\"s2\">&quot;sync_package&quot;</span>\n    <span class=\"n\">SET_VENV</span> <span class=\"o\">=</span> <span class=\"s2\">&quot;set_venv&quot;</span></div>\n\n\n<div class=\"viewcode-block\" id=\"ImageSetupStep\"><a class=\"viewcode-back\" href=\"../../../../../api/python/image/#runhouse.ImageSetupStep\">[docs]</a><span class=\"k\">class</span> <span class=\"nc\">ImageSetupStep</span><span class=\"p\">:</span>\n<div class=\"viewcode-block\" id=\"ImageSetupStep.__init__\"><a class=\"viewcode-back\" href=\"../../../../../api/python/image/#runhouse.ImageSetupStep.__init__\">[docs]</a>    <span class=\"k\">def</span> <span class=\"fm\">__init__</span><span class=\"p\">(</span>\n        <span class=\"bp\">self</span><span class=\"p\">,</span>\n        <span class=\"n\">step_type</span><span class=\"p\">:</span> <span class=\"n\">ImageSetupStepType</span><span class=\"p\">,</span>\n        <span class=\"o\">**</span><span class=\"n\">kwargs</span><span class=\"p\">:</span> <span class=\"n\">Dict</span><span class=\"p\">[</span><span class=\"nb\">str</span><span class=\"p\">,</span> <span class=\"n\">Any</span><span class=\"p\">],</span>\n    <span class=\"p\">):</span>\n<span class=\"w\">        </span><span class=\"sd\">&quot;&quot;&quot;</span>\n<span class=\"sd\">        A component of the Runhouse Image, consisting of the step type (e.g. packages, set_env_vars),</span>\n<span class=\"sd\">        along with arguments to provide to the function corresponding to the step type.</span>\n\n<span class=\"sd\">        Args:</span>\n<span class=\"sd\">            step_type (ImageSetupStepType): Type of setup step used to provide the Image.</span>\n<span class=\"sd\">            kwargs (Dict[str, Any]): Please refer to the corresponding functions in ``Image`` to determine</span>\n<span class=\"sd\">                the correct keyword arguments to provide.</span>\n<span class=\"sd\">        &quot;&quot;&quot;</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">step_type</span> <span class=\"o\">=</span> <span class=\"n\">step_type</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">kwargs</span> <span class=\"o\">=</span> <span class=\"n\">kwargs</span></div></div>\n\n\n<div class=\"viewcode-block\" id=\"Image\"><a class=\"viewcode-back\" href=\"../../../../../api/python/image/#runhouse.Image\">[docs]</a><span class=\"k\">class</span> <span class=\"nc\">Image</span><span class=\"p\">:</span>\n<div class=\"viewcode-block\" id=\"Image.__init__\"><a class=\"viewcode-back\" href=\"../../../../../api/python/image/#runhouse.Image.__init__\">[docs]</a>    <span class=\"k\">def</span> <span class=\"fm\">__init__</span><span class=\"p\">(</span>\n        <span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">name</span><span class=\"p\">:</span> <span class=\"nb\">str</span> <span class=\"o\">=</span> <span class=\"kc\">None</span><span class=\"p\">,</span> <span class=\"n\">image_id</span><span class=\"p\">:</span> <span class=\"nb\">str</span> <span class=\"o\">=</span> <span class=\"kc\">None</span><span class=\"p\">,</span> <span class=\"n\">python_version</span><span class=\"p\">:</span> <span class=\"nb\">str</span> <span class=\"o\">=</span> <span class=\"kc\">None</span>\n    <span class=\"p\">):</span>\n<span class=\"w\">        </span><span class=\"sd\">&quot;&quot;&quot;</span>\n<span class=\"sd\">        Runhouse Image object, specifying cluster setup properties and steps.</span>\n\n<span class=\"sd\">        Args:</span>\n<span class=\"sd\">            name (str): Name to assign the Runhouse image.</span>\n<span class=\"sd\">            image_id (str): Machine image to use, if any. (Default: ``None``)</span>\n\n<span class=\"sd\">        Example:</span>\n<span class=\"sd\">            &gt;&gt;&gt; my_image = (</span>\n<span class=\"sd\">            &gt;&gt;&gt;     rh.Image(name=&quot;base_image&quot;)</span>\n<span class=\"sd\">            &gt;&gt;&gt;     .setup_conda_env(</span>\n<span class=\"sd\">            &gt;&gt;&gt;         conda_env_name=&quot;base_env&quot;,</span>\n<span class=\"sd\">            &gt;&gt;&gt;         conda_config={&quot;dependencies&quot;: [&quot;python=3.11&quot;], &quot;name&quot;: &quot;base_env&quot;},</span>\n<span class=\"sd\">            &gt;&gt;&gt;     )</span>\n<span class=\"sd\">            &gt;&gt;&gt;     .pip_install([&quot;numpy&quot;, &quot;pandas&quot;])</span>\n<span class=\"sd\">            &gt;&gt;&gt;     .set_env_vars({&quot;OMP_NUM_THREADS&quot;: 1})</span>\n<span class=\"sd\">            &gt;&gt;&gt; )</span>\n<span class=\"sd\">        &quot;&quot;&quot;</span>\n\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">name</span> <span class=\"o\">=</span> <span class=\"n\">name</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">image_id</span> <span class=\"o\">=</span> <span class=\"n\">image_id</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">python_version</span> <span class=\"o\">=</span> <span class=\"n\">python_version</span>\n\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">setup_steps</span> <span class=\"o\">=</span> <span class=\"p\">[]</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">conda_env_name</span> <span class=\"o\">=</span> <span class=\"kc\">None</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">venv_path</span> <span class=\"o\">=</span> <span class=\"kc\">None</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">docker_secret</span> <span class=\"o\">=</span> <span class=\"kc\">None</span></div>\n\n    <span class=\"nd\">@staticmethod</span>\n    <span class=\"k\">def</span> <span class=\"nf\">_setup_step_config</span><span class=\"p\">(</span><span class=\"n\">step</span><span class=\"p\">:</span> <span class=\"n\">ImageSetupStep</span><span class=\"p\">):</span>\n<span class=\"w\">        </span><span class=\"sd\">&quot;&quot;&quot;Get ImageSetupStep config&quot;&quot;&quot;</span>\n        <span class=\"n\">config</span> <span class=\"o\">=</span> <span class=\"p\">{</span>\n            <span class=\"s2\">&quot;step_type&quot;</span><span class=\"p\">:</span> <span class=\"n\">step</span><span class=\"o\">.</span><span class=\"n\">step_type</span><span class=\"o\">.</span><span class=\"n\">value</span><span class=\"p\">,</span>\n        <span class=\"p\">}</span>\n        <span class=\"k\">if</span> <span class=\"n\">step</span><span class=\"o\">.</span><span class=\"n\">step_type</span> <span class=\"o\">==</span> <span class=\"n\">ImageSetupStepType</span><span class=\"o\">.</span><span class=\"n\">SYNC_SECRETS</span><span class=\"p\">:</span>\n            <span class=\"n\">secrets</span> <span class=\"o\">=</span> <span class=\"n\">step</span><span class=\"o\">.</span><span class=\"n\">kwargs</span><span class=\"o\">.</span><span class=\"n\">get</span><span class=\"p\">(</span><span class=\"s2\">&quot;providers&quot;</span><span class=\"p\">)</span>\n            <span class=\"n\">new_kwargs</span> <span class=\"o\">=</span> <span class=\"p\">[]</span>\n            <span class=\"k\">for</span> <span class=\"n\">secret</span> <span class=\"ow\">in</span> <span class=\"n\">secrets</span><span class=\"p\">:</span>\n                <span class=\"n\">new_kwargs</span><span class=\"o\">.</span><span class=\"n\">append</span><span class=\"p\">(</span>\n                    <span class=\"n\">secret</span> <span class=\"k\">if</span> <span class=\"nb\">isinstance</span><span class=\"p\">(</span><span class=\"n\">secret</span><span class=\"p\">,</span> <span class=\"nb\">str</span><span class=\"p\">)</span> <span class=\"k\">else</span> <span class=\"n\">secret</span><span class=\"o\">.</span><span class=\"n\">config</span><span class=\"p\">(</span><span class=\"n\">values</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">)</span>\n                <span class=\"p\">)</span>\n            <span class=\"n\">config</span><span class=\"p\">[</span><span class=\"s2\">&quot;kwargs&quot;</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"n\">new_kwargs</span>\n        <span class=\"k\">else</span><span class=\"p\">:</span>\n            <span class=\"n\">config</span><span class=\"p\">[</span><span class=\"s2\">&quot;kwargs&quot;</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"n\">step</span><span class=\"o\">.</span><span class=\"n\">kwargs</span>\n        <span class=\"k\">return</span> <span class=\"n\">config</span>\n\n    <span class=\"nd\">@staticmethod</span>\n    <span class=\"k\">def</span> <span class=\"nf\">_setup_step_from_config</span><span class=\"p\">(</span><span class=\"n\">step</span><span class=\"p\">:</span> <span class=\"n\">Dict</span><span class=\"p\">):</span>\n<span class=\"w\">        </span><span class=\"sd\">&quot;&quot;&quot;Convert setup step config (dict) to ImageSetupStep object&quot;&quot;&quot;</span>\n        <span class=\"n\">step_type</span> <span class=\"o\">=</span> <span class=\"n\">step</span><span class=\"p\">[</span><span class=\"s2\">&quot;step_type&quot;</span><span class=\"p\">]</span>\n        <span class=\"k\">if</span> <span class=\"n\">step_type</span> <span class=\"o\">==</span> <span class=\"s2\">&quot;sync_secrets&quot;</span><span class=\"p\">:</span>\n            <span class=\"kn\">from</span> <span class=\"nn\">runhouse.resources.secrets.secret</span> <span class=\"kn\">import</span> <span class=\"n\">Secret</span>\n\n            <span class=\"n\">secrets</span> <span class=\"o\">=</span> <span class=\"n\">step</span><span class=\"p\">[</span><span class=\"s2\">&quot;kwargs&quot;</span><span class=\"p\">]</span>\n            <span class=\"n\">secret_list</span> <span class=\"o\">=</span> <span class=\"p\">[]</span>\n            <span class=\"k\">for</span> <span class=\"n\">secret</span> <span class=\"ow\">in</span> <span class=\"n\">secrets</span><span class=\"p\">:</span>\n                <span class=\"n\">secret_list</span><span class=\"o\">.</span><span class=\"n\">append</span><span class=\"p\">(</span>\n                    <span class=\"n\">Secret</span><span class=\"o\">.</span><span class=\"n\">from_config</span><span class=\"p\">(</span><span class=\"n\">secret</span><span class=\"p\">)</span> <span class=\"k\">if</span> <span class=\"nb\">isinstance</span><span class=\"p\">(</span><span class=\"n\">secret</span><span class=\"p\">,</span> <span class=\"n\">Dict</span><span class=\"p\">)</span> <span class=\"k\">else</span> <span class=\"n\">secret</span>\n                <span class=\"p\">)</span>\n            <span class=\"n\">kwargs</span> <span class=\"o\">=</span> <span class=\"p\">{</span><span class=\"s2\">&quot;providers&quot;</span><span class=\"p\">:</span> <span class=\"n\">secret_list</span><span class=\"p\">}</span>\n        <span class=\"k\">else</span><span class=\"p\">:</span>\n            <span class=\"n\">kwargs</span> <span class=\"o\">=</span> <span class=\"n\">step</span><span class=\"p\">[</span><span class=\"s2\">&quot;kwargs&quot;</span><span class=\"p\">]</span>\n        <span class=\"k\">return</span> <span class=\"n\">ImageSetupStep</span><span class=\"p\">(</span>\n            <span class=\"n\">step_type</span><span class=\"o\">=</span><span class=\"n\">ImageSetupStepType</span><span class=\"p\">(</span><span class=\"n\">step_type</span><span class=\"p\">),</span>\n            <span class=\"o\">**</span><span class=\"n\">kwargs</span><span class=\"p\">,</span>\n        <span class=\"p\">)</span>\n\n    <span class=\"k\">def</span> <span class=\"nf\">_save_sub_resources</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">):</span>\n        <span class=\"n\">secret_steps</span> <span class=\"o\">=</span> <span class=\"p\">[</span>\n            <span class=\"n\">step</span>\n            <span class=\"k\">for</span> <span class=\"n\">step</span> <span class=\"ow\">in</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">setup_steps</span>\n            <span class=\"k\">if</span> <span class=\"n\">step</span><span class=\"o\">.</span><span class=\"n\">step_type</span> <span class=\"o\">==</span> <span class=\"n\">ImageSetupStepType</span><span class=\"o\">.</span><span class=\"n\">SYNC_SECRETS</span>\n        <span class=\"p\">]</span>\n        <span class=\"k\">for</span> <span class=\"n\">step</span> <span class=\"ow\">in</span> <span class=\"n\">secret_steps</span><span class=\"p\">:</span>\n            <span class=\"kn\">from</span> <span class=\"nn\">runhouse.resources.secrets.secret</span> <span class=\"kn\">import</span> <span class=\"n\">Secret</span>\n\n            <span class=\"n\">secrets</span> <span class=\"o\">=</span> <span class=\"n\">step</span><span class=\"o\">.</span><span class=\"n\">kwargs</span><span class=\"o\">.</span><span class=\"n\">get</span><span class=\"p\">(</span><span class=\"s2\">&quot;providers&quot;</span><span class=\"p\">)</span>\n            <span class=\"k\">for</span> <span class=\"n\">secret</span> <span class=\"ow\">in</span> <span class=\"n\">secrets</span><span class=\"p\">:</span>\n                <span class=\"k\">if</span> <span class=\"nb\">isinstance</span><span class=\"p\">(</span><span class=\"n\">secret</span><span class=\"p\">,</span> <span class=\"n\">Secret</span><span class=\"p\">):</span>\n                    <span class=\"n\">secret</span><span class=\"o\">.</span><span class=\"n\">save</span><span class=\"p\">()</span>\n\n<div class=\"viewcode-block\" id=\"Image.from_docker\"><a class=\"viewcode-back\" href=\"../../../../../api/python/image/#runhouse.Image.from_docker\">[docs]</a>    <span class=\"k\">def</span> <span class=\"nf\">from_docker</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">image_id</span><span class=\"p\">:</span> <span class=\"nb\">str</span><span class=\"p\">,</span> <span class=\"n\">docker_secret</span><span class=\"p\">:</span> <span class=\"n\">Union</span><span class=\"p\">[</span><span class=\"s2\">&quot;Secret&quot;</span><span class=\"p\">,</span> <span class=\"nb\">str</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"kc\">None</span><span class=\"p\">):</span>\n<span class=\"w\">        </span><span class=\"sd\">&quot;&quot;&quot;Set up and use an existing Docker image.</span>\n\n<span class=\"sd\">        Args:</span>\n<span class=\"sd\">            image_id (str): Docker image in the following format ``&quot;&lt;registry&gt;/&lt;image&gt;:&lt;tag&gt;&quot;``</span>\n<span class=\"sd\">            docker_secret (Secret or str, optional): Runhouse secret corresponding to information</span>\n<span class=\"sd\">                necessary to pull the image from a private registry, such as Docker Hub or cloud provider.</span>\n<span class=\"sd\">                See ``DockerRegistrySecret`` for more information.</span>\n<span class=\"sd\">        &quot;&quot;&quot;</span>\n        <span class=\"k\">if</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">image_id</span><span class=\"p\">:</span>\n            <span class=\"k\">raise</span> <span class=\"ne\">ValueError</span><span class=\"p\">(</span>\n                <span class=\"s2\">&quot;Setting both a machine image and docker image is not yet supported.&quot;</span>\n            <span class=\"p\">)</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">image_id</span> <span class=\"o\">=</span> <span class=\"sa\">f</span><span class=\"s2\">&quot;docker:</span><span class=\"si\">{</span><span class=\"n\">image_id</span><span class=\"si\">}</span><span class=\"s2\">&quot;</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">docker_secret</span> <span class=\"o\">=</span> <span class=\"n\">docker_secret</span>\n        <span class=\"k\">return</span> <span class=\"bp\">self</span></div>\n\n    <span class=\"k\">def</span> <span class=\"nf\">config</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">)</span> <span class=\"o\">-&gt;</span> <span class=\"n\">Dict</span><span class=\"p\">[</span><span class=\"nb\">str</span><span class=\"p\">,</span> <span class=\"n\">Any</span><span class=\"p\">]:</span>\n        <span class=\"n\">config</span> <span class=\"o\">=</span> <span class=\"p\">{}</span>\n        <span class=\"k\">if</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">name</span><span class=\"p\">:</span>\n            <span class=\"n\">config</span><span class=\"p\">[</span><span class=\"s2\">&quot;name&quot;</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">name</span>\n        <span class=\"k\">if</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">image_id</span><span class=\"p\">:</span>\n            <span class=\"n\">config</span><span class=\"p\">[</span><span class=\"s2\">&quot;image_id&quot;</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">image_id</span>\n        <span class=\"k\">if</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">docker_secret</span><span class=\"p\">:</span>\n            <span class=\"n\">config</span><span class=\"p\">[</span><span class=\"s2\">&quot;docker_secret&quot;</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"p\">(</span>\n                <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">docker_secret</span>\n                <span class=\"k\">if</span> <span class=\"nb\">isinstance</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">docker_secret</span><span class=\"p\">,</span> <span class=\"nb\">str</span><span class=\"p\">)</span>\n                <span class=\"k\">else</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">docker_secret</span><span class=\"o\">.</span><span class=\"n\">config</span><span class=\"p\">()</span>\n            <span class=\"p\">)</span>\n        <span class=\"k\">if</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">conda_env_name</span><span class=\"p\">:</span>\n            <span class=\"n\">config</span><span class=\"p\">[</span><span class=\"s2\">&quot;conda_env_name&quot;</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">conda_env_name</span>\n        <span class=\"k\">if</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">venv_path</span><span class=\"p\">:</span>\n            <span class=\"n\">config</span><span class=\"p\">[</span><span class=\"s2\">&quot;venv_path&quot;</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">venv_path</span>\n        <span class=\"k\">if</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">setup_steps</span><span class=\"p\">:</span>\n            <span class=\"n\">config</span><span class=\"p\">[</span><span class=\"s2\">&quot;setup_steps&quot;</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"p\">[</span>\n                <span class=\"n\">Image</span><span class=\"o\">.</span><span class=\"n\">_setup_step_config</span><span class=\"p\">(</span><span class=\"n\">step</span><span class=\"p\">)</span> <span class=\"k\">for</span> <span class=\"n\">step</span> <span class=\"ow\">in</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">setup_steps</span>\n            <span class=\"p\">]</span>\n\n        <span class=\"k\">return</span> <span class=\"n\">config</span>\n\n    <span class=\"nd\">@classmethod</span>\n    <span class=\"k\">def</span> <span class=\"nf\">from_config</span><span class=\"p\">(</span><span class=\"bp\">cls</span><span class=\"p\">,</span> <span class=\"n\">config</span><span class=\"p\">:</span> <span class=\"n\">Dict</span><span class=\"p\">[</span><span class=\"nb\">str</span><span class=\"p\">,</span> <span class=\"n\">Any</span><span class=\"p\">]):</span>\n        <span class=\"n\">img</span> <span class=\"o\">=</span> <span class=\"n\">Image</span><span class=\"p\">(</span><span class=\"n\">name</span><span class=\"o\">=</span><span class=\"n\">config</span><span class=\"o\">.</span><span class=\"n\">get</span><span class=\"p\">(</span><span class=\"s2\">&quot;name&quot;</span><span class=\"p\">),</span> <span class=\"n\">image_id</span><span class=\"o\">=</span><span class=\"n\">config</span><span class=\"o\">.</span><span class=\"n\">get</span><span class=\"p\">(</span><span class=\"s2\">&quot;image_id&quot;</span><span class=\"p\">))</span>\n        <span class=\"k\">if</span> <span class=\"n\">config</span><span class=\"o\">.</span><span class=\"n\">get</span><span class=\"p\">(</span><span class=\"s2\">&quot;setup_steps&quot;</span><span class=\"p\">):</span>\n            <span class=\"n\">img</span><span class=\"o\">.</span><span class=\"n\">setup_steps</span> <span class=\"o\">=</span> <span class=\"p\">[</span>\n                <span class=\"n\">Image</span><span class=\"o\">.</span><span class=\"n\">_setup_step_from_config</span><span class=\"p\">(</span><span class=\"n\">step</span><span class=\"p\">)</span> <span class=\"k\">for</span> <span class=\"n\">step</span> <span class=\"ow\">in</span> <span class=\"n\">config</span><span class=\"p\">[</span><span class=\"s2\">&quot;setup_steps&quot;</span><span class=\"p\">]</span>\n            <span class=\"p\">]</span>\n\n        <span class=\"n\">docker_secret</span> <span class=\"o\">=</span> <span class=\"n\">config</span><span class=\"o\">.</span><span class=\"n\">get</span><span class=\"p\">(</span><span class=\"s2\">&quot;docker_secret&quot;</span><span class=\"p\">)</span>\n        <span class=\"k\">if</span> <span class=\"n\">docker_secret</span><span class=\"p\">:</span>\n            <span class=\"k\">if</span> <span class=\"nb\">isinstance</span><span class=\"p\">(</span><span class=\"n\">docker_secret</span><span class=\"p\">,</span> <span class=\"n\">Dict</span><span class=\"p\">):</span>\n                <span class=\"kn\">from</span> <span class=\"nn\">runhouse.resources.secrets.secret</span> <span class=\"kn\">import</span> <span class=\"n\">Secret</span>\n\n                <span class=\"n\">docker_secret</span> <span class=\"o\">=</span> <span class=\"n\">Secret</span><span class=\"o\">.</span><span class=\"n\">from_config</span><span class=\"p\">(</span><span class=\"n\">docker_secret</span><span class=\"p\">)</span>\n            <span class=\"n\">img</span><span class=\"o\">.</span><span class=\"n\">docker_secret</span> <span class=\"o\">=</span> <span class=\"n\">docker_secret</span>\n        <span class=\"n\">img</span><span class=\"o\">.</span><span class=\"n\">conda_env_name</span> <span class=\"o\">=</span> <span class=\"n\">config</span><span class=\"o\">.</span><span class=\"n\">get</span><span class=\"p\">(</span><span class=\"s2\">&quot;conda_env_name&quot;</span><span class=\"p\">)</span>\n        <span class=\"n\">img</span><span class=\"o\">.</span><span class=\"n\">venv_path</span> <span class=\"o\">=</span> <span class=\"n\">config</span><span class=\"o\">.</span><span class=\"n\">get</span><span class=\"p\">(</span><span class=\"s2\">&quot;venv_path&quot;</span><span class=\"p\">)</span>\n\n        <span class=\"k\">return</span> <span class=\"n\">img</span>\n\n    <span class=\"c1\">########################################################</span>\n    <span class=\"c1\"># Steps to build the image</span>\n    <span class=\"c1\">########################################################</span>\n\n<div class=\"viewcode-block\" id=\"Image.install_packages\"><a class=\"viewcode-back\" href=\"../../../../../api/python/image/#runhouse.Image.install_packages\">[docs]</a>    <span class=\"k\">def</span> <span class=\"nf\">install_packages</span><span class=\"p\">(</span>\n        <span class=\"bp\">self</span><span class=\"p\">,</span>\n        <span class=\"n\">reqs</span><span class=\"p\">:</span> <span class=\"n\">List</span><span class=\"p\">[</span><span class=\"n\">Union</span><span class=\"p\">[</span><span class=\"s2\">&quot;Package&quot;</span><span class=\"p\">,</span> <span class=\"nb\">str</span><span class=\"p\">]],</span>\n        <span class=\"n\">conda_env_name</span><span class=\"p\">:</span> <span class=\"n\">Optional</span><span class=\"p\">[</span><span class=\"nb\">str</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"kc\">None</span><span class=\"p\">,</span>\n        <span class=\"n\">venv_path</span><span class=\"p\">:</span> <span class=\"n\">Optional</span><span class=\"p\">[</span><span class=\"nb\">str</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"kc\">None</span><span class=\"p\">,</span>\n    <span class=\"p\">):</span>\n<span class=\"w\">        </span><span class=\"sd\">&quot;&quot;&quot;Install the given packages.</span>\n\n<span class=\"sd\">        Args:</span>\n<span class=\"sd\">            reqs (List[Package or str]): List of packages to install on cluster and env.</span>\n<span class=\"sd\">            conda_env_name (str, optional): Name of conda env to install the package in, if relevant. If left empty,</span>\n<span class=\"sd\">                defaults to base environment. (Default: ``None``)</span>\n<span class=\"sd\">            venv_path (str, optional): Path to venv to install package in. (Default: ``None``)</span>\n<span class=\"sd\">        &quot;&quot;&quot;</span>\n\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">setup_steps</span><span class=\"o\">.</span><span class=\"n\">append</span><span class=\"p\">(</span>\n            <span class=\"n\">ImageSetupStep</span><span class=\"p\">(</span>\n                <span class=\"n\">step_type</span><span class=\"o\">=</span><span class=\"n\">ImageSetupStepType</span><span class=\"o\">.</span><span class=\"n\">PACKAGES</span><span class=\"p\">,</span>\n                <span class=\"n\">reqs</span><span class=\"o\">=</span><span class=\"n\">reqs</span><span class=\"p\">,</span>\n                <span class=\"n\">conda_env_name</span><span class=\"o\">=</span><span class=\"n\">conda_env_name</span> <span class=\"ow\">or</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">conda_env_name</span><span class=\"p\">,</span>\n                <span class=\"n\">venv_path</span><span class=\"o\">=</span><span class=\"n\">venv_path</span> <span class=\"ow\">or</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">venv_path</span><span class=\"p\">,</span>\n            <span class=\"p\">)</span>\n        <span class=\"p\">)</span>\n        <span class=\"k\">return</span> <span class=\"bp\">self</span></div>\n\n<div class=\"viewcode-block\" id=\"Image.pip_install\"><a class=\"viewcode-back\" href=\"../../../../../api/python/image/#runhouse.Image.pip_install\">[docs]</a>    <span class=\"k\">def</span> <span class=\"nf\">pip_install</span><span class=\"p\">(</span>\n        <span class=\"bp\">self</span><span class=\"p\">,</span>\n        <span class=\"n\">reqs</span><span class=\"p\">:</span> <span class=\"n\">List</span><span class=\"p\">[</span><span class=\"n\">Union</span><span class=\"p\">[</span><span class=\"s2\">&quot;Package&quot;</span><span class=\"p\">,</span> <span class=\"nb\">str</span><span class=\"p\">]],</span>\n        <span class=\"n\">conda_env_name</span><span class=\"p\">:</span> <span class=\"n\">Optional</span><span class=\"p\">[</span><span class=\"nb\">str</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"kc\">None</span><span class=\"p\">,</span>\n        <span class=\"n\">venv_path</span><span class=\"p\">:</span> <span class=\"n\">Optional</span><span class=\"p\">[</span><span class=\"nb\">str</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"kc\">None</span><span class=\"p\">,</span>\n    <span class=\"p\">):</span>\n<span class=\"w\">        </span><span class=\"sd\">&quot;&quot;&quot;Pip install the given packages.</span>\n\n<span class=\"sd\">        Args:</span>\n<span class=\"sd\">            reqs (List[Package or str]): List of packages to pip install on cluster and env.</span>\n<span class=\"sd\">            conda_env_name (str, optional): Name of conda env to install the package in, if relevant. If left empty,</span>\n<span class=\"sd\">                defaults to base environment. (Default: ``None``)</span>\n<span class=\"sd\">            venv_path (str, optional): Path to venv to install package in. (Default: ``None``)</span>\n<span class=\"sd\">        &quot;&quot;&quot;</span>\n\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">setup_steps</span><span class=\"o\">.</span><span class=\"n\">append</span><span class=\"p\">(</span>\n            <span class=\"n\">ImageSetupStep</span><span class=\"p\">(</span>\n                <span class=\"n\">step_type</span><span class=\"o\">=</span><span class=\"n\">ImageSetupStepType</span><span class=\"o\">.</span><span class=\"n\">PIP_INSTALL</span><span class=\"p\">,</span>\n                <span class=\"n\">reqs</span><span class=\"o\">=</span><span class=\"n\">reqs</span><span class=\"p\">,</span>\n                <span class=\"n\">conda_env_name</span><span class=\"o\">=</span><span class=\"n\">conda_env_name</span> <span class=\"ow\">or</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">conda_env_name</span><span class=\"p\">,</span>\n                <span class=\"n\">venv_path</span><span class=\"o\">=</span><span class=\"n\">venv_path</span> <span class=\"ow\">or</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">venv_path</span><span class=\"p\">,</span>\n            <span class=\"p\">)</span>\n        <span class=\"p\">)</span>\n        <span class=\"k\">return</span> <span class=\"bp\">self</span></div>\n\n<div class=\"viewcode-block\" id=\"Image.uv_install\"><a class=\"viewcode-back\" href=\"../../../../../api/python/image/#runhouse.Image.uv_install\">[docs]</a>    <span class=\"k\">def</span> <span class=\"nf\">uv_install</span><span class=\"p\">(</span>\n        <span class=\"bp\">self</span><span class=\"p\">,</span>\n        <span class=\"n\">reqs</span><span class=\"p\">:</span> <span class=\"n\">List</span><span class=\"p\">[</span><span class=\"n\">Union</span><span class=\"p\">[</span><span class=\"s2\">&quot;Package&quot;</span><span class=\"p\">,</span> <span class=\"nb\">str</span><span class=\"p\">]],</span>\n        <span class=\"n\">conda_env_name</span><span class=\"p\">:</span> <span class=\"n\">Optional</span><span class=\"p\">[</span><span class=\"nb\">str</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"kc\">None</span><span class=\"p\">,</span>\n        <span class=\"n\">venv_path</span><span class=\"p\">:</span> <span class=\"n\">Optional</span><span class=\"p\">[</span><span class=\"nb\">str</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"kc\">None</span><span class=\"p\">,</span>\n    <span class=\"p\">):</span>\n<span class=\"w\">        </span><span class=\"sd\">&quot;&quot;&quot;Uv pip install the given packages.</span>\n\n<span class=\"sd\">        Args:</span>\n<span class=\"sd\">            reqs (List[Package or str]): List of packages to uv pip install on cluster and env.</span>\n<span class=\"sd\">            conda_env_name (str, optional): Name of conda env to install the package in, if relevant. If left empty,</span>\n<span class=\"sd\">                defaults to base environment. (Default: ``None``)</span>\n<span class=\"sd\">            venv_path (str, optional): Path to venv to install package in. (Default: ``None``)</span>\n<span class=\"sd\">        &quot;&quot;&quot;</span>\n\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">setup_steps</span><span class=\"o\">.</span><span class=\"n\">append</span><span class=\"p\">(</span>\n            <span class=\"n\">ImageSetupStep</span><span class=\"p\">(</span>\n                <span class=\"n\">step_type</span><span class=\"o\">=</span><span class=\"n\">ImageSetupStepType</span><span class=\"o\">.</span><span class=\"n\">UV_INSTALL</span><span class=\"p\">,</span>\n                <span class=\"n\">reqs</span><span class=\"o\">=</span><span class=\"n\">reqs</span><span class=\"p\">,</span>\n                <span class=\"n\">conda_env_name</span><span class=\"o\">=</span><span class=\"n\">conda_env_name</span> <span class=\"ow\">or</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">conda_env_name</span><span class=\"p\">,</span>\n                <span class=\"n\">venv_path</span><span class=\"o\">=</span><span class=\"n\">venv_path</span> <span class=\"ow\">or</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">venv_path</span><span class=\"p\">,</span>\n            <span class=\"p\">)</span>\n        <span class=\"p\">)</span>\n        <span class=\"k\">return</span> <span class=\"bp\">self</span></div>\n\n<div class=\"viewcode-block\" id=\"Image.conda_install\"><a class=\"viewcode-back\" href=\"../../../../../api/python/image/#runhouse.Image.conda_install\">[docs]</a>    <span class=\"k\">def</span> <span class=\"nf\">conda_install</span><span class=\"p\">(</span>\n        <span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">reqs</span><span class=\"p\">:</span> <span class=\"n\">List</span><span class=\"p\">[</span><span class=\"n\">Union</span><span class=\"p\">[</span><span class=\"s2\">&quot;Package&quot;</span><span class=\"p\">,</span> <span class=\"nb\">str</span><span class=\"p\">]],</span> <span class=\"n\">conda_env_name</span><span class=\"p\">:</span> <span class=\"n\">Optional</span><span class=\"p\">[</span><span class=\"nb\">str</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"kc\">None</span>\n    <span class=\"p\">):</span>\n<span class=\"w\">        </span><span class=\"sd\">&quot;&quot;&quot;Conda install the given packages.</span>\n\n<span class=\"sd\">        Args:</span>\n<span class=\"sd\">            reqs (List[Package or str]): List of packages to conda install on cluster and env.</span>\n<span class=\"sd\">            conda_env_name (str, optional): Name of conda env to install the package in, if relevant. If left empty,</span>\n<span class=\"sd\">                defaults to base environment. (Default: ``None``)</span>\n<span class=\"sd\">        &quot;&quot;&quot;</span>\n\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">setup_steps</span><span class=\"o\">.</span><span class=\"n\">append</span><span class=\"p\">(</span>\n            <span class=\"n\">ImageSetupStep</span><span class=\"p\">(</span>\n                <span class=\"n\">step_type</span><span class=\"o\">=</span><span class=\"n\">ImageSetupStepType</span><span class=\"o\">.</span><span class=\"n\">CONDA_INSTALL</span><span class=\"p\">,</span>\n                <span class=\"n\">reqs</span><span class=\"o\">=</span><span class=\"n\">reqs</span><span class=\"p\">,</span>\n                <span class=\"n\">conda_env_name</span><span class=\"o\">=</span><span class=\"n\">conda_env_name</span> <span class=\"ow\">or</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">conda_env_name</span><span class=\"p\">,</span>\n            <span class=\"p\">)</span>\n        <span class=\"p\">)</span>\n        <span class=\"k\">return</span> <span class=\"bp\">self</span></div>\n\n<div class=\"viewcode-block\" id=\"Image.sync_package\"><a class=\"viewcode-back\" href=\"../../../../../api/python/image/#runhouse.Image.sync_package\">[docs]</a>    <span class=\"k\">def</span> <span class=\"nf\">sync_package</span><span class=\"p\">(</span>\n        <span class=\"bp\">self</span><span class=\"p\">,</span>\n        <span class=\"n\">package</span><span class=\"p\">:</span> <span class=\"n\">Union</span><span class=\"p\">[</span><span class=\"s2\">&quot;Package&quot;</span><span class=\"p\">,</span> <span class=\"nb\">str</span><span class=\"p\">],</span>\n    <span class=\"p\">):</span>\n<span class=\"w\">        </span><span class=\"sd\">&quot;&quot;&quot;Sync local package over, and add to path.</span>\n\n<span class=\"sd\">        Args:</span>\n<span class=\"sd\">            package (Package or str): Package to sync. Either the name of a local editably installed package, or</span>\n<span class=\"sd\">                the path to the folder to sync over.</span>\n<span class=\"sd\">        &quot;&quot;&quot;</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">setup_steps</span><span class=\"o\">.</span><span class=\"n\">append</span><span class=\"p\">(</span>\n            <span class=\"n\">ImageSetupStep</span><span class=\"p\">(</span>\n                <span class=\"n\">step_type</span><span class=\"o\">=</span><span class=\"n\">ImageSetupStepType</span><span class=\"o\">.</span><span class=\"n\">SYNC_PACKAGE</span><span class=\"p\">,</span>\n                <span class=\"n\">package</span><span class=\"o\">=</span><span class=\"n\">package</span><span class=\"p\">,</span>\n            <span class=\"p\">)</span>\n        <span class=\"p\">)</span>\n        <span class=\"k\">return</span> <span class=\"bp\">self</span></div>\n\n<div class=\"viewcode-block\" id=\"Image.run_bash\"><a class=\"viewcode-back\" href=\"../../../../../api/python/image/#runhouse.Image.run_bash\">[docs]</a>    <span class=\"k\">def</span> <span class=\"nf\">run_bash</span><span class=\"p\">(</span>\n        <span class=\"bp\">self</span><span class=\"p\">,</span>\n        <span class=\"n\">command</span><span class=\"p\">:</span> <span class=\"nb\">str</span><span class=\"p\">,</span>\n        <span class=\"n\">conda_env_name</span><span class=\"p\">:</span> <span class=\"n\">Optional</span><span class=\"p\">[</span><span class=\"nb\">str</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"kc\">None</span><span class=\"p\">,</span>\n        <span class=\"n\">venv_path</span><span class=\"p\">:</span> <span class=\"n\">Optional</span><span class=\"p\">[</span><span class=\"nb\">str</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"kc\">None</span><span class=\"p\">,</span>\n    <span class=\"p\">):</span>\n<span class=\"w\">        </span><span class=\"sd\">&quot;&quot;&quot;Run bash commands.</span>\n\n<span class=\"sd\">        Args:</span>\n<span class=\"sd\">            command (str): Commands to run on the cluster.</span>\n<span class=\"sd\">            conda_env_name (str, optional): Name of conda env to run the command in, if applicable. (Defaut: ``None``)</span>\n<span class=\"sd\">        &quot;&quot;&quot;</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">setup_steps</span><span class=\"o\">.</span><span class=\"n\">append</span><span class=\"p\">(</span>\n            <span class=\"n\">ImageSetupStep</span><span class=\"p\">(</span>\n                <span class=\"n\">step_type</span><span class=\"o\">=</span><span class=\"n\">ImageSetupStepType</span><span class=\"o\">.</span><span class=\"n\">CMD_RUN</span><span class=\"p\">,</span>\n                <span class=\"n\">command</span><span class=\"o\">=</span><span class=\"n\">command</span><span class=\"p\">,</span>\n                <span class=\"n\">conda_env_name</span><span class=\"o\">=</span><span class=\"n\">conda_env_name</span> <span class=\"ow\">or</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">conda_env_name</span><span class=\"p\">,</span>\n                <span class=\"n\">venv_path</span><span class=\"o\">=</span><span class=\"n\">venv_path</span> <span class=\"ow\">or</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">venv_path</span><span class=\"p\">,</span>\n            <span class=\"p\">)</span>\n        <span class=\"p\">)</span>\n        <span class=\"k\">return</span> <span class=\"bp\">self</span></div>\n\n<div class=\"viewcode-block\" id=\"Image.setup_conda_env\"><a class=\"viewcode-back\" href=\"../../../../../api/python/image/#runhouse.Image.setup_conda_env\">[docs]</a>    <span class=\"k\">def</span> <span class=\"nf\">setup_conda_env</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">conda_env_name</span><span class=\"p\">:</span> <span class=\"nb\">str</span><span class=\"p\">,</span> <span class=\"n\">conda_config</span><span class=\"p\">:</span> <span class=\"n\">Union</span><span class=\"p\">[</span><span class=\"nb\">str</span><span class=\"p\">,</span> <span class=\"n\">Dict</span><span class=\"p\">]):</span>\n<span class=\"w\">        </span><span class=\"sd\">&quot;&quot;&quot;Setup Conda env</span>\n\n<span class=\"sd\">        Args:</span>\n<span class=\"sd\">            conda_env_name (str): Name of conda env to create.</span>\n<span class=\"sd\">            conda_config (str or Dict): Path or Dict referring to the conda yaml config to use to create the conda env.</span>\n<span class=\"sd\">        &quot;&quot;&quot;</span>\n        <span class=\"k\">if</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">venv_path</span><span class=\"p\">:</span>\n            <span class=\"k\">raise</span> <span class=\"ne\">ValueError</span><span class=\"p\">(</span>\n                <span class=\"s2\">&quot;Venv is already set. Can not activate both venv and conda environment.&quot;</span>\n            <span class=\"p\">)</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">setup_steps</span><span class=\"o\">.</span><span class=\"n\">append</span><span class=\"p\">(</span>\n            <span class=\"n\">ImageSetupStep</span><span class=\"p\">(</span>\n                <span class=\"n\">step_type</span><span class=\"o\">=</span><span class=\"n\">ImageSetupStepType</span><span class=\"o\">.</span><span class=\"n\">SETUP_CONDA_ENV</span><span class=\"p\">,</span>\n                <span class=\"n\">conda_env_name</span><span class=\"o\">=</span><span class=\"n\">conda_env_name</span><span class=\"p\">,</span>\n                <span class=\"n\">conda_config</span><span class=\"o\">=</span><span class=\"n\">conda_config</span><span class=\"p\">,</span>\n            <span class=\"p\">)</span>\n        <span class=\"p\">)</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">conda_env_name</span> <span class=\"o\">=</span> <span class=\"n\">conda_env_name</span>\n        <span class=\"k\">return</span> <span class=\"bp\">self</span></div>\n\n<div class=\"viewcode-block\" id=\"Image.set_venv\"><a class=\"viewcode-back\" href=\"../../../../../api/python/image/#runhouse.Image.set_venv\">[docs]</a>    <span class=\"k\">def</span> <span class=\"nf\">set_venv</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">venv_path</span><span class=\"p\">:</span> <span class=\"nb\">str</span><span class=\"p\">):</span>\n<span class=\"w\">        </span><span class=\"sd\">&quot;&quot;&quot;Set the venv to use.</span>\n\n<span class=\"sd\">        Args:</span>\n<span class=\"sd\">            venv_path (str): Path of venv on the cluster to use for Runhouse.</span>\n<span class=\"sd\">        &quot;&quot;&quot;</span>\n        <span class=\"k\">if</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">conda_env_name</span><span class=\"p\">:</span>\n            <span class=\"k\">raise</span> <span class=\"ne\">ValueError</span><span class=\"p\">(</span>\n                <span class=\"s2\">&quot;Conda env is already set. Can not activate both venv path and conda environment.&quot;</span>\n            <span class=\"p\">)</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">setup_steps</span><span class=\"o\">.</span><span class=\"n\">append</span><span class=\"p\">(</span>\n            <span class=\"n\">ImageSetupStep</span><span class=\"p\">(</span>\n                <span class=\"n\">step_type</span><span class=\"o\">=</span><span class=\"n\">ImageSetupStepType</span><span class=\"o\">.</span><span class=\"n\">SET_VENV</span><span class=\"p\">,</span>\n                <span class=\"n\">venv_path</span><span class=\"o\">=</span><span class=\"n\">venv_path</span><span class=\"p\">,</span>\n            <span class=\"p\">)</span>\n        <span class=\"p\">)</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">venv_path</span> <span class=\"o\">=</span> <span class=\"n\">venv_path</span>\n        <span class=\"k\">return</span> <span class=\"bp\">self</span></div>\n\n<div class=\"viewcode-block\" id=\"Image.rsync\"><a class=\"viewcode-back\" href=\"../../../../../api/python/image/#runhouse.Image.rsync\">[docs]</a>    <span class=\"k\">def</span> <span class=\"nf\">rsync</span><span class=\"p\">(</span>\n        <span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">source</span><span class=\"p\">:</span> <span class=\"nb\">str</span><span class=\"p\">,</span> <span class=\"n\">dest</span><span class=\"p\">:</span> <span class=\"nb\">str</span><span class=\"p\">,</span> <span class=\"n\">contents</span><span class=\"p\">:</span> <span class=\"nb\">bool</span> <span class=\"o\">=</span> <span class=\"kc\">False</span><span class=\"p\">,</span> <span class=\"n\">filter_options</span><span class=\"p\">:</span> <span class=\"nb\">str</span> <span class=\"o\">=</span> <span class=\"kc\">None</span>\n    <span class=\"p\">):</span>\n<span class=\"w\">        </span><span class=\"sd\">&quot;&quot;&quot;Sync the contents of the source directory into the destination.</span>\n\n<span class=\"sd\">        Args:</span>\n<span class=\"sd\">            source (str): The source path.</span>\n<span class=\"sd\">            dest (str): The target path.</span>\n<span class=\"sd\">            contents (bool, optional): Whether the contents of the source directory or the directory</span>\n<span class=\"sd\">                itself should be copied to destination.</span>\n<span class=\"sd\">                If ``True`` the contents of the source directory are copied to the destination, and the source</span>\n<span class=\"sd\">                directory itself is not created at the destination.</span>\n<span class=\"sd\">                If ``False`` the source directory along with its contents are copied ot the destination, creating</span>\n<span class=\"sd\">                an additional directory layer at the destination. (Default: ``False``).</span>\n<span class=\"sd\">            filter_options (str, optional): The filter options for rsync.</span>\n<span class=\"sd\">        &quot;&quot;&quot;</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">setup_steps</span><span class=\"o\">.</span><span class=\"n\">append</span><span class=\"p\">(</span>\n            <span class=\"n\">ImageSetupStep</span><span class=\"p\">(</span>\n                <span class=\"n\">step_type</span><span class=\"o\">=</span><span class=\"n\">ImageSetupStepType</span><span class=\"o\">.</span><span class=\"n\">RSYNC</span><span class=\"p\">,</span>\n                <span class=\"n\">source</span><span class=\"o\">=</span><span class=\"n\">source</span><span class=\"p\">,</span>\n                <span class=\"n\">dest</span><span class=\"o\">=</span><span class=\"n\">dest</span><span class=\"p\">,</span>\n                <span class=\"n\">contents</span><span class=\"o\">=</span><span class=\"n\">contents</span><span class=\"p\">,</span>\n                <span class=\"n\">filter_options</span><span class=\"o\">=</span><span class=\"n\">filter_options</span><span class=\"p\">,</span>\n            <span class=\"p\">)</span>\n        <span class=\"p\">)</span></div>\n\n<div class=\"viewcode-block\" id=\"Image.sync_secrets\"><a class=\"viewcode-back\" href=\"../../../../../api/python/image/#runhouse.Image.sync_secrets\">[docs]</a>    <span class=\"k\">def</span> <span class=\"nf\">sync_secrets</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">providers</span><span class=\"p\">:</span> <span class=\"n\">List</span><span class=\"p\">[</span><span class=\"n\">Union</span><span class=\"p\">[</span><span class=\"nb\">str</span><span class=\"p\">,</span> <span class=\"s2\">&quot;Secret&quot;</span><span class=\"p\">]]):</span>\n<span class=\"w\">        </span><span class=\"sd\">&quot;&quot;&quot;Send secrets for the given providers.</span>\n\n<span class=\"sd\">        Args:</span>\n<span class=\"sd\">            providers (List[str or Secret]): List of providers to send secrets for.</span>\n<span class=\"sd\">        &quot;&quot;&quot;</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">setup_steps</span><span class=\"o\">.</span><span class=\"n\">append</span><span class=\"p\">(</span>\n            <span class=\"n\">ImageSetupStep</span><span class=\"p\">(</span>\n                <span class=\"n\">step_type</span><span class=\"o\">=</span><span class=\"n\">ImageSetupStepType</span><span class=\"o\">.</span><span class=\"n\">SYNC_SECRETS</span><span class=\"p\">,</span>\n                <span class=\"n\">providers</span><span class=\"o\">=</span><span class=\"n\">providers</span><span class=\"p\">,</span>\n            <span class=\"p\">)</span>\n        <span class=\"p\">)</span>\n        <span class=\"k\">return</span> <span class=\"bp\">self</span></div>\n\n<div class=\"viewcode-block\" id=\"Image.set_env_vars\"><a class=\"viewcode-back\" href=\"../../../../../api/python/image/#runhouse.Image.set_env_vars\">[docs]</a>    <span class=\"k\">def</span> <span class=\"nf\">set_env_vars</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">env_vars</span><span class=\"p\">:</span> <span class=\"n\">Union</span><span class=\"p\">[</span><span class=\"nb\">str</span><span class=\"p\">,</span> <span class=\"n\">Dict</span><span class=\"p\">]):</span>\n<span class=\"w\">        </span><span class=\"sd\">&quot;&quot;&quot;Set environment variables.</span>\n\n<span class=\"sd\">        Args:</span>\n<span class=\"sd\">            env_vars (str or Dict): Dict of environment variables and values to set, or string pointing</span>\n<span class=\"sd\">                to local ``.env`` file consisting of env vars to set.</span>\n<span class=\"sd\">        &quot;&quot;&quot;</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">setup_steps</span><span class=\"o\">.</span><span class=\"n\">append</span><span class=\"p\">(</span>\n            <span class=\"n\">ImageSetupStep</span><span class=\"p\">(</span>\n                <span class=\"n\">step_type</span><span class=\"o\">=</span><span class=\"n\">ImageSetupStepType</span><span class=\"o\">.</span><span class=\"n\">SET_ENV_VARS</span><span class=\"p\">,</span>\n                <span class=\"n\">env_vars</span><span class=\"o\">=</span><span class=\"n\">env_vars</span><span class=\"p\">,</span>\n            <span class=\"p\">)</span>\n        <span class=\"p\">)</span>\n        <span class=\"k\">return</span> <span class=\"bp\">self</span></div></div>\n</pre></div>", "current_page_name": "_modules/runhouse/resources/images/image", "sidebars": ["about.html", "navigation.html", "relations.html", "searchbox.html", "donate.html"], "customsidebar": null, "alabaster_version": "0.7.16", "alabaster_version_info": [0, 7, 16]}