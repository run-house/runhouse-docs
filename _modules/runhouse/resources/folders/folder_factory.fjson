{"parents": [{"link": "../../../../", "title": "Module code"}], "title": "runhouse.resources.folders.folder_factory", "body": "<h1>Source code for runhouse.resources.folders.folder_factory</h1><div class=\"highlight\"><pre>\n<span></span><span class=\"kn\">import</span> <span class=\"nn\">logging</span>\n<span class=\"kn\">from</span> <span class=\"nn\">pathlib</span> <span class=\"kn\">import</span> <span class=\"n\">Path</span>\n<span class=\"kn\">from</span> <span class=\"nn\">typing</span> <span class=\"kn\">import</span> <span class=\"n\">Dict</span><span class=\"p\">,</span> <span class=\"n\">Optional</span><span class=\"p\">,</span> <span class=\"n\">Union</span>\n\n<span class=\"kn\">import</span> <span class=\"nn\">fsspec</span>\n\n<span class=\"kn\">from</span> <span class=\"nn\">runhouse.resources.folders.folder</span> <span class=\"kn\">import</span> <span class=\"n\">Folder</span>\n<span class=\"kn\">from</span> <span class=\"nn\">runhouse.resources.hardware.utils</span> <span class=\"kn\">import</span> <span class=\"n\">_get_cluster_from</span>\n<span class=\"kn\">from</span> <span class=\"nn\">runhouse.resources.resource</span> <span class=\"kn\">import</span> <span class=\"n\">Resource</span>\n\n<span class=\"n\">logger</span> <span class=\"o\">=</span> <span class=\"n\">logging</span><span class=\"o\">.</span><span class=\"n\">getLogger</span><span class=\"p\">(</span><span class=\"vm\">__name__</span><span class=\"p\">)</span>\n\n\n<div class=\"viewcode-block\" id=\"folder\"><a class=\"viewcode-back\" href=\"../../../../../api/python/folder/#runhouse.folder\">[docs]</a><span class=\"k\">def</span> <span class=\"nf\">folder</span><span class=\"p\">(</span>\n    <span class=\"n\">name</span><span class=\"p\">:</span> <span class=\"n\">Optional</span><span class=\"p\">[</span><span class=\"nb\">str</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"kc\">None</span><span class=\"p\">,</span>\n    <span class=\"n\">path</span><span class=\"p\">:</span> <span class=\"n\">Optional</span><span class=\"p\">[</span><span class=\"n\">Union</span><span class=\"p\">[</span><span class=\"nb\">str</span><span class=\"p\">,</span> <span class=\"n\">Path</span><span class=\"p\">]]</span> <span class=\"o\">=</span> <span class=\"kc\">None</span><span class=\"p\">,</span>\n    <span class=\"n\">system</span><span class=\"p\">:</span> <span class=\"n\">Optional</span><span class=\"p\">[</span><span class=\"n\">Union</span><span class=\"p\">[</span><span class=\"nb\">str</span><span class=\"p\">,</span> <span class=\"s2\">&quot;Cluster&quot;</span><span class=\"p\">]]</span> <span class=\"o\">=</span> <span class=\"kc\">None</span><span class=\"p\">,</span>\n    <span class=\"n\">dryrun</span><span class=\"p\">:</span> <span class=\"nb\">bool</span> <span class=\"o\">=</span> <span class=\"kc\">False</span><span class=\"p\">,</span>\n    <span class=\"n\">local_mount</span><span class=\"p\">:</span> <span class=\"nb\">bool</span> <span class=\"o\">=</span> <span class=\"kc\">False</span><span class=\"p\">,</span>\n    <span class=\"n\">data_config</span><span class=\"p\">:</span> <span class=\"n\">Optional</span><span class=\"p\">[</span><span class=\"n\">Dict</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"kc\">None</span><span class=\"p\">,</span>\n<span class=\"p\">)</span> <span class=\"o\">-&gt;</span> <span class=\"n\">Folder</span><span class=\"p\">:</span>\n<span class=\"w\">    </span><span class=\"sd\">&quot;&quot;&quot;Creates a Runhouse folder object, which can be used to interact with the folder at the given path.</span>\n\n<span class=\"sd\">    Args:</span>\n<span class=\"sd\">        name (Optional[str]): Name to give the folder, to be re-used later on.</span>\n<span class=\"sd\">        path (Optional[str or Path]): Path (or path) that the folder is located at.</span>\n<span class=\"sd\">        system (Optional[str or Cluster]): File system or cluster name. If providing a file system this must be one of:</span>\n<span class=\"sd\">            [``file``, ``github``, ``sftp``, ``ssh``, ``s3``, ``gs``, ``azure``].</span>\n<span class=\"sd\">            We are working to add additional file system support.</span>\n<span class=\"sd\">        dryrun (bool): Whether to create the Folder if it doesn&#39;t exist, or load a Folder object as a dryrun.</span>\n<span class=\"sd\">            (Default: ``False``)</span>\n<span class=\"sd\">        local_mount (bool): Whether or not to mount the folder locally. (Default: ``False``)</span>\n<span class=\"sd\">        data_config (Optional[Dict]): The data config to pass to the underlying fsspec handler.</span>\n\n<span class=\"sd\">    Returns:</span>\n<span class=\"sd\">        Folder: The resulting folder.</span>\n\n<span class=\"sd\">    Example:</span>\n<span class=\"sd\">        &gt;&gt;&gt; import runhouse as rh</span>\n<span class=\"sd\">        &gt;&gt;&gt; rh.folder(name=&#39;training_imgs&#39;, path=&#39;remote_directory/images&#39;, system=&#39;s3&#39;).save()</span>\n\n<span class=\"sd\">        &gt;&gt;&gt; # Load folder from above</span>\n<span class=\"sd\">        &gt;&gt;&gt; reloaded_folder = rh.folder(name=&quot;training_imgs&quot;)</span>\n<span class=\"sd\">    &quot;&quot;&quot;</span>\n    <span class=\"c1\"># TODO [DG] Include loud warning that relative paths are relative to the git root / working directory!</span>\n\n    <span class=\"k\">if</span> <span class=\"n\">name</span> <span class=\"ow\">and</span> <span class=\"ow\">not</span> <span class=\"nb\">any</span><span class=\"p\">([</span><span class=\"n\">path</span><span class=\"p\">,</span> <span class=\"n\">system</span><span class=\"p\">,</span> <span class=\"n\">local_mount</span><span class=\"p\">,</span> <span class=\"n\">data_config</span><span class=\"p\">]):</span>\n        <span class=\"c1\"># If only the name is provided</span>\n        <span class=\"k\">try</span><span class=\"p\">:</span>\n            <span class=\"k\">return</span> <span class=\"n\">Folder</span><span class=\"o\">.</span><span class=\"n\">from_name</span><span class=\"p\">(</span><span class=\"n\">name</span><span class=\"p\">,</span> <span class=\"n\">dryrun</span><span class=\"p\">)</span>\n        <span class=\"k\">except</span> <span class=\"ne\">ValueError</span><span class=\"p\">:</span>\n            <span class=\"c1\"># This is a rare instance where passing no constructor params is actually valid (anonymous folder),</span>\n            <span class=\"c1\"># so if we don&#39;t find the name, the user may still actually want to create a new folder.</span>\n            <span class=\"k\">pass</span>\n\n    <span class=\"n\">system</span> <span class=\"o\">=</span> <span class=\"n\">system</span> <span class=\"ow\">or</span> <span class=\"n\">Folder</span><span class=\"o\">.</span><span class=\"n\">DEFAULT_FS</span>\n    <span class=\"k\">if</span> <span class=\"n\">system</span> <span class=\"o\">==</span> <span class=\"s2\">&quot;s3&quot;</span><span class=\"p\">:</span>\n        <span class=\"kn\">from</span> <span class=\"nn\">.s3_folder</span> <span class=\"kn\">import</span> <span class=\"n\">S3Folder</span>\n\n        <span class=\"k\">return</span> <span class=\"n\">S3Folder</span><span class=\"p\">(</span>\n            <span class=\"n\">system</span><span class=\"o\">=</span><span class=\"n\">system</span><span class=\"p\">,</span>\n            <span class=\"n\">path</span><span class=\"o\">=</span><span class=\"n\">path</span><span class=\"p\">,</span>\n            <span class=\"n\">data_config</span><span class=\"o\">=</span><span class=\"n\">data_config</span><span class=\"p\">,</span>\n            <span class=\"n\">local_mount</span><span class=\"o\">=</span><span class=\"n\">local_mount</span><span class=\"p\">,</span>\n            <span class=\"n\">name</span><span class=\"o\">=</span><span class=\"n\">name</span><span class=\"p\">,</span>\n            <span class=\"n\">dryrun</span><span class=\"o\">=</span><span class=\"n\">dryrun</span><span class=\"p\">,</span>\n        <span class=\"p\">)</span>\n    <span class=\"k\">elif</span> <span class=\"n\">system</span> <span class=\"o\">==</span> <span class=\"s2\">&quot;gs&quot;</span><span class=\"p\">:</span>\n        <span class=\"kn\">from</span> <span class=\"nn\">.gcs_folder</span> <span class=\"kn\">import</span> <span class=\"n\">GCSFolder</span>\n\n        <span class=\"k\">return</span> <span class=\"n\">GCSFolder</span><span class=\"p\">(</span>\n            <span class=\"n\">system</span><span class=\"o\">=</span><span class=\"n\">system</span><span class=\"p\">,</span>\n            <span class=\"n\">path</span><span class=\"o\">=</span><span class=\"n\">path</span><span class=\"p\">,</span>\n            <span class=\"n\">data_config</span><span class=\"o\">=</span><span class=\"n\">data_config</span><span class=\"p\">,</span>\n            <span class=\"n\">local_mount</span><span class=\"o\">=</span><span class=\"n\">local_mount</span><span class=\"p\">,</span>\n            <span class=\"n\">name</span><span class=\"o\">=</span><span class=\"n\">name</span><span class=\"p\">,</span>\n            <span class=\"n\">dryrun</span><span class=\"o\">=</span><span class=\"n\">dryrun</span><span class=\"p\">,</span>\n        <span class=\"p\">)</span>\n    <span class=\"k\">elif</span> <span class=\"n\">system</span> <span class=\"o\">==</span> <span class=\"s2\">&quot;azure&quot;</span><span class=\"p\">:</span>\n        <span class=\"kn\">from</span> <span class=\"nn\">.azure_folder</span> <span class=\"kn\">import</span> <span class=\"n\">AzureFolder</span>\n\n        <span class=\"k\">return</span> <span class=\"n\">AzureFolder</span><span class=\"p\">(</span>\n            <span class=\"n\">system</span><span class=\"o\">=</span><span class=\"n\">system</span><span class=\"p\">,</span>\n            <span class=\"n\">path</span><span class=\"o\">=</span><span class=\"n\">path</span><span class=\"p\">,</span>\n            <span class=\"n\">data_config</span><span class=\"o\">=</span><span class=\"n\">data_config</span><span class=\"p\">,</span>\n            <span class=\"n\">local_mount</span><span class=\"o\">=</span><span class=\"n\">local_mount</span><span class=\"p\">,</span>\n            <span class=\"n\">name</span><span class=\"o\">=</span><span class=\"n\">name</span><span class=\"p\">,</span>\n            <span class=\"n\">dryrun</span><span class=\"o\">=</span><span class=\"n\">dryrun</span><span class=\"p\">,</span>\n        <span class=\"p\">)</span>\n\n    <span class=\"k\">if</span> <span class=\"n\">system</span> <span class=\"ow\">in</span> <span class=\"n\">fsspec</span><span class=\"o\">.</span><span class=\"n\">available_protocols</span><span class=\"p\">():</span>\n        <span class=\"k\">if</span> <span class=\"n\">system</span> <span class=\"ow\">not</span> <span class=\"ow\">in</span> <span class=\"p\">[</span><span class=\"n\">Folder</span><span class=\"o\">.</span><span class=\"n\">DEFAULT_FS</span><span class=\"p\">,</span> <span class=\"s2\">&quot;github&quot;</span><span class=\"p\">,</span> <span class=\"s2\">&quot;sftp&quot;</span><span class=\"p\">,</span> <span class=\"s2\">&quot;ssh&quot;</span><span class=\"p\">]:</span>\n            <span class=\"n\">logger</span><span class=\"o\">.</span><span class=\"n\">warning</span><span class=\"p\">(</span>\n                <span class=\"sa\">f</span><span class=\"s2\">&quot;fsspec file system </span><span class=\"si\">{</span><span class=\"n\">system</span><span class=\"si\">}</span><span class=\"s2\"> not officially supported. Use at your own risk.&quot;</span>\n            <span class=\"p\">)</span>\n        <span class=\"k\">return</span> <span class=\"n\">Folder</span><span class=\"p\">(</span>\n            <span class=\"n\">system</span><span class=\"o\">=</span><span class=\"n\">system</span><span class=\"p\">,</span>\n            <span class=\"n\">path</span><span class=\"o\">=</span><span class=\"n\">path</span><span class=\"p\">,</span>\n            <span class=\"n\">data_config</span><span class=\"o\">=</span><span class=\"n\">data_config</span><span class=\"p\">,</span>\n            <span class=\"n\">local_mount</span><span class=\"o\">=</span><span class=\"n\">local_mount</span><span class=\"p\">,</span>\n            <span class=\"n\">name</span><span class=\"o\">=</span><span class=\"n\">name</span><span class=\"p\">,</span>\n            <span class=\"n\">dryrun</span><span class=\"o\">=</span><span class=\"n\">dryrun</span><span class=\"p\">,</span>\n        <span class=\"p\">)</span>\n\n    <span class=\"n\">cluster_system</span> <span class=\"o\">=</span> <span class=\"n\">_get_cluster_from</span><span class=\"p\">(</span><span class=\"n\">system</span><span class=\"p\">,</span> <span class=\"n\">dryrun</span><span class=\"o\">=</span><span class=\"n\">dryrun</span><span class=\"p\">)</span>\n    <span class=\"k\">if</span> <span class=\"nb\">isinstance</span><span class=\"p\">(</span><span class=\"n\">cluster_system</span><span class=\"p\">,</span> <span class=\"n\">Resource</span><span class=\"p\">):</span>\n        <span class=\"k\">return</span> <span class=\"n\">Folder</span><span class=\"p\">(</span>\n            <span class=\"n\">system</span><span class=\"o\">=</span><span class=\"n\">cluster_system</span><span class=\"p\">,</span>\n            <span class=\"n\">path</span><span class=\"o\">=</span><span class=\"n\">path</span><span class=\"p\">,</span>\n            <span class=\"n\">data_config</span><span class=\"o\">=</span><span class=\"n\">data_config</span><span class=\"p\">,</span>\n            <span class=\"n\">local_mount</span><span class=\"o\">=</span><span class=\"n\">local_mount</span><span class=\"p\">,</span>\n            <span class=\"n\">name</span><span class=\"o\">=</span><span class=\"n\">name</span><span class=\"p\">,</span>\n            <span class=\"n\">dryrun</span><span class=\"o\">=</span><span class=\"n\">dryrun</span><span class=\"p\">,</span>\n        <span class=\"p\">)</span>\n\n    <span class=\"k\">raise</span> <span class=\"ne\">ValueError</span><span class=\"p\">(</span>\n        <span class=\"sa\">f</span><span class=\"s2\">&quot;File system </span><span class=\"si\">{</span><span class=\"n\">system</span><span class=\"si\">}</span><span class=\"s2\"> not found. Have you installed the &quot;</span>\n        <span class=\"sa\">f</span><span class=\"s2\">&quot;necessary packages for this fsspec protocol? (e.g. s3fs for s3). If the file system &quot;</span>\n        <span class=\"sa\">f</span><span class=\"s2\">&quot;is a cluster (ex: /my-user/rh-cpu), make sure the cluster config has been saved.&quot;</span>\n    <span class=\"p\">)</span></div>\n</pre></div>", "current_page_name": "_modules/runhouse/resources/folders/folder_factory", "sidebars": ["about.html", "navigation.html", "relations.html", "searchbox.html", "donate.html"], "customsidebar": null, "favicon_url": null, "logo_url": null, "alabaster_version": "0.7.12"}