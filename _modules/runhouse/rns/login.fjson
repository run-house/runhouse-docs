{"parents": [{"link": "../../../", "title": "Module code"}], "title": "runhouse.rns.login", "body": "<h1>Source code for runhouse.rns.login</h1><div class=\"highlight\"><pre>\n<span></span><span class=\"kn\">import</span> <span class=\"nn\">os</span>\n<span class=\"kn\">from</span> <span class=\"nn\">typing</span> <span class=\"kn\">import</span> <span class=\"n\">Dict</span><span class=\"p\">,</span> <span class=\"n\">Optional</span>\n\n<span class=\"kn\">import</span> <span class=\"nn\">requests</span>\n<span class=\"kn\">import</span> <span class=\"nn\">typer</span>\n\n<span class=\"kn\">from</span> <span class=\"nn\">runhouse.globals</span> <span class=\"kn\">import</span> <span class=\"n\">configs</span><span class=\"p\">,</span> <span class=\"n\">rns_client</span>\n<span class=\"kn\">from</span> <span class=\"nn\">runhouse.logger</span> <span class=\"kn\">import</span> <span class=\"n\">get_logger</span>\n\n<span class=\"n\">logger</span> <span class=\"o\">=</span> <span class=\"n\">get_logger</span><span class=\"p\">(</span><span class=\"vm\">__name__</span><span class=\"p\">)</span>\n\n\n<span class=\"k\">def</span> <span class=\"nf\">is_interactive</span><span class=\"p\">():</span>\n    <span class=\"kn\">import</span> <span class=\"nn\">__main__</span> <span class=\"k\">as</span> <span class=\"nn\">main</span>\n\n    <span class=\"k\">return</span> <span class=\"ow\">not</span> <span class=\"nb\">hasattr</span><span class=\"p\">(</span><span class=\"n\">main</span><span class=\"p\">,</span> <span class=\"s2\">&quot;__file__&quot;</span><span class=\"p\">)</span>\n\n\n<div class=\"viewcode-block\" id=\"login\"><a class=\"viewcode-back\" href=\"../../../../api/python/login/#runhouse.login\">[docs]</a><span class=\"k\">def</span> <span class=\"nf\">login</span><span class=\"p\">(</span>\n    <span class=\"n\">token</span><span class=\"p\">:</span> <span class=\"nb\">str</span> <span class=\"o\">=</span> <span class=\"kc\">None</span><span class=\"p\">,</span>\n    <span class=\"n\">download_config</span><span class=\"p\">:</span> <span class=\"nb\">bool</span> <span class=\"o\">=</span> <span class=\"kc\">None</span><span class=\"p\">,</span>\n    <span class=\"n\">upload_config</span><span class=\"p\">:</span> <span class=\"nb\">bool</span> <span class=\"o\">=</span> <span class=\"kc\">None</span><span class=\"p\">,</span>\n    <span class=\"n\">download_secrets</span><span class=\"p\">:</span> <span class=\"nb\">bool</span> <span class=\"o\">=</span> <span class=\"kc\">None</span><span class=\"p\">,</span>\n    <span class=\"n\">upload_secrets</span><span class=\"p\">:</span> <span class=\"nb\">bool</span> <span class=\"o\">=</span> <span class=\"kc\">None</span><span class=\"p\">,</span>\n    <span class=\"n\">ret_token</span><span class=\"p\">:</span> <span class=\"nb\">bool</span> <span class=\"o\">=</span> <span class=\"kc\">False</span><span class=\"p\">,</span>\n    <span class=\"n\">interactive</span><span class=\"p\">:</span> <span class=\"nb\">bool</span> <span class=\"o\">=</span> <span class=\"kc\">None</span><span class=\"p\">,</span>\n    <span class=\"n\">from_cli</span><span class=\"p\">:</span> <span class=\"nb\">bool</span> <span class=\"o\">=</span> <span class=\"kc\">False</span><span class=\"p\">,</span>\n    <span class=\"n\">sync_secrets</span><span class=\"p\">:</span> <span class=\"nb\">bool</span> <span class=\"o\">=</span> <span class=\"kc\">False</span><span class=\"p\">,</span>\n<span class=\"p\">):</span>\n<span class=\"w\">    </span><span class=\"sd\">&quot;&quot;&quot;Login to Runhouse. Validates token provided, with options to upload or download stored secrets or config between</span>\n<span class=\"sd\">    local environment and Runhouse / Vault.</span>\n\n<span class=\"sd\">    Args:</span>\n<span class=\"sd\">        token (str): Runhouse token, can be found at https://www.run.house/account#token. If not provided, function will</span>\n<span class=\"sd\">            interactively prompt for the token to be entered manually.</span>\n<span class=\"sd\">        download_config (bool): Whether to download configs from your Runhouse account to local environment.</span>\n<span class=\"sd\">        upload_config (bool): Whether to upload local configs into your Runhouse account.</span>\n<span class=\"sd\">        download_secrets (bool): Whether to download secrets from your Runhouse account to local environment.</span>\n<span class=\"sd\">        upload_secrets (bool): Whether to upload local secrets to your Runhouse account.</span>\n<span class=\"sd\">        ret_token (bool): Whether to return your Runhouse token. (Default: False)</span>\n<span class=\"sd\">        interactive (bool): Whether to interactively go through the login flow. ``token`` must be provided to</span>\n<span class=\"sd\">            set this to False.</span>\n\n<span class=\"sd\">    Returns:</span>\n<span class=\"sd\">        Token if ``ret_token`` is set to True, otherwise nothing.</span>\n<span class=\"sd\">    &quot;&quot;&quot;</span>\n    <span class=\"n\">all_options_set</span> <span class=\"o\">=</span> <span class=\"n\">token</span> <span class=\"ow\">and</span> <span class=\"ow\">not</span> <span class=\"nb\">any</span><span class=\"p\">(</span>\n        <span class=\"n\">arg</span> <span class=\"ow\">is</span> <span class=\"kc\">None</span>\n        <span class=\"k\">for</span> <span class=\"n\">arg</span> <span class=\"ow\">in</span> <span class=\"p\">(</span><span class=\"n\">download_config</span><span class=\"p\">,</span> <span class=\"n\">upload_config</span><span class=\"p\">,</span> <span class=\"n\">download_secrets</span><span class=\"p\">,</span> <span class=\"n\">upload_secrets</span><span class=\"p\">)</span>\n    <span class=\"p\">)</span>\n\n    <span class=\"k\">if</span> <span class=\"n\">interactive</span> <span class=\"ow\">is</span> <span class=\"kc\">False</span> <span class=\"ow\">and</span> <span class=\"ow\">not</span> <span class=\"n\">token</span><span class=\"p\">:</span>\n        <span class=\"k\">raise</span> <span class=\"ne\">Exception</span><span class=\"p\">(</span>\n            <span class=\"s2\">&quot;`interactive` can only be set to `False` if token is provided.&quot;</span>\n        <span class=\"p\">)</span>\n\n    <span class=\"k\">if</span> <span class=\"n\">interactive</span> <span class=\"ow\">or</span> <span class=\"p\">(</span><span class=\"n\">interactive</span> <span class=\"ow\">is</span> <span class=\"kc\">None</span> <span class=\"ow\">and</span> <span class=\"ow\">not</span> <span class=\"n\">all_options_set</span><span class=\"p\">):</span>\n        <span class=\"kn\">from</span> <span class=\"nn\">getpass</span> <span class=\"kn\">import</span> <span class=\"n\">getpass</span>\n\n        <span class=\"kn\">from</span> <span class=\"nn\">rich.console</span> <span class=\"kn\">import</span> <span class=\"n\">Console</span>\n\n        <span class=\"n\">console</span> <span class=\"o\">=</span> <span class=\"n\">Console</span><span class=\"p\">()</span>\n        <span class=\"n\">console</span><span class=\"o\">.</span><span class=\"n\">print</span><span class=\"p\">(</span>\n<span class=\"w\">            </span><span class=\"sd\">&quot;&quot;&quot;</span>\n<span class=\"sd\">            ____              __                             @ @ @</span>\n<span class=\"sd\">           / __ \\__  ______  / /_  ____  __  __________     []___</span>\n<span class=\"sd\">          / /_/ / / / / __ \\/ __ \\/ __ \\/ / / / ___/ _ \\   /    /\\____    @@</span>\n<span class=\"sd\">         / _, _/ /_/ / / / / / / / /_/ / /_/ (__  )  __/  /_/\\_//____/\\  @@@@</span>\n<span class=\"sd\">        /_/ |_|\\__,_/_/ /_/_/ /_/\\____/\\__,_/____/\\___/   | || |||__|||   ||</span>\n<span class=\"sd\">        &quot;&quot;&quot;</span>\n        <span class=\"p\">)</span>\n        <span class=\"n\">account_url</span> <span class=\"o\">=</span> <span class=\"sa\">f</span><span class=\"s2\">&quot;</span><span class=\"si\">{</span><span class=\"n\">configs</span><span class=\"o\">.</span><span class=\"n\">get</span><span class=\"p\">(</span><span class=\"s1\">&#39;dashboard_url&#39;</span><span class=\"p\">)</span><span class=\"si\">}</span><span class=\"s2\">/account#token&quot;</span>\n        <span class=\"n\">link</span> <span class=\"o\">=</span> <span class=\"p\">(</span>\n            <span class=\"sa\">f</span><span class=\"s2\">&quot;[link=</span><span class=\"si\">{</span><span class=\"n\">account_url</span><span class=\"si\">}</span><span class=\"s2\">]</span><span class=\"si\">{</span><span class=\"n\">account_url</span><span class=\"si\">}</span><span class=\"s2\">[/link]&quot;</span>\n            <span class=\"k\">if</span> <span class=\"n\">is_interactive</span><span class=\"p\">()</span>\n            <span class=\"k\">else</span> <span class=\"n\">account_url</span>\n        <span class=\"p\">)</span>\n        <span class=\"k\">if</span> <span class=\"ow\">not</span> <span class=\"n\">token</span><span class=\"p\">:</span>\n            <span class=\"n\">console</span><span class=\"o\">.</span><span class=\"n\">print</span><span class=\"p\">(</span>\n                <span class=\"sa\">f</span><span class=\"s2\">&quot;Retrieve your token :key: here to use :person_running: :house: Runhouse for &quot;</span>\n                <span class=\"sa\">f</span><span class=\"s2\">&quot;secrets and artifact management: </span><span class=\"si\">{</span><span class=\"n\">link</span><span class=\"si\">}</span><span class=\"s2\">&quot;</span><span class=\"p\">,</span>\n                <span class=\"n\">style</span><span class=\"o\">=</span><span class=\"s2\">&quot;bold yellow&quot;</span><span class=\"p\">,</span>\n            <span class=\"p\">)</span>\n            <span class=\"n\">token</span> <span class=\"o\">=</span> <span class=\"n\">getpass</span><span class=\"p\">(</span><span class=\"s2\">&quot;Token: &quot;</span><span class=\"p\">)</span>\n\n        <span class=\"n\">rh_config_exists</span> <span class=\"o\">=</span> <span class=\"n\">configs</span><span class=\"o\">.</span><span class=\"n\">CONFIG_PATH</span><span class=\"o\">.</span><span class=\"n\">exists</span><span class=\"p\">()</span>\n        <span class=\"k\">if</span> <span class=\"ow\">not</span> <span class=\"n\">rh_config_exists</span><span class=\"p\">:</span>\n            <span class=\"n\">upload_config</span> <span class=\"o\">=</span> <span class=\"kc\">False</span>\n            <span class=\"n\">download_secrets</span> <span class=\"o\">=</span> <span class=\"kc\">False</span>\n\n        <span class=\"c1\"># download the config automatically if no config.yaml exists</span>\n        <span class=\"n\">download_config</span> <span class=\"o\">=</span> <span class=\"p\">(</span>\n            <span class=\"n\">download_config</span>\n            <span class=\"k\">if</span> <span class=\"n\">download_config</span> <span class=\"ow\">is</span> <span class=\"ow\">not</span> <span class=\"kc\">None</span> <span class=\"ow\">or</span> <span class=\"ow\">not</span> <span class=\"n\">rh_config_exists</span>\n            <span class=\"k\">else</span> <span class=\"n\">typer</span><span class=\"o\">.</span><span class=\"n\">confirm</span><span class=\"p\">(</span>\n                <span class=\"s2\">&quot;Download your Runhouse config to your local .rh folder?&quot;</span><span class=\"p\">,</span>\n                <span class=\"n\">default</span><span class=\"o\">=</span><span class=\"kc\">True</span><span class=\"p\">,</span>\n            <span class=\"p\">)</span>\n        <span class=\"p\">)</span>\n        <span class=\"n\">upload_config</span> <span class=\"o\">=</span> <span class=\"p\">(</span>\n            <span class=\"n\">upload_config</span>\n            <span class=\"k\">if</span> <span class=\"n\">upload_config</span> <span class=\"ow\">is</span> <span class=\"ow\">not</span> <span class=\"kc\">None</span>\n            <span class=\"k\">else</span> <span class=\"n\">typer</span><span class=\"o\">.</span><span class=\"n\">confirm</span><span class=\"p\">(</span><span class=\"s2\">&quot;Upload your local .rh config to Runhouse?&quot;</span><span class=\"p\">)</span>\n        <span class=\"p\">)</span>\n\n        <span class=\"c1\"># Default ssh secret</span>\n        <span class=\"k\">if</span> <span class=\"ow\">not</span> <span class=\"n\">rns_client</span><span class=\"o\">.</span><span class=\"n\">default_ssh_key</span><span class=\"p\">:</span>\n            <span class=\"n\">default_ssh_path</span> <span class=\"o\">=</span> <span class=\"n\">typer</span><span class=\"o\">.</span><span class=\"n\">prompt</span><span class=\"p\">(</span>\n                <span class=\"s2\">&quot;Input the private key path for your default SSH key to use for launching clusters (e.g. ~/.ssh/id_rsa), or press `Enter` to skip&quot;</span><span class=\"p\">,</span>\n                <span class=\"n\">default</span><span class=\"o\">=</span><span class=\"s2\">&quot;&quot;</span><span class=\"p\">,</span>\n            <span class=\"p\">)</span>\n\n            <span class=\"k\">if</span> <span class=\"n\">default_ssh_path</span><span class=\"p\">:</span>\n                <span class=\"kn\">from</span> <span class=\"nn\">runhouse</span> <span class=\"kn\">import</span> <span class=\"n\">provider_secret</span>\n\n                <span class=\"n\">secret</span> <span class=\"o\">=</span> <span class=\"n\">provider_secret</span><span class=\"p\">(</span><span class=\"n\">provider</span><span class=\"o\">=</span><span class=\"s2\">&quot;ssh&quot;</span><span class=\"p\">,</span> <span class=\"n\">path</span><span class=\"o\">=</span><span class=\"n\">default_ssh_path</span><span class=\"p\">)</span>\n                <span class=\"k\">if</span> <span class=\"n\">secret</span><span class=\"o\">.</span><span class=\"n\">values</span><span class=\"p\">:</span>\n                    <span class=\"n\">secret</span><span class=\"o\">.</span><span class=\"n\">save</span><span class=\"p\">()</span>\n                    <span class=\"n\">configs</span><span class=\"o\">.</span><span class=\"n\">set</span><span class=\"p\">(</span><span class=\"s2\">&quot;default_ssh_key&quot;</span><span class=\"p\">,</span> <span class=\"n\">secret</span><span class=\"o\">.</span><span class=\"n\">name</span><span class=\"p\">)</span>\n                <span class=\"k\">else</span><span class=\"p\">:</span>\n                    <span class=\"n\">console</span><span class=\"o\">.</span><span class=\"n\">print</span><span class=\"p\">(</span>\n                        <span class=\"sa\">f</span><span class=\"s2\">&quot;Could not detect SSH key at </span><span class=\"si\">{</span><span class=\"n\">default_ssh_path</span><span class=\"si\">}</span><span class=\"s2\">. Skipping&quot;</span>\n                    <span class=\"p\">)</span>\n\n        <span class=\"k\">if</span> <span class=\"n\">sync_secrets</span><span class=\"p\">:</span>\n            <span class=\"kn\">from</span> <span class=\"nn\">runhouse</span> <span class=\"kn\">import</span> <span class=\"n\">Secret</span>\n\n            <span class=\"k\">if</span> <span class=\"n\">Secret</span><span class=\"o\">.</span><span class=\"n\">vault_secrets</span><span class=\"p\">(</span><span class=\"n\">rns_client</span><span class=\"o\">.</span><span class=\"n\">request_headers</span><span class=\"p\">()):</span>\n                <span class=\"n\">download_secrets</span> <span class=\"o\">=</span> <span class=\"p\">(</span>\n                    <span class=\"n\">download_secrets</span>\n                    <span class=\"k\">if</span> <span class=\"n\">download_secrets</span> <span class=\"ow\">is</span> <span class=\"ow\">not</span> <span class=\"kc\">None</span>\n                    <span class=\"k\">else</span> <span class=\"n\">typer</span><span class=\"o\">.</span><span class=\"n\">confirm</span><span class=\"p\">(</span>\n                        <span class=\"s2\">&quot;Download secrets from Vault to your local Runhouse environment?&quot;</span>\n                    <span class=\"p\">)</span>\n                <span class=\"p\">)</span>\n            <span class=\"n\">upload_secrets</span> <span class=\"o\">=</span> <span class=\"p\">(</span>\n                <span class=\"n\">upload_secrets</span>\n                <span class=\"k\">if</span> <span class=\"n\">upload_secrets</span> <span class=\"ow\">is</span> <span class=\"ow\">not</span> <span class=\"kc\">None</span>\n                <span class=\"k\">else</span> <span class=\"n\">typer</span><span class=\"o\">.</span><span class=\"n\">confirm</span><span class=\"p\">(</span>\n                    <span class=\"s2\">&quot;Upload your local enabled provider secrets to Vault?&quot;</span>\n                <span class=\"p\">)</span>\n            <span class=\"p\">)</span>\n\n    <span class=\"k\">if</span> <span class=\"n\">token</span><span class=\"p\">:</span>\n        <span class=\"c1\"># Note, this is to explicitly add it to the config file, as opposed to setting in python</span>\n        <span class=\"c1\"># via configs.token = token</span>\n        <span class=\"n\">configs</span><span class=\"o\">.</span><span class=\"n\">set</span><span class=\"p\">(</span><span class=\"s2\">&quot;token&quot;</span><span class=\"p\">,</span> <span class=\"n\">token</span><span class=\"p\">)</span>\n\n    <span class=\"k\">if</span> <span class=\"n\">download_config</span><span class=\"p\">:</span>\n        <span class=\"n\">configs</span><span class=\"o\">.</span><span class=\"n\">download_and_save_defaults</span><span class=\"p\">()</span>\n\n    <span class=\"n\">autostop_mins</span> <span class=\"o\">=</span> <span class=\"n\">configs</span><span class=\"o\">.</span><span class=\"n\">defaults_cache</span><span class=\"o\">.</span><span class=\"n\">get</span><span class=\"p\">(</span><span class=\"s2\">&quot;default_autostop&quot;</span><span class=\"p\">)</span>\n    <span class=\"k\">if</span> <span class=\"n\">autostop_mins</span> <span class=\"ow\">is</span> <span class=\"kc\">None</span><span class=\"p\">:</span>\n        <span class=\"n\">new_autostop_mins</span> <span class=\"o\">=</span> <span class=\"n\">typer</span><span class=\"o\">.</span><span class=\"n\">prompt</span><span class=\"p\">(</span>\n            <span class=\"s2\">&quot;Set the default number of minutes of inactivity after which to auto-terminate on-demand clusters. &quot;</span>\n            <span class=\"s2\">&quot;Press `Enter` to set to 60 minutes, or `-1` to disable autostop entirely.&quot;</span><span class=\"p\">,</span>\n            <span class=\"n\">default</span><span class=\"o\">=</span><span class=\"mi\">60</span><span class=\"p\">,</span>\n        <span class=\"p\">)</span>\n        <span class=\"n\">configs</span><span class=\"o\">.</span><span class=\"n\">set</span><span class=\"p\">(</span><span class=\"s2\">&quot;default_autostop&quot;</span><span class=\"p\">,</span> <span class=\"nb\">int</span><span class=\"p\">(</span><span class=\"n\">new_autostop_mins</span><span class=\"p\">))</span>\n\n    <span class=\"k\">if</span> <span class=\"n\">upload_config</span><span class=\"p\">:</span>\n        <span class=\"n\">configs</span><span class=\"o\">.</span><span class=\"n\">load_defaults_from_file</span><span class=\"p\">()</span>\n        <span class=\"n\">configs</span><span class=\"o\">.</span><span class=\"n\">upload_defaults</span><span class=\"p\">(</span><span class=\"n\">defaults</span><span class=\"o\">=</span><span class=\"n\">configs</span><span class=\"o\">.</span><span class=\"n\">defaults_cache</span><span class=\"p\">)</span>\n\n    <span class=\"k\">if</span> <span class=\"ow\">not</span> <span class=\"p\">(</span><span class=\"n\">download_config</span> <span class=\"ow\">or</span> <span class=\"n\">upload_config</span><span class=\"p\">):</span>\n        <span class=\"c1\"># If we are not downloading or uploading config, we still want to make sure the token is valid</span>\n        <span class=\"c1\"># and also download the username and default folder</span>\n        <span class=\"k\">try</span><span class=\"p\">:</span>\n            <span class=\"n\">defaults</span> <span class=\"o\">=</span> <span class=\"n\">configs</span><span class=\"o\">.</span><span class=\"n\">download_defaults</span><span class=\"p\">()</span>\n        <span class=\"k\">except</span><span class=\"p\">:</span>\n            <span class=\"n\">logger</span><span class=\"o\">.</span><span class=\"n\">error</span><span class=\"p\">(</span><span class=\"s2\">&quot;Failed to validate token&quot;</span><span class=\"p\">)</span>\n            <span class=\"k\">return</span> <span class=\"kc\">None</span>\n        <span class=\"n\">configs</span><span class=\"o\">.</span><span class=\"n\">set</span><span class=\"p\">(</span><span class=\"s2\">&quot;username&quot;</span><span class=\"p\">,</span> <span class=\"n\">defaults</span><span class=\"p\">[</span><span class=\"s2\">&quot;username&quot;</span><span class=\"p\">])</span>\n        <span class=\"n\">configs</span><span class=\"o\">.</span><span class=\"n\">set</span><span class=\"p\">(</span><span class=\"s2\">&quot;default_folder&quot;</span><span class=\"p\">,</span> <span class=\"n\">defaults</span><span class=\"p\">[</span><span class=\"s2\">&quot;default_folder&quot;</span><span class=\"p\">])</span>\n\n    <span class=\"k\">if</span> <span class=\"n\">download_secrets</span><span class=\"p\">:</span>\n        <span class=\"n\">_login_download_secrets</span><span class=\"p\">(</span><span class=\"n\">from_cli</span><span class=\"o\">=</span><span class=\"n\">from_cli</span><span class=\"p\">)</span>\n    <span class=\"k\">if</span> <span class=\"n\">upload_secrets</span><span class=\"p\">:</span>\n        <span class=\"n\">_login_upload_secrets</span><span class=\"p\">(</span><span class=\"n\">interactive</span><span class=\"o\">=</span><span class=\"n\">interactive</span><span class=\"p\">)</span>\n\n    <span class=\"n\">logger</span><span class=\"o\">.</span><span class=\"n\">info</span><span class=\"p\">(</span><span class=\"s2\">&quot;Successfully logged into Runhouse.&quot;</span><span class=\"p\">)</span>\n    <span class=\"k\">if</span> <span class=\"n\">ret_token</span><span class=\"p\">:</span>\n        <span class=\"k\">return</span> <span class=\"n\">token</span></div>\n\n\n<span class=\"k\">def</span> <span class=\"nf\">_login_download_secrets</span><span class=\"p\">(</span><span class=\"n\">headers</span><span class=\"p\">:</span> <span class=\"n\">Optional</span><span class=\"p\">[</span><span class=\"nb\">str</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"kc\">None</span><span class=\"p\">,</span> <span class=\"n\">from_cli</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">):</span>\n    <span class=\"kn\">from</span> <span class=\"nn\">runhouse</span> <span class=\"kn\">import</span> <span class=\"n\">Secret</span>\n\n    <span class=\"n\">secrets</span> <span class=\"o\">=</span> <span class=\"n\">Secret</span><span class=\"o\">.</span><span class=\"n\">vault_secrets</span><span class=\"p\">(</span><span class=\"n\">headers</span><span class=\"o\">=</span><span class=\"n\">headers</span> <span class=\"ow\">or</span> <span class=\"n\">rns_client</span><span class=\"o\">.</span><span class=\"n\">request_headers</span><span class=\"p\">())</span>\n    <span class=\"n\">env_secrets</span> <span class=\"o\">=</span> <span class=\"p\">{}</span>\n    <span class=\"k\">for</span> <span class=\"n\">name</span> <span class=\"ow\">in</span> <span class=\"n\">secrets</span><span class=\"p\">:</span>\n        <span class=\"k\">try</span><span class=\"p\">:</span>\n            <span class=\"n\">secret</span> <span class=\"o\">=</span> <span class=\"n\">Secret</span><span class=\"o\">.</span><span class=\"n\">from_name</span><span class=\"p\">(</span><span class=\"n\">name</span><span class=\"p\">)</span>\n            <span class=\"k\">if</span> <span class=\"ow\">not</span> <span class=\"p\">(</span><span class=\"nb\">hasattr</span><span class=\"p\">(</span><span class=\"n\">secret</span><span class=\"p\">,</span> <span class=\"s2\">&quot;path&quot;</span><span class=\"p\">)</span> <span class=\"ow\">or</span> <span class=\"nb\">hasattr</span><span class=\"p\">(</span><span class=\"n\">secret</span><span class=\"p\">,</span> <span class=\"s2\">&quot;env_vars&quot;</span><span class=\"p\">)):</span>\n                <span class=\"k\">continue</span>\n\n            <span class=\"n\">download_path</span> <span class=\"o\">=</span> <span class=\"p\">(</span>\n                <span class=\"n\">secret</span><span class=\"o\">.</span><span class=\"n\">path</span>\n                <span class=\"k\">if</span> <span class=\"n\">secret</span><span class=\"o\">.</span><span class=\"n\">path</span>\n                <span class=\"k\">else</span> <span class=\"sa\">f</span><span class=\"s2\">&quot;</span><span class=\"si\">{</span><span class=\"n\">secret</span><span class=\"o\">.</span><span class=\"n\">_DEFAULT_CREDENTIALS_PATH</span><span class=\"si\">}</span><span class=\"s2\">/</span><span class=\"si\">{</span><span class=\"n\">name</span><span class=\"si\">}</span><span class=\"s2\">&quot;</span>\n                <span class=\"k\">if</span> <span class=\"nb\">hasattr</span><span class=\"p\">(</span><span class=\"n\">secret</span><span class=\"p\">,</span> <span class=\"s2\">&quot;provider&quot;</span><span class=\"p\">)</span> <span class=\"ow\">and</span> <span class=\"n\">secret</span><span class=\"o\">.</span><span class=\"n\">provider</span> <span class=\"o\">==</span> <span class=\"s2\">&quot;ssh&quot;</span>\n                <span class=\"k\">else</span> <span class=\"n\">secret</span><span class=\"o\">.</span><span class=\"n\">_DEFAULT_CREDENTIALS_PATH</span>\n            <span class=\"p\">)</span>\n\n            <span class=\"k\">if</span> <span class=\"n\">download_path</span> <span class=\"ow\">and</span> <span class=\"ow\">not</span> <span class=\"n\">secret</span><span class=\"o\">.</span><span class=\"n\">env_vars</span><span class=\"p\">:</span>\n                <span class=\"n\">logger</span><span class=\"o\">.</span><span class=\"n\">info</span><span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s2\">&quot;Loading down secrets for </span><span class=\"si\">{</span><span class=\"n\">name</span><span class=\"si\">}</span><span class=\"s2\"> into </span><span class=\"si\">{</span><span class=\"n\">download_path</span><span class=\"si\">}</span><span class=\"s2\">&quot;</span><span class=\"p\">)</span>\n                <span class=\"n\">secret</span><span class=\"o\">.</span><span class=\"n\">write</span><span class=\"p\">(</span><span class=\"n\">path</span><span class=\"o\">=</span><span class=\"n\">download_path</span><span class=\"p\">)</span>\n            <span class=\"k\">else</span><span class=\"p\">:</span>\n                <span class=\"n\">env_vars</span> <span class=\"o\">=</span> <span class=\"n\">secret</span><span class=\"o\">.</span><span class=\"n\">env_vars</span> <span class=\"ow\">or</span> <span class=\"n\">secret</span><span class=\"o\">.</span><span class=\"n\">_DEFAULT_ENV_VARS</span>\n                <span class=\"n\">logger</span><span class=\"o\">.</span><span class=\"n\">info</span><span class=\"p\">(</span>\n                    <span class=\"sa\">f</span><span class=\"s2\">&quot;Writing down env secrets for </span><span class=\"si\">{</span><span class=\"n\">name</span><span class=\"si\">}</span><span class=\"s2\"> into </span><span class=\"si\">{</span><span class=\"n\">env_vars</span><span class=\"o\">.</span><span class=\"n\">values</span><span class=\"p\">()</span><span class=\"si\">}</span><span class=\"s2\">&quot;</span>\n                <span class=\"p\">)</span>\n                <span class=\"k\">if</span> <span class=\"ow\">not</span> <span class=\"n\">from_cli</span><span class=\"p\">:</span>\n                    <span class=\"n\">secret</span><span class=\"o\">.</span><span class=\"n\">write</span><span class=\"p\">(</span><span class=\"n\">env</span><span class=\"o\">=</span><span class=\"kc\">True</span><span class=\"p\">)</span>\n                <span class=\"k\">else</span><span class=\"p\">:</span>\n                    <span class=\"k\">for</span> <span class=\"n\">key</span><span class=\"p\">,</span> <span class=\"n\">val</span> <span class=\"ow\">in</span> <span class=\"n\">secret</span><span class=\"o\">.</span><span class=\"n\">values</span><span class=\"o\">.</span><span class=\"n\">items</span><span class=\"p\">():</span>\n                        <span class=\"k\">if</span> <span class=\"n\">key</span> <span class=\"ow\">in</span> <span class=\"n\">env_vars</span><span class=\"p\">:</span>\n                            <span class=\"n\">env_secrets</span><span class=\"o\">.</span><span class=\"n\">update</span><span class=\"p\">({</span><span class=\"n\">env_vars</span><span class=\"p\">[</span><span class=\"n\">key</span><span class=\"p\">]:</span> <span class=\"n\">val</span><span class=\"p\">})</span>\n\n        <span class=\"k\">except</span> <span class=\"ne\">ValueError</span> <span class=\"k\">as</span> <span class=\"n\">e</span><span class=\"p\">:</span>\n            <span class=\"n\">logger</span><span class=\"o\">.</span><span class=\"n\">warning</span><span class=\"p\">(</span>\n                <span class=\"sa\">f</span><span class=\"s2\">&quot;Encountered </span><span class=\"si\">{</span><span class=\"n\">e</span><span class=\"si\">}</span><span class=\"s2\">. Was not able to load down secrets for </span><span class=\"si\">{</span><span class=\"n\">name</span><span class=\"si\">}</span><span class=\"s2\">.&quot;</span>\n            <span class=\"p\">)</span>\n\n    <span class=\"k\">if</span> <span class=\"n\">from_cli</span> <span class=\"ow\">and</span> <span class=\"n\">env_secrets</span><span class=\"p\">:</span>\n        <span class=\"n\">folder</span> <span class=\"o\">=</span> <span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">path</span><span class=\"o\">.</span><span class=\"n\">expanduser</span><span class=\"p\">(</span><span class=\"s2\">&quot;~/.rh/secrets&quot;</span><span class=\"p\">)</span>\n        <span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">makedirs</span><span class=\"p\">(</span><span class=\"n\">folder</span><span class=\"p\">,</span> <span class=\"n\">exist_ok</span><span class=\"o\">=</span><span class=\"kc\">True</span><span class=\"p\">)</span>\n        <span class=\"k\">with</span> <span class=\"nb\">open</span><span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s2\">&quot;</span><span class=\"si\">{</span><span class=\"n\">folder</span><span class=\"si\">}</span><span class=\"s2\">/login.env&quot;</span><span class=\"p\">,</span> <span class=\"s2\">&quot;w&quot;</span><span class=\"p\">)</span> <span class=\"k\">as</span> <span class=\"n\">f</span><span class=\"p\">:</span>\n            <span class=\"k\">for</span> <span class=\"n\">key</span><span class=\"p\">,</span> <span class=\"n\">val</span> <span class=\"ow\">in</span> <span class=\"n\">env_secrets</span><span class=\"o\">.</span><span class=\"n\">items</span><span class=\"p\">():</span>\n                <span class=\"n\">f</span><span class=\"o\">.</span><span class=\"n\">write</span><span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s2\">&quot;</span><span class=\"si\">{</span><span class=\"n\">key</span><span class=\"si\">}</span><span class=\"s2\">=</span><span class=\"si\">{</span><span class=\"n\">val</span><span class=\"si\">}</span><span class=\"se\">\\n</span><span class=\"s2\">&quot;</span><span class=\"p\">)</span>\n        <span class=\"n\">logger</span><span class=\"o\">.</span><span class=\"n\">info</span><span class=\"p\">(</span>\n            <span class=\"s2\">&quot;Env var secrets written down into ~/.rh/secrets/login.env. &quot;</span>\n            <span class=\"s2\">&quot;Please run `source ~/.rh/secrets/login.env` to set the environment variables.&quot;</span>\n        <span class=\"p\">)</span>\n\n\n<span class=\"k\">def</span> <span class=\"nf\">_login_upload_secrets</span><span class=\"p\">(</span><span class=\"n\">interactive</span><span class=\"p\">:</span> <span class=\"nb\">bool</span><span class=\"p\">,</span> <span class=\"n\">headers</span><span class=\"p\">:</span> <span class=\"n\">Optional</span><span class=\"p\">[</span><span class=\"n\">Dict</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"kc\">None</span><span class=\"p\">):</span>\n    <span class=\"kn\">from</span> <span class=\"nn\">runhouse</span> <span class=\"kn\">import</span> <span class=\"n\">Secret</span>\n\n    <span class=\"n\">local_secrets</span> <span class=\"o\">=</span> <span class=\"n\">Secret</span><span class=\"o\">.</span><span class=\"n\">local_secrets</span><span class=\"p\">()</span>\n    <span class=\"n\">provider_secrets</span> <span class=\"o\">=</span> <span class=\"n\">Secret</span><span class=\"o\">.</span><span class=\"n\">extract_provider_secrets</span><span class=\"p\">()</span>\n    <span class=\"n\">local_secrets</span><span class=\"o\">.</span><span class=\"n\">update</span><span class=\"p\">(</span><span class=\"n\">provider_secrets</span><span class=\"p\">)</span>\n    <span class=\"n\">names</span> <span class=\"o\">=</span> <span class=\"nb\">list</span><span class=\"p\">(</span><span class=\"n\">local_secrets</span><span class=\"o\">.</span><span class=\"n\">keys</span><span class=\"p\">())</span>\n\n    <span class=\"k\">for</span> <span class=\"n\">name</span> <span class=\"ow\">in</span> <span class=\"n\">names</span><span class=\"p\">:</span>\n        <span class=\"n\">rns_address</span> <span class=\"o\">=</span> <span class=\"n\">name</span> <span class=\"k\">if</span> <span class=\"s2\">&quot;/&quot;</span> <span class=\"ow\">in</span> <span class=\"n\">name</span> <span class=\"k\">else</span> <span class=\"sa\">f</span><span class=\"s2\">&quot;</span><span class=\"si\">{</span><span class=\"n\">rns_client</span><span class=\"o\">.</span><span class=\"n\">current_folder</span><span class=\"si\">}</span><span class=\"s2\">/</span><span class=\"si\">{</span><span class=\"n\">name</span><span class=\"si\">}</span><span class=\"s2\">&quot;</span>\n        <span class=\"n\">resource_uri</span> <span class=\"o\">=</span> <span class=\"n\">rns_client</span><span class=\"o\">.</span><span class=\"n\">resource_uri</span><span class=\"p\">(</span><span class=\"n\">rns_address</span><span class=\"p\">)</span>\n        <span class=\"n\">resp</span> <span class=\"o\">=</span> <span class=\"n\">requests</span><span class=\"o\">.</span><span class=\"n\">get</span><span class=\"p\">(</span>\n            <span class=\"sa\">f</span><span class=\"s2\">&quot;</span><span class=\"si\">{</span><span class=\"n\">rns_client</span><span class=\"o\">.</span><span class=\"n\">api_server_url</span><span class=\"si\">}</span><span class=\"s2\">/resource/</span><span class=\"si\">{</span><span class=\"n\">resource_uri</span><span class=\"si\">}</span><span class=\"s2\">&quot;</span><span class=\"p\">,</span>\n            <span class=\"n\">headers</span><span class=\"o\">=</span><span class=\"n\">headers</span> <span class=\"ow\">or</span> <span class=\"n\">rns_client</span><span class=\"o\">.</span><span class=\"n\">request_headers</span><span class=\"p\">(),</span>\n        <span class=\"p\">)</span>\n        <span class=\"k\">if</span> <span class=\"n\">resp</span><span class=\"o\">.</span><span class=\"n\">status_code</span> <span class=\"o\">==</span> <span class=\"mi\">200</span><span class=\"p\">:</span>\n            <span class=\"n\">local_secrets</span><span class=\"o\">.</span><span class=\"n\">pop</span><span class=\"p\">(</span><span class=\"n\">name</span><span class=\"p\">,</span> <span class=\"kc\">None</span><span class=\"p\">)</span>\n            <span class=\"k\">continue</span>\n        <span class=\"k\">if</span> <span class=\"n\">interactive</span> <span class=\"ow\">is</span> <span class=\"ow\">not</span> <span class=\"kc\">False</span><span class=\"p\">:</span>\n            <span class=\"n\">upload_secrets</span> <span class=\"o\">=</span> <span class=\"n\">typer</span><span class=\"o\">.</span><span class=\"n\">confirm</span><span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s2\">&quot;Upload secrets for </span><span class=\"si\">{</span><span class=\"n\">name</span><span class=\"si\">}</span><span class=\"s2\">?&quot;</span><span class=\"p\">)</span>\n            <span class=\"k\">if</span> <span class=\"ow\">not</span> <span class=\"n\">upload_secrets</span><span class=\"p\">:</span>\n                <span class=\"n\">local_secrets</span><span class=\"o\">.</span><span class=\"n\">pop</span><span class=\"p\">(</span><span class=\"n\">name</span><span class=\"p\">,</span> <span class=\"kc\">None</span><span class=\"p\">)</span>\n\n    <span class=\"k\">if</span> <span class=\"n\">local_secrets</span><span class=\"p\">:</span>\n        <span class=\"n\">logger</span><span class=\"o\">.</span><span class=\"n\">info</span><span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s2\">&quot;Uploading secrets for </span><span class=\"si\">{</span><span class=\"nb\">list</span><span class=\"p\">(</span><span class=\"n\">local_secrets</span><span class=\"p\">)</span><span class=\"si\">}</span><span class=\"s2\"> to Vault.&quot;</span><span class=\"p\">)</span>\n        <span class=\"k\">for</span> <span class=\"n\">_</span><span class=\"p\">,</span> <span class=\"n\">secret</span> <span class=\"ow\">in</span> <span class=\"n\">local_secrets</span><span class=\"o\">.</span><span class=\"n\">items</span><span class=\"p\">():</span>\n            <span class=\"n\">secret</span><span class=\"o\">.</span><span class=\"n\">save</span><span class=\"p\">(</span><span class=\"n\">save_values</span><span class=\"o\">=</span><span class=\"kc\">True</span><span class=\"p\">)</span>\n\n\n<div class=\"viewcode-block\" id=\"logout\"><a class=\"viewcode-back\" href=\"../../../../api/python/login/#runhouse.logout\">[docs]</a><span class=\"k\">def</span> <span class=\"nf\">logout</span><span class=\"p\">(</span>\n    <span class=\"n\">delete_loaded_secrets</span><span class=\"p\">:</span> <span class=\"nb\">bool</span> <span class=\"o\">=</span> <span class=\"kc\">None</span><span class=\"p\">,</span>\n    <span class=\"n\">delete_rh_config_file</span><span class=\"p\">:</span> <span class=\"nb\">bool</span> <span class=\"o\">=</span> <span class=\"kc\">None</span><span class=\"p\">,</span>\n    <span class=\"n\">interactive</span><span class=\"p\">:</span> <span class=\"nb\">bool</span> <span class=\"o\">=</span> <span class=\"kc\">None</span><span class=\"p\">,</span>\n<span class=\"p\">):</span>\n<span class=\"w\">    </span><span class=\"sd\">&quot;&quot;&quot;</span>\n<span class=\"sd\">    Logout from Runhouse. Provides option to delete credentials from the Runhouse config and the underlying</span>\n<span class=\"sd\">    credentials file. Token is also deleted from the config.</span>\n\n<span class=\"sd\">    Args:</span>\n<span class=\"sd\">        delete_loaded_secrets (bool, optional): If ``True``, deletes the provider credentials file. (Default: ``None``)</span>\n<span class=\"sd\">        delete_rh_config_file (bool, optional): If ``True``, deletes the rh config file. (Default: ``None``)</span>\n<span class=\"sd\">        interactive (bool, optional): If ``True``, runs the logout process in interactive mode. (Default: ``None``)</span>\n\n<span class=\"sd\">    Returns:</span>\n<span class=\"sd\">        None</span>\n<span class=\"sd\">    &quot;&quot;&quot;</span>\n    <span class=\"kn\">from</span> <span class=\"nn\">runhouse.resources.secrets</span> <span class=\"kn\">import</span> <span class=\"n\">Secret</span>\n    <span class=\"kn\">from</span> <span class=\"nn\">runhouse.resources.secrets.provider_secrets.ssh_secret</span> <span class=\"kn\">import</span> <span class=\"n\">SSHSecret</span>\n\n    <span class=\"n\">interactive_session</span><span class=\"p\">:</span> <span class=\"nb\">bool</span> <span class=\"o\">=</span> <span class=\"p\">(</span>\n        <span class=\"n\">interactive</span> <span class=\"k\">if</span> <span class=\"n\">interactive</span> <span class=\"ow\">is</span> <span class=\"ow\">not</span> <span class=\"kc\">None</span> <span class=\"k\">else</span> <span class=\"n\">is_interactive</span><span class=\"p\">()</span>\n    <span class=\"p\">)</span>\n\n    <span class=\"n\">config_secrets</span> <span class=\"o\">=</span> <span class=\"nb\">list</span><span class=\"p\">(</span><span class=\"n\">configs</span><span class=\"o\">.</span><span class=\"n\">get</span><span class=\"p\">(</span><span class=\"s2\">&quot;secrets&quot;</span><span class=\"p\">,</span> <span class=\"p\">{})</span><span class=\"o\">.</span><span class=\"n\">items</span><span class=\"p\">())</span>\n    <span class=\"k\">for</span> <span class=\"p\">(</span><span class=\"n\">name</span><span class=\"p\">,</span> <span class=\"n\">value</span><span class=\"p\">)</span> <span class=\"ow\">in</span> <span class=\"n\">config_secrets</span><span class=\"p\">:</span>\n        <span class=\"k\">try</span><span class=\"p\">:</span>\n            <span class=\"n\">secret</span> <span class=\"o\">=</span> <span class=\"n\">Secret</span><span class=\"o\">.</span><span class=\"n\">from_name</span><span class=\"p\">(</span><span class=\"n\">name</span><span class=\"p\">)</span>\n\n            <span class=\"k\">if</span> <span class=\"nb\">isinstance</span><span class=\"p\">(</span><span class=\"n\">secret</span><span class=\"p\">,</span> <span class=\"n\">SSHSecret</span><span class=\"p\">):</span>\n                <span class=\"n\">logger</span><span class=\"o\">.</span><span class=\"n\">info</span><span class=\"p\">(</span>\n                    <span class=\"s2\">&quot;Automatic deletion for local SSH credentials file is not supported. &quot;</span>\n                    <span class=\"s2\">&quot;Please manually delete it if you would like to remove it&quot;</span>\n                <span class=\"p\">)</span>\n                <span class=\"n\">configs</span><span class=\"o\">.</span><span class=\"n\">delete_provider</span><span class=\"p\">(</span><span class=\"n\">name</span><span class=\"p\">)</span>\n                <span class=\"k\">continue</span>\n        <span class=\"k\">except</span> <span class=\"ne\">ValueError</span><span class=\"p\">:</span>\n            <span class=\"k\">pass</span>\n\n        <span class=\"k\">if</span> <span class=\"n\">interactive_session</span><span class=\"p\">:</span>\n            <span class=\"n\">delete_loaded_secrets</span> <span class=\"o\">=</span> <span class=\"n\">typer</span><span class=\"o\">.</span><span class=\"n\">confirm</span><span class=\"p\">(</span>\n                <span class=\"sa\">f</span><span class=\"s2\">&quot;Delete credentials in </span><span class=\"si\">{</span><span class=\"n\">value</span><span class=\"si\">}</span><span class=\"s2\"> for </span><span class=\"si\">{</span><span class=\"n\">name</span><span class=\"si\">}</span><span class=\"s2\">?&quot;</span>\n            <span class=\"p\">)</span>\n\n        <span class=\"k\">if</span> <span class=\"n\">delete_loaded_secrets</span><span class=\"p\">:</span>\n            <span class=\"k\">if</span> <span class=\"nb\">isinstance</span><span class=\"p\">(</span><span class=\"n\">value</span><span class=\"p\">,</span> <span class=\"nb\">str</span><span class=\"p\">):</span>\n                <span class=\"n\">path</span> <span class=\"o\">=</span> <span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">path</span><span class=\"o\">.</span><span class=\"n\">expanduser</span><span class=\"p\">(</span><span class=\"n\">value</span><span class=\"p\">)</span>\n                <span class=\"k\">if</span> <span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">path</span><span class=\"o\">.</span><span class=\"n\">exists</span><span class=\"p\">(</span><span class=\"n\">path</span><span class=\"p\">):</span>\n                    <span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">remove</span><span class=\"p\">(</span><span class=\"n\">path</span><span class=\"p\">)</span>\n            <span class=\"k\">else</span><span class=\"p\">:</span>  <span class=\"c1\"># list of env variables set</span>\n                <span class=\"k\">for</span> <span class=\"n\">key</span> <span class=\"ow\">in</span> <span class=\"n\">value</span><span class=\"p\">:</span>\n                    <span class=\"k\">del</span> <span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">environ</span><span class=\"p\">[</span><span class=\"n\">key</span><span class=\"p\">]</span>\n\n        <span class=\"n\">configs</span><span class=\"o\">.</span><span class=\"n\">delete_provider</span><span class=\"p\">(</span><span class=\"n\">name</span><span class=\"p\">)</span>\n\n    <span class=\"n\">local_secrets</span> <span class=\"o\">=</span> <span class=\"n\">Secret</span><span class=\"o\">.</span><span class=\"n\">local_secrets</span><span class=\"p\">()</span>\n    <span class=\"k\">for</span> <span class=\"n\">_</span><span class=\"p\">,</span> <span class=\"n\">secret</span> <span class=\"ow\">in</span> <span class=\"n\">local_secrets</span><span class=\"o\">.</span><span class=\"n\">items</span><span class=\"p\">():</span>\n        <span class=\"n\">secret</span><span class=\"o\">.</span><span class=\"n\">delete</span><span class=\"p\">()</span>\n\n    <span class=\"c1\"># Delete token and username/default folder from rh config file</span>\n    <span class=\"n\">configs</span><span class=\"o\">.</span><span class=\"n\">delete</span><span class=\"p\">(</span><span class=\"n\">key</span><span class=\"o\">=</span><span class=\"s2\">&quot;token&quot;</span><span class=\"p\">)</span>\n    <span class=\"n\">configs</span><span class=\"o\">.</span><span class=\"n\">delete</span><span class=\"p\">(</span><span class=\"n\">key</span><span class=\"o\">=</span><span class=\"s2\">&quot;username&quot;</span><span class=\"p\">)</span>\n    <span class=\"n\">configs</span><span class=\"o\">.</span><span class=\"n\">delete</span><span class=\"p\">(</span><span class=\"n\">key</span><span class=\"o\">=</span><span class=\"s2\">&quot;default_folder&quot;</span><span class=\"p\">)</span>\n\n    <span class=\"c1\"># Delete values in configs object</span>\n    <span class=\"n\">configs</span><span class=\"o\">.</span><span class=\"n\">token</span> <span class=\"o\">=</span> <span class=\"kc\">None</span>\n    <span class=\"n\">configs</span><span class=\"o\">.</span><span class=\"n\">username</span> <span class=\"o\">=</span> <span class=\"kc\">None</span>\n    <span class=\"n\">configs</span><span class=\"o\">.</span><span class=\"n\">default_folder</span> <span class=\"o\">=</span> <span class=\"kc\">None</span>\n\n    <span class=\"c1\"># Wipe env vars</span>\n    <span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">environ</span><span class=\"o\">.</span><span class=\"n\">pop</span><span class=\"p\">(</span><span class=\"s2\">&quot;RH_TOKEN&quot;</span><span class=\"p\">,</span> <span class=\"kc\">None</span><span class=\"p\">)</span>\n    <span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">environ</span><span class=\"o\">.</span><span class=\"n\">pop</span><span class=\"p\">(</span><span class=\"s2\">&quot;RH_USERNAME&quot;</span><span class=\"p\">,</span> <span class=\"kc\">None</span><span class=\"p\">)</span>\n\n    <span class=\"n\">rh_config_path</span> <span class=\"o\">=</span> <span class=\"n\">configs</span><span class=\"o\">.</span><span class=\"n\">CONFIG_PATH</span>\n    <span class=\"k\">if</span> <span class=\"ow\">not</span> <span class=\"n\">delete_rh_config_file</span> <span class=\"ow\">and</span> <span class=\"n\">interactive_session</span><span class=\"p\">:</span>\n        <span class=\"n\">delete_rh_config_file</span> <span class=\"o\">=</span> <span class=\"n\">typer</span><span class=\"o\">.</span><span class=\"n\">confirm</span><span class=\"p\">(</span><span class=\"s2\">&quot;Delete your local Runhouse config file?&quot;</span><span class=\"p\">)</span>\n\n    <span class=\"k\">if</span> <span class=\"n\">delete_rh_config_file</span><span class=\"p\">:</span>\n        <span class=\"c1\"># Delete the credentials file on the file system</span>\n        <span class=\"n\">configs</span><span class=\"o\">.</span><span class=\"n\">delete_defaults</span><span class=\"p\">(</span><span class=\"n\">rh_config_path</span><span class=\"p\">)</span>\n        <span class=\"n\">logger</span><span class=\"o\">.</span><span class=\"n\">info</span><span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s2\">&quot;Deleted Runhouse config file from path: </span><span class=\"si\">{</span><span class=\"n\">rh_config_path</span><span class=\"si\">}</span><span class=\"s2\">&quot;</span><span class=\"p\">)</span>\n\n    <span class=\"n\">logger</span><span class=\"o\">.</span><span class=\"n\">info</span><span class=\"p\">(</span><span class=\"s2\">&quot;Successfully logged out of Runhouse.&quot;</span><span class=\"p\">)</span></div>\n</pre></div>", "current_page_name": "_modules/runhouse/rns/login", "sidebars": ["about.html", "navigation.html", "relations.html", "searchbox.html", "donate.html"], "customsidebar": null, "alabaster_version": "0.7.16", "alabaster_version_info": [0, 7, 16]}