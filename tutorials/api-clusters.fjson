{"parents": [], "prev": {"link": "../quick-start-den/", "title": "Den Quick Start"}, "next": {"link": "../api-modules/", "title": "Functions and Modules"}, "title": "Clusters", "meta": {}, "body": "<section id=\"clusters\">\n<h1>Clusters<a class=\"headerlink\" href=\"#clusters\" title=\"Permalink to this heading\">\u00b6</a></h1>\n<p><a href=\"https://colab.research.google.com/github/run-house/runhouse/blob/stable/docs/notebooks/api/clusters.ipynb\">\n<img height=\"20px\" width=\"117px\" src=\"https://colab.research.google.com/assets/colab-badge.svg\" alt=\"Open In Colab\"/></a></p><p>A cluster is the most basic form of compute in Runhouse, largely\nrepresenting a group of instances or VMs connected with Ray. They\nlargely fall in two categories:</p>\n<ol class=\"arabic simple\">\n<li><p>Static Clusters: Any machine you have SSH access to, set up with IP\naddresses and SSH credentials.</p></li>\n<li><p>On-Demand Clusters: Any cloud instance spun up automatically for you\nwith your cloud credentials.</p></li>\n</ol>\n<p>Runhouse provides various APIs for interacting with remote clusters,\nsuch as terminating an on-demand cloud cluster or running remote CLI or\nPython commands from your local dev environment.</p>\n<p>Let\u2019s start with a simple example using AWS. After making sure your\n<code class=\"docutils literal notranslate\"><span class=\"pre\">~/.aws/credentials</span></code> file is set up with access to create instances in\nEC2, you can install Runhouse and create on-demand clusters in AWS.</p>\n<div class=\"highlight-ipython3 notranslate\"><div class=\"highlight\"><pre><span></span>! pip install &quot;runhouse[aws]&quot;\n</pre></div>\n</div>\n<section id=\"on-demand-clusters\">\n<h2>On-Demand Clusters<a class=\"headerlink\" href=\"#on-demand-clusters\" title=\"Permalink to this heading\">\u00b6</a></h2>\n<p>We can start by using the <code class=\"docutils literal notranslate\"><span class=\"pre\">rh.cluster</span></code> factory function to create our\ncluster. By specifying an <code class=\"docutils literal notranslate\"><span class=\"pre\">instance_type</span></code>, Runhouse sets up an\nOn-Demand Cluster in AWS EC2 for us.</p>\n<p>Each cluster must be provided with a unique <code class=\"docutils literal notranslate\"><span class=\"pre\">name</span></code> identifier during\nconstruction. This <code class=\"docutils literal notranslate\"><span class=\"pre\">name</span></code> parameter is used for saving down or loading\nprevious saved clusters, and also used for various CLI commands for the\ncluster.</p>\n<div class=\"highlight-ipython3 notranslate\"><div class=\"highlight\"><pre><span></span>import runhouse as rh\n\naws_cluster = rh.cluster(name=&quot;test-cluster&quot;, instance_type=&quot;CPU:2&quot;, provider=&quot;aws&quot;)\n</pre></div>\n</div>\n<p>Next, we set up a basic function to throw up on our cluster. For more\ninformation about Functions &amp; Modules that you can put up on a cluster,\nsee <a class=\"reference external\" href=\"https://www.run.house/docs/tutorials/api-modules\">Functions &amp;\nModules</a>.</p>\n<div class=\"highlight-ipython3 notranslate\"><div class=\"highlight\"><pre><span></span>def run_home(name: str):\n    return f&quot;Run home {name}!&quot;\n\nremote_function = rh.function(run_home).to(aws_cluster)\n</pre></div>\n</div>\n<p>After running <code class=\"docutils literal notranslate\"><span class=\"pre\">.to</span></code>, your function is set up on the cluster to be\ncalled from anywhere. When you call <code class=\"docutils literal notranslate\"><span class=\"pre\">remote_function</span></code>, it executes\nremotely on your AWS instance.</p>\n<div class=\"highlight-ipython3 notranslate\"><div class=\"highlight\"><pre><span></span>remote_function(&quot;in cluster!&quot;)\n</pre></div>\n</div>\n<div class=\"code-output highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">INFO</span> <span class=\"o\">|</span> <span class=\"mi\">2024</span><span class=\"o\">-</span><span class=\"mi\">02</span><span class=\"o\">-</span><span class=\"mi\">20</span> <span class=\"mi\">16</span><span class=\"p\">:</span><span class=\"mi\">38</span><span class=\"p\">:</span><span class=\"mf\">13.733518</span> <span class=\"o\">|</span> <span class=\"n\">Calling</span> <span class=\"n\">run_home</span><span class=\"o\">.</span><span class=\"n\">call</span>\n<span class=\"n\">INFO</span> <span class=\"o\">|</span> <span class=\"mi\">2024</span><span class=\"o\">-</span><span class=\"mi\">02</span><span class=\"o\">-</span><span class=\"mi\">20</span> <span class=\"mi\">16</span><span class=\"p\">:</span><span class=\"mi\">38</span><span class=\"p\">:</span><span class=\"mf\">14.807770</span> <span class=\"o\">|</span> <span class=\"n\">Time</span> <span class=\"n\">to</span> <span class=\"n\">call</span> <span class=\"n\">run_home</span><span class=\"o\">.</span><span class=\"n\">call</span><span class=\"p\">:</span> <span class=\"mf\">1.07</span> <span class=\"n\">seconds</span>\n</pre></div>\n</div>\n<div class=\"code-output highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"s1\">&#39;Run home in cluster!!&#39;</span>\n</pre></div>\n</div>\n<section id=\"on-demand-clusters-with-tls-exposed\">\n<h3>On-Demand Clusters with TLS exposed<a class=\"headerlink\" href=\"#on-demand-clusters-with-tls-exposed\" title=\"Permalink to this heading\">\u00b6</a></h3>\n<p>In the previous example, the cluster that was brought up in EC2 is only\naccessible to the original user that has SSH credentials to the machine.\nHowever, you can set up a cluster with ports exposed to open Internet,\nand access objects and functions via <code class=\"docutils literal notranslate\"><span class=\"pre\">curl</span></code>.</p>\n<div class=\"highlight-ipython3 notranslate\"><div class=\"highlight\"><pre><span></span>tls_cluster = rh.cluster(name=&quot;tls-cluster&quot;,\n                         instance_type=&quot;CPU:2&quot;,\n                         open_ports=[443], # expose HTTPS port to public\n                         server_connection_type=&quot;tls&quot;, # specify how runhouse communicates with this cluster\n                         den_auth=False, # no authentication required to hit this cluster (NOT recommended)\n)\n</pre></div>\n</div>\n<pre class=\"code-output literal-block\">/Users/rohinbhasin/work/runhouse/runhouse/resources/hardware/on_demand_cluster.py:317: UserWarning: Server is insecure and must be inside a VPC or have <cite>den_auth</cite> enabled to secure it.\n  warnings.warn(</pre>\n<div class=\"highlight-ipython3 notranslate\"><div class=\"highlight\"><pre><span></span>remote_tls_function = rh.function(run_home).to(tls_cluster)\n</pre></div>\n</div>\n<div class=\"highlight-ipython3 notranslate\"><div class=\"highlight\"><pre><span></span>remote_tls_function(&quot;Marvin&quot;)\n</pre></div>\n</div>\n<div class=\"code-output highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">INFO</span> <span class=\"o\">|</span> <span class=\"mi\">2024</span><span class=\"o\">-</span><span class=\"mi\">02</span><span class=\"o\">-</span><span class=\"mi\">20</span> <span class=\"mi\">17</span><span class=\"p\">:</span><span class=\"mi\">09</span><span class=\"p\">:</span><span class=\"mf\">03.605194</span> <span class=\"o\">|</span> <span class=\"n\">Calling</span> <span class=\"n\">run_home</span><span class=\"o\">.</span><span class=\"n\">call</span>\n<span class=\"n\">INFO</span> <span class=\"o\">|</span> <span class=\"mi\">2024</span><span class=\"o\">-</span><span class=\"mi\">02</span><span class=\"o\">-</span><span class=\"mi\">20</span> <span class=\"mi\">17</span><span class=\"p\">:</span><span class=\"mi\">09</span><span class=\"p\">:</span><span class=\"mf\">04.640570</span> <span class=\"o\">|</span> <span class=\"n\">Time</span> <span class=\"n\">to</span> <span class=\"n\">call</span> <span class=\"n\">run_home</span><span class=\"o\">.</span><span class=\"n\">call</span><span class=\"p\">:</span> <span class=\"mf\">1.04</span> <span class=\"n\">seconds</span>\n</pre></div>\n</div>\n<div class=\"code-output highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"s1\">&#39;Run home Marvin!&#39;</span>\n</pre></div>\n</div>\n<div class=\"highlight-ipython3 notranslate\"><div class=\"highlight\"><pre><span></span>tls_cluster.address\n</pre></div>\n</div>\n<div class=\"code-output highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"s1\">&#39;3.86.210.191&#39;</span>\n</pre></div>\n</div>\n<div class=\"highlight-ipython3 notranslate\"><div class=\"highlight\"><pre><span></span>! curl &quot;https://3.86.210.191/run_home/call?name=Marvin&quot; -k\n</pre></div>\n</div>\n<pre class=\"code-output literal-block\">{&quot;data&quot;:&quot;&quot;Run home Marvin!&quot;&quot;,&quot;error&quot;:null,&quot;traceback&quot;:null,&quot;output_type&quot;:&quot;result_serialized&quot;,&quot;serialization&quot;:&quot;json&quot;}</pre>\n</section>\n</section>\n<section id=\"static-clusters\">\n<h2>Static Clusters<a class=\"headerlink\" href=\"#static-clusters\" title=\"Permalink to this heading\">\u00b6</a></h2>\n<p>If you have existing machines within a VPC that you want to connect to,\nyou can simply provide the IP addresses and path to SSH credentials to\nthe machine.</p>\n<div class=\"highlight-ipython3 notranslate\"><div class=\"highlight\"><pre><span></span>cluster = rh.cluster(  # using private key\n              name=&quot;cpu-cluster-existing&quot;,\n              ips=[&#39;&lt;ip of the cluster&gt;&#39;],\n              ssh_creds={&#39;ssh_user&#39;: &#39;&lt;user&gt;&#39;, &#39;ssh_private_key&#39;:&#39;&lt;path_to_key&gt;&#39;},\n          )\n</pre></div>\n</div>\n</section>\n<section id=\"useful-cluster-functions\">\n<h2>Useful Cluster Functions<a class=\"headerlink\" href=\"#useful-cluster-functions\" title=\"Permalink to this heading\">\u00b6</a></h2>\n<div class=\"highlight-ipython3 notranslate\"><div class=\"highlight\"><pre><span></span>tls_cluster.run([&#39;pip install numpy &amp;&amp; pip freeze | grep numpy&#39;])\n</pre></div>\n</div>\n<div class=\"code-output highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"ne\">Warning</span><span class=\"p\">:</span> <span class=\"n\">Permanently</span> <span class=\"n\">added</span> <span class=\"s1\">&#39;3.86.210.191&#39;</span> <span class=\"p\">(</span><span class=\"n\">ED25519</span><span class=\"p\">)</span> <span class=\"n\">to</span> <span class=\"n\">the</span> <span class=\"nb\">list</span> <span class=\"n\">of</span> <span class=\"n\">known</span> <span class=\"n\">hosts</span><span class=\"o\">.</span>\n</pre></div>\n</div>\n<div class=\"code-output highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">Requirement</span> <span class=\"n\">already</span> <span class=\"n\">satisfied</span><span class=\"p\">:</span> <span class=\"n\">numpy</span> <span class=\"ow\">in</span> <span class=\"o\">/</span><span class=\"n\">opt</span><span class=\"o\">/</span><span class=\"n\">conda</span><span class=\"o\">/</span><span class=\"n\">lib</span><span class=\"o\">/</span><span class=\"n\">python3</span><span class=\"mf\">.10</span><span class=\"o\">/</span><span class=\"n\">site</span><span class=\"o\">-</span><span class=\"n\">packages</span> <span class=\"p\">(</span><span class=\"mf\">1.26.4</span><span class=\"p\">)</span>\n<span class=\"n\">numpy</span><span class=\"o\">==</span><span class=\"mf\">1.26.4</span>\n</pre></div>\n</div>\n<pre class=\"code-output literal-block\">[(0,\n  'Requirement already satisfied: numpy in /opt/conda/lib/python3.10/site-packages (1.26.4)nnumpy==1.26.4n',\n  &quot;Warning: Permanently added '3.86.210.191' (ED25519) to the list of known hosts.rn&quot;)]</pre>\n<div class=\"highlight-ipython3 notranslate\"><div class=\"highlight\"><pre><span></span>tls_cluster.run_python([&#39;import numpy&#39;, &#39;print(numpy.__version__)&#39;])\n</pre></div>\n</div>\n<div class=\"code-output highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"mf\">1.26.4</span>\n</pre></div>\n</div>\n<pre class=\"code-output literal-block\">[(0, '1.26.4n', '')]</pre>\n</section>\n</section>\n\n    <script type=\"text/x-thebe-config\">\n    {\n        requestKernel: true,\n        binderOptions: {\n            repo: \"binder-examples/jupyter-stacks-datascience\",\n            ref: \"master\",\n        },\n        codeMirrorConfig: {\n            theme: \"abcdef\",\n            mode: \"python\"\n        },\n        kernelOptions: {\n            name: \"python3\",\n            path: \"./tutorials\"\n        },\n        predefinedOutput: true\n    }\n    </script>\n    <script>kernelName = 'python3'</script>", "metatags": "<meta name=\"generator\" content=\"Docutils 0.19: https://docutils.sourceforge.io/\" />\n", "rellinks": [["genindex", "General Index", "I", "index"], ["py-modindex", "Python Module Index", "", "modules"], ["tutorials/api-modules", "Functions and Modules", "N", "next"], ["tutorials/quick-start-den", "Den Quick Start", "P", "previous"]], "sourcename": "tutorials/api-clusters.rst.txt", "toc": "<ul>\n<li><a class=\"reference internal\" href=\"#\">Clusters</a><ul>\n<li><a class=\"reference internal\" href=\"#on-demand-clusters\">On-Demand Clusters</a><ul>\n<li><a class=\"reference internal\" href=\"#on-demand-clusters-with-tls-exposed\">On-Demand Clusters with TLS exposed</a></li>\n</ul>\n</li>\n<li><a class=\"reference internal\" href=\"#static-clusters\">Static Clusters</a></li>\n<li><a class=\"reference internal\" href=\"#useful-cluster-functions\">Useful Cluster Functions</a></li>\n</ul>\n</li>\n</ul>\n", "display_toc": true, "page_source_suffix": ".rst", "globaltoc": "<p class=\"caption\" role=\"heading\"><span class=\"caption-text\">Getting Started</span></p>\n<ul>\n<li class=\"toctree-l1\"><a class=\"reference internal\" href=\"tutorials/quick-start-cloud/\">Cloud Quick Start</a></li>\n<li class=\"toctree-l1\"><a class=\"reference internal\" href=\"tutorials/quick-start-local/\">Local Quick Start</a></li>\n<li class=\"toctree-l1\"><a class=\"reference internal\" href=\"tutorials/quick-start-den/\">Den Quick Start</a></li>\n</ul>\n<p class=\"caption\" role=\"heading\"><span class=\"caption-text\">API Basics</span></p>\n<ul>\n<li class=\"toctree-l1\"><a class=\"reference internal\" href=\"tutorials/api-clusters/\">Clusters</a></li>\n<li class=\"toctree-l1\"><a class=\"reference internal\" href=\"tutorials/api-modules/\">Functions and Modules</a></li>\n<li class=\"toctree-l1\"><a class=\"reference internal\" href=\"tutorials/api-envs/\">Envs and Packages</a></li>\n<li class=\"toctree-l1\"><a class=\"reference internal\" href=\"tutorials/api-secrets/\">Secrets</a></li>\n<li class=\"toctree-l1\"><a class=\"reference internal\" href=\"tutorials/api-resources/\">Resource Management</a></li>\n</ul>\n<p class=\"caption\" role=\"heading\"><span class=\"caption-text\">API Reference</span></p>\n<ul>\n<li class=\"toctree-l1\"><a class=\"reference internal\" href=\"api/python/\">Python API</a><ul>\n<li class=\"toctree-l2\"><a class=\"reference internal\" href=\"api/python/resource/\">Resource</a></li>\n<li class=\"toctree-l2\"><a class=\"reference internal\" href=\"api/python/function/\">Function</a></li>\n<li class=\"toctree-l2\"><a class=\"reference internal\" href=\"api/python/cluster/\">Cluster</a></li>\n<li class=\"toctree-l2\"><a class=\"reference internal\" href=\"api/python/env/\">Env</a></li>\n<li class=\"toctree-l2\"><a class=\"reference internal\" href=\"api/python/package/\">Package</a></li>\n<li class=\"toctree-l2\"><a class=\"reference internal\" href=\"api/python/module/\">Module</a></li>\n<li class=\"toctree-l2\"><a class=\"reference internal\" href=\"api/python/mapper/\">Mapper</a></li>\n<li class=\"toctree-l2\"><a class=\"reference internal\" href=\"api/python/folder/\">Folder</a></li>\n<li class=\"toctree-l2\"><a class=\"reference internal\" href=\"api/python/table/\">Table</a></li>\n<li class=\"toctree-l2\"><a class=\"reference internal\" href=\"api/python/blob/\">Blob</a></li>\n<li class=\"toctree-l2\"><a class=\"reference internal\" href=\"api/python/file/\">File</a></li>\n<li class=\"toctree-l2\"><a class=\"reference internal\" href=\"api/python/secrets/\">Secrets</a></li>\n<li class=\"toctree-l2\"><a class=\"reference internal\" href=\"api/python/login/\">Login/Logout</a></li>\n</ul>\n</li>\n<li class=\"toctree-l1\"><a class=\"reference internal\" href=\"api/cli/\">Command Line Interface</a></li>\n</ul>\n<p class=\"caption\" role=\"heading\"><span class=\"caption-text\">Other Topics</span></p>\n<ul>\n<li class=\"toctree-l1\"><a class=\"reference internal\" href=\"architecture/\">Architecture Overview</a></li>\n<li class=\"toctree-l1\"><a class=\"reference internal\" href=\"debugging-logging/\">Debugging and Logging</a></li>\n<li class=\"toctree-l1\"><a class=\"reference internal\" href=\"troubleshooting/\">Manual Setup and Troubleshooting</a></li>\n<li class=\"toctree-l1\"><a class=\"reference internal\" href=\"security-and-authentication/\">Security and Authentication</a></li>\n</ul>\n", "current_page_name": "tutorials/api-clusters", "sidebars": ["about.html", "navigation.html", "relations.html", "searchbox.html", "donate.html"], "customsidebar": null, "alabaster_version": "0.7.16", "alabaster_version_info": [0, 7, 16]}