{"parents": [], "prev": null, "next": null, "title": "Data: Folders &amp; Blobs", "meta": {}, "body": "<section id=\"data-folders-blobs\">\n<h1>Data: Folders &amp; Blobs<a class=\"headerlink\" href=\"#data-folders-blobs\" title=\"Permalink to this heading\">\u00b6</a></h1>\n<p><a href=\"https://colab.research.google.com/github/run-house/notebooks/blob/stable/docs/api-data.ipynb\">\n<img height=\"20px\" width=\"117px\" src=\"https://colab.research.google.com/assets/colab-badge.svg\" alt=\"Open In Colab\"/></a></p><p>Runhouse has several abstractions to provide a simple interface for\nstoring, recalling, and moving data between the user\u2019s laptop, remote\ncompute, cloud storage, and specialized storage (e.g.\u00a0data warehouses).</p>\n<p>The Folder and Blob APIs provide least-common-denominator APIs across\nproviders, allowing users to easily specify the actions they want to\ntake on the data without needed to dig into provider-specific APIs.</p>\n<section id=\"install-runhouse-and-setup-cluster\">\n<h2>Install Runhouse and Setup Cluster<a class=\"headerlink\" href=\"#install-runhouse-and-setup-cluster\" title=\"Permalink to this heading\">\u00b6</a></h2>\n<div class=\"highlight-ipython3 notranslate\"><div class=\"highlight\"><pre><span></span>!pip install &quot;runhouse[aws]&quot;\n</pre></div>\n</div>\n<div class=\"highlight-ipython3 notranslate\"><div class=\"highlight\"><pre><span></span>import runhouse as rh\n</pre></div>\n</div>\n<p>Optionally, login to Runhouse to sync credentials.</p>\n<div class=\"highlight-ipython3 notranslate\"><div class=\"highlight\"><pre><span></span>!runhouse login\n</pre></div>\n</div>\n<p>We also construct a Runhouse cluster object that we will use throughout\nthe tutorial. We won\u2019t go in depth about clusters in this tutorial, but\nyou can refer to Getting Started for setup instructions, or the Compute\nAPI tutorial for a more in-depth walkthrough of clusters.</p>\n<div class=\"highlight-ipython3 notranslate\"><div class=\"highlight\"><pre><span></span>cluster = rh.ondemand_cluster(\n              name=&quot;cpu-cluster&quot;,\n              instance_type=&quot;CPU:8&quot;,\n              provider=&quot;cheapest&quot;,       # &quot;AWS&quot;, &quot;GCP&quot;, &quot;Azure&quot;, &quot;Lambda&quot;, or &quot;cheapest&quot; (default)\n              autostop_mins=60,          # Optional, defaults to default_autostop_mins; -1 suspends autostop\n          )\ncluster.up()\n</pre></div>\n</div>\n</section>\n<section id=\"folders\">\n<h2>Folders<a class=\"headerlink\" href=\"#folders\" title=\"Permalink to this heading\">\u00b6</a></h2>\n<p>The Runhouse Folder API allows for creating references to folders, and\nsyncing them between local, remote clusters, or file storage (S3, GS,\nAzure).</p>\n<p>Let\u2019s construct a sample dummy folder locally, that we\u2019ll use to\ndemonstrate.</p>\n<div class=\"highlight-ipython3 notranslate\"><div class=\"highlight\"><pre><span></span>import os\nfolder_name = &quot;sample_folder&quot;\nos.makedirs(folder_name, exist_ok=True)\n\nfor i in range(5):\n  with open(f&#39;{folder_name}/{i}.txt&#39;, &#39;w&#39;) as f:\n      f.write(&#39;i&#39;)\n\nlocal_path = f&quot;{os.getcwd()}/{folder_name}&quot;\n</pre></div>\n</div>\n<p>To create a folder object, use the <code class=\"docutils literal notranslate\"><span class=\"pre\">rh.folder()</span></code> factory function, and\nuse <code class=\"docutils literal notranslate\"><span class=\"pre\">.to()</span></code> to send the folder to a remote cluster.</p>\n<div class=\"highlight-ipython3 notranslate\"><div class=\"highlight\"><pre><span></span>local_folder = rh.folder(path=f&quot;{os.getcwd()}/{folder_name}&quot;)\ncluster_folder = local_folder.to(system=cluster, path=folder_name)\n\ncluster.run([f&quot;ls {folder_name}&quot;])\n</pre></div>\n</div>\n<div class=\"code-output highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">INFO</span> <span class=\"o\">|</span> <span class=\"mi\">2023</span><span class=\"o\">-</span><span class=\"mi\">08</span><span class=\"o\">-</span><span class=\"mi\">29</span> <span class=\"mi\">19</span><span class=\"p\">:</span><span class=\"mi\">45</span><span class=\"p\">:</span><span class=\"mf\">52.597164</span> <span class=\"o\">|</span> <span class=\"n\">Copying</span> <span class=\"n\">folder</span> <span class=\"kn\">from</span> <span class=\"nn\">file</span><span class=\"p\">:</span><span class=\"o\">///</span><span class=\"n\">Users</span><span class=\"o\">/</span><span class=\"n\">caroline</span><span class=\"o\">/</span><span class=\"n\">Documents</span><span class=\"o\">/</span><span class=\"n\">runhouse</span><span class=\"o\">/</span><span class=\"n\">runhouse</span><span class=\"o\">/</span><span class=\"n\">docs</span><span class=\"o\">/</span><span class=\"n\">notebooks</span><span class=\"o\">/</span><span class=\"n\">basics</span><span class=\"o\">/</span><span class=\"n\">sample_folder</span> <span class=\"n\">to</span><span class=\"p\">:</span> <span class=\"n\">cpu</span><span class=\"o\">-</span><span class=\"n\">cluster</span><span class=\"p\">,</span> <span class=\"k\">with</span> <span class=\"n\">path</span><span class=\"p\">:</span> <span class=\"n\">sample_folder</span>\n<span class=\"n\">INFO</span> <span class=\"o\">|</span> <span class=\"mi\">2023</span><span class=\"o\">-</span><span class=\"mi\">08</span><span class=\"o\">-</span><span class=\"mi\">29</span> <span class=\"mi\">19</span><span class=\"p\">:</span><span class=\"mi\">45</span><span class=\"p\">:</span><span class=\"mf\">54.633598</span> <span class=\"o\">|</span> <span class=\"n\">Running</span> <span class=\"n\">command</span> <span class=\"n\">on</span> <span class=\"n\">cpu</span><span class=\"o\">-</span><span class=\"n\">cluster</span><span class=\"p\">:</span> <span class=\"n\">ls</span> <span class=\"n\">sample_folder</span>\n</pre></div>\n</div>\n<div class=\"code-output highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"mf\">0.</span><span class=\"n\">txt</span>\n<span class=\"mf\">1.</span><span class=\"n\">txt</span>\n<span class=\"mf\">2.</span><span class=\"n\">txt</span>\n<span class=\"mf\">3.</span><span class=\"n\">txt</span>\n<span class=\"mf\">4.</span><span class=\"n\">txt</span>\n</pre></div>\n</div>\n<pre class=\"code-output literal-block\">[(0, '0.txtn1.txtn2.txtn3.txtn4.txtn', '')]</pre>\n<p>You can also send the folder to file storage, such as S3, GS, and Azure.</p>\n<div class=\"highlight-ipython3 notranslate\"><div class=\"highlight\"><pre><span></span>s3_folder = local_folder.to(system=&quot;s3&quot;)\ns3_folder.ls(full_paths=False)\n</pre></div>\n</div>\n<div class=\"code-output highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">INFO</span> <span class=\"o\">|</span> <span class=\"mi\">2023</span><span class=\"o\">-</span><span class=\"mi\">08</span><span class=\"o\">-</span><span class=\"mi\">29</span> <span class=\"mi\">19</span><span class=\"p\">:</span><span class=\"mi\">47</span><span class=\"p\">:</span><span class=\"mf\">47.618511</span> <span class=\"o\">|</span> <span class=\"n\">Copying</span> <span class=\"n\">folder</span> <span class=\"kn\">from</span> <span class=\"nn\">file</span><span class=\"p\">:</span><span class=\"o\">///</span><span class=\"n\">Users</span><span class=\"o\">/</span><span class=\"n\">caroline</span><span class=\"o\">/</span><span class=\"n\">Documents</span><span class=\"o\">/</span><span class=\"n\">runhouse</span><span class=\"o\">/</span><span class=\"n\">runhouse</span><span class=\"o\">/</span><span class=\"n\">docs</span><span class=\"o\">/</span><span class=\"n\">notebooks</span><span class=\"o\">/</span><span class=\"n\">basics</span><span class=\"o\">/</span><span class=\"n\">sample_folder</span> <span class=\"n\">to</span><span class=\"p\">:</span> <span class=\"n\">s3</span><span class=\"p\">,</span> <span class=\"k\">with</span> <span class=\"n\">path</span><span class=\"p\">:</span> <span class=\"o\">/</span><span class=\"n\">runhouse</span><span class=\"o\">-</span><span class=\"n\">folder</span><span class=\"o\">/</span><span class=\"n\">a6f195296945409da432b2981f984ae7</span>\n<span class=\"n\">INFO</span> <span class=\"o\">|</span> <span class=\"mi\">2023</span><span class=\"o\">-</span><span class=\"mi\">08</span><span class=\"o\">-</span><span class=\"mi\">29</span> <span class=\"mi\">19</span><span class=\"p\">:</span><span class=\"mi\">47</span><span class=\"p\">:</span><span class=\"mf\">47.721743</span> <span class=\"o\">|</span> <span class=\"n\">Found</span> <span class=\"n\">credentials</span> <span class=\"ow\">in</span> <span class=\"n\">shared</span> <span class=\"n\">credentials</span> <span class=\"n\">file</span><span class=\"p\">:</span> <span class=\"o\">~/.</span><span class=\"n\">aws</span><span class=\"o\">/</span><span class=\"n\">credentials</span>\n<span class=\"n\">INFO</span> <span class=\"o\">|</span> <span class=\"mi\">2023</span><span class=\"o\">-</span><span class=\"mi\">08</span><span class=\"o\">-</span><span class=\"mi\">29</span> <span class=\"mi\">19</span><span class=\"p\">:</span><span class=\"mi\">47</span><span class=\"p\">:</span><span class=\"mf\">48.796181</span> <span class=\"o\">|</span> <span class=\"n\">Found</span> <span class=\"n\">credentials</span> <span class=\"ow\">in</span> <span class=\"n\">shared</span> <span class=\"n\">credentials</span> <span class=\"n\">file</span><span class=\"p\">:</span> <span class=\"o\">~/.</span><span class=\"n\">aws</span><span class=\"o\">/</span><span class=\"n\">credentials</span>\n</pre></div>\n</div>\n<div class=\"code-output highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"p\">[</span><span class=\"s1\">&#39;0.txt&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;1.txt&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;2.txt&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;3.txt&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;4.txt&#39;</span><span class=\"p\">]</span>\n</pre></div>\n</div>\n<p>Similarly, you can send folders from a cluster to file storage, cluster\nto cluster, or file storage to file storage. These are all done without\nbouncing the folder off local.</p>\n<div class=\"highlight-ipython3 notranslate\"><div class=\"highlight\"><pre><span></span>cluster_folder.to(system=another_cluster)  # cluster to cluster\ncluster_folder.to(system=&quot;s3&quot;)             # cluster to fs\ns3_folder.to(system=cluster)               # fs to cluster\ns3_folder.to(system=&quot;gs&quot;)                  # fs to fs\n</pre></div>\n</div>\n</section>\n<section id=\"blobs\">\n<h2>Blobs<a class=\"headerlink\" href=\"#blobs\" title=\"Permalink to this heading\">\u00b6</a></h2>\n<p>The Runhouse Blob API represents an entity for storing arbitrary data.\nBlobs are associated with a system (local, remote, or file storage), and\ncan be written down or synced to systems.</p>\n<div class=\"highlight-ipython3 notranslate\"><div class=\"highlight\"><pre><span></span>import json\nimport pickle\n\nblob_data = list(range(50))\n</pre></div>\n</div>\n<div class=\"highlight-ipython3 notranslate\"><div class=\"highlight\"><pre><span></span># create and save local blob\nlocal_blob = rh.blob(\n        name=&quot;local_blob&quot;,\n        data=blob_data,\n        system=&quot;file&quot;,\n        path=&quot;local_blob.pickle&quot;\n    ).save()\n</pre></div>\n</div>\n<div class=\"code-output highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">INFO</span> <span class=\"o\">|</span> <span class=\"mi\">2023</span><span class=\"o\">-</span><span class=\"mi\">08</span><span class=\"o\">-</span><span class=\"mi\">29</span> <span class=\"mi\">20</span><span class=\"p\">:</span><span class=\"mi\">57</span><span class=\"p\">:</span><span class=\"mf\">10.570715</span> <span class=\"o\">|</span> <span class=\"n\">Creating</span> <span class=\"n\">new</span> <span class=\"n\">file</span> <span class=\"n\">folder</span> <span class=\"k\">if</span> <span class=\"n\">it</span> <span class=\"n\">does</span> <span class=\"ow\">not</span> <span class=\"n\">already</span> <span class=\"n\">exist</span> <span class=\"ow\">in</span> <span class=\"n\">path</span><span class=\"p\">:</span> <span class=\"o\">/</span><span class=\"n\">Users</span><span class=\"o\">/</span><span class=\"n\">caroline</span><span class=\"o\">/</span><span class=\"n\">Documents</span><span class=\"o\">/</span><span class=\"n\">runhouse</span><span class=\"o\">/</span><span class=\"n\">runhouse</span>\n</pre></div>\n</div>\n<div class=\"highlight-ipython3 notranslate\"><div class=\"highlight\"><pre><span></span># to sync the blob to remote or fs\nlocal_blob.to(system=cluster)\nlocal_blob.to(system=&quot;s3&quot;)\n</pre></div>\n</div>\n<div class=\"highlight-ipython3 notranslate\"><div class=\"highlight\"><pre><span></span># create blob on s3\nrh.blob(\n    data=blob_data,\n    system=&quot;s3&quot;,\n    path=f&quot;/runhouse-blob/sample_blob.pickle&quot;,\n)\n\n# create blob on cluster\nrh.blob(\n    data=blob_data,\n    system=cluster,\n)\n</pre></div>\n</div>\n<p>To get the contents from a blob, use <code class=\"docutils literal notranslate\"><span class=\"pre\">.fetch()</span></code>:</p>\n<div class=\"highlight-ipython3 notranslate\"><div class=\"highlight\"><pre><span></span>print(local_blob.fetch())\n</pre></div>\n</div>\n<div class=\"code-output highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"s1\">&#39;[0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49]&#39;</span>\n</pre></div>\n</div>\n<p>Now that you understand the basics, feel free to play around with more\ncomplicated scenarios! You can also check out our additional API and\nexample usage tutorials on our <a class=\"reference external\" href=\"https://www.run.house/docs\">docs\nsite</a>.</p>\n</section>\n<section id=\"cluster-termination\">\n<h2>Cluster Termination<a class=\"headerlink\" href=\"#cluster-termination\" title=\"Permalink to this heading\">\u00b6</a></h2>\n<div class=\"highlight-ipython3 notranslate\"><div class=\"highlight\"><pre><span></span>!sky down cpu-cluster\n# or\ncluster.teardown()\n</pre></div>\n</div>\n<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\"><span style=\"color: #008000; text-decoration-color: #008000\">\u2839</span> <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">Terminating </span><span style=\"color: #008000; text-decoration-color: #008000; font-weight: bold\">cpu-cluster</span>\n</pre><pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\"></pre></section>\n</section>\n\n    <script type=\"text/x-thebe-config\">\n    {\n        requestKernel: true,\n        binderOptions: {\n            repo: \"binder-examples/jupyter-stacks-datascience\",\n            ref: \"master\",\n        },\n        codeMirrorConfig: {\n            theme: \"abcdef\",\n            mode: \"python\"\n        },\n        kernelOptions: {\n            name: \"python3\",\n            path: \"./tutorials\"\n        },\n        predefinedOutput: true\n    }\n    </script>\n    <script>kernelName = 'python3'</script>", "metatags": "<meta name=\"generator\" content=\"Docutils 0.19: https://docutils.sourceforge.io/\" />\n", "rellinks": [["genindex", "General Index", "I", "index"], ["py-modindex", "Python Module Index", "", "modules"]], "sourcename": "tutorials/api-data.rst.txt", "toc": "<ul>\n<li><a class=\"reference internal\" href=\"#\">Data: Folders &amp; Blobs</a><ul>\n<li><a class=\"reference internal\" href=\"#install-runhouse-and-setup-cluster\">Install Runhouse and Setup Cluster</a></li>\n<li><a class=\"reference internal\" href=\"#folders\">Folders</a></li>\n<li><a class=\"reference internal\" href=\"#blobs\">Blobs</a></li>\n<li><a class=\"reference internal\" href=\"#cluster-termination\">Cluster Termination</a></li>\n</ul>\n</li>\n</ul>\n", "display_toc": true, "page_source_suffix": ".rst", "globaltoc": "<p class=\"caption\" role=\"heading\"><span class=\"caption-text\">Getting Started</span></p>\n<ul>\n<li class=\"toctree-l1\"><a class=\"reference internal\" href=\"tutorials/quick-start-cloud/\">Cloud Quick Start</a></li>\n<li class=\"toctree-l1\"><a class=\"reference internal\" href=\"tutorials/quick-start-local/\">Local Quick Start</a></li>\n<li class=\"toctree-l1\"><a class=\"reference internal\" href=\"tutorials/quick-start-den/\">Den Quick Start</a></li>\n<li class=\"toctree-l1\"><a class=\"reference internal\" href=\"architecture/\">Architecture Overview</a></li>\n</ul>\n<p class=\"caption\" role=\"heading\"><span class=\"caption-text\">API Basics</span></p>\n<ul>\n<li class=\"toctree-l1\"><a class=\"reference internal\" href=\"tutorials/api-clusters/\">Clusters</a></li>\n<li class=\"toctree-l1\"><a class=\"reference internal\" href=\"tutorials/api-modules/\">Functions and Modules</a></li>\n<li class=\"toctree-l1\"><a class=\"reference internal\" href=\"tutorials/api-envs/\">Envs and Packages</a></li>\n<li class=\"toctree-l1\"><a class=\"reference internal\" href=\"tutorials/api-folders/\">Folders</a></li>\n<li class=\"toctree-l1\"><a class=\"reference internal\" href=\"tutorials/api-secrets/\">Secrets</a></li>\n<li class=\"toctree-l1\"><a class=\"reference internal\" href=\"tutorials/api-resources/\">Resource Management</a></li>\n</ul>\n<p class=\"caption\" role=\"heading\"><span class=\"caption-text\">API Reference</span></p>\n<ul>\n<li class=\"toctree-l1\"><a class=\"reference internal\" href=\"api/python/\">Python API</a><ul>\n<li class=\"toctree-l2\"><a class=\"reference internal\" href=\"api/python/resource/\">Resource</a></li>\n<li class=\"toctree-l2\"><a class=\"reference internal\" href=\"api/python/function/\">Function</a></li>\n<li class=\"toctree-l2\"><a class=\"reference internal\" href=\"api/python/cluster/\">Cluster</a></li>\n<li class=\"toctree-l2\"><a class=\"reference internal\" href=\"api/python/env/\">Env</a></li>\n<li class=\"toctree-l2\"><a class=\"reference internal\" href=\"api/python/package/\">Package</a></li>\n<li class=\"toctree-l2\"><a class=\"reference internal\" href=\"api/python/module/\">Module</a></li>\n<li class=\"toctree-l2\"><a class=\"reference internal\" href=\"api/python/folder/\">Folder</a></li>\n<li class=\"toctree-l2\"><a class=\"reference internal\" href=\"api/python/blob/\">Blob</a></li>\n<li class=\"toctree-l2\"><a class=\"reference internal\" href=\"api/python/file/\">File</a></li>\n<li class=\"toctree-l2\"><a class=\"reference internal\" href=\"api/python/secrets/\">Secrets</a></li>\n<li class=\"toctree-l2\"><a class=\"reference internal\" href=\"api/python/login/\">Login/Logout</a></li>\n</ul>\n</li>\n<li class=\"toctree-l1\"><a class=\"reference internal\" href=\"api/cli/\">Command Line Interface</a></li>\n</ul>\n<p class=\"caption\" role=\"heading\"><span class=\"caption-text\">Other Topics</span></p>\n<ul>\n<li class=\"toctree-l1\"><a class=\"reference internal\" href=\"tutorials/async/\">Asynchronous Programming</a></li>\n<li class=\"toctree-l1\"><a class=\"reference internal\" href=\"installation/\">Installation and Setup</a></li>\n<li class=\"toctree-l1\"><a class=\"reference internal\" href=\"debugging-logging/\">Debugging and Logging</a></li>\n<li class=\"toctree-l1\"><a class=\"reference internal\" href=\"docker-setup/\">Docker: Cluster Setup</a></li>\n<li class=\"toctree-l1\"><a class=\"reference internal\" href=\"docker-workflows/\">Docker: Dev and Prod Workflows</a></li>\n<li class=\"toctree-l1\"><a class=\"reference internal\" href=\"troubleshooting/\">Manual Setup and Troubleshooting</a></li>\n<li class=\"toctree-l1\"><a class=\"reference internal\" href=\"security-and-authentication/\">Security and Authentication</a></li>\n</ul>\n", "current_page_name": "tutorials/api-data", "sidebars": ["about.html", "navigation.html", "relations.html", "searchbox.html", "donate.html"], "customsidebar": null, "alabaster_version": "0.7.16", "alabaster_version_info": [0, 7, 16]}