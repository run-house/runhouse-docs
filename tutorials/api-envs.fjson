{"parents": [], "prev": {"link": "../api-modules/", "title": "Functions and Modules"}, "next": {"link": "../api-folders/", "title": "Folders"}, "title": "Envs and Packages", "meta": {}, "body": "<section id=\"envs-and-packages\">\n<h1>Envs and Packages<a class=\"headerlink\" href=\"#envs-and-packages\" title=\"Permalink to this heading\">\u00b6</a></h1>\n<p><a href=\"https://colab.research.google.com/github/run-house/notebooks/blob/stable/docs/api-envs.ipynb\">\n<img height=\"20px\" width=\"117px\" src=\"https://colab.research.google.com/assets/colab-badge.svg\" alt=\"Open In Colab\"/></a></p><p>The Runhouse Env and Package abstractions help to provide convenient\ndependency isolation and management across your dev environments and\napplications. By specifying the runtime environment associated with each\nof your Runhouse functions and apps, ensure consistency and\nreproducibility no matter where you deploy your code from/to.</p>\n<section id=\"packages\">\n<h2>Packages<a class=\"headerlink\" href=\"#packages\" title=\"Permalink to this heading\">\u00b6</a></h2>\n<p>A Runhouse package represents a package or dependency that can be shared\nbetween environments/clusters or file storage, and is core to the\nRunhouse environment. This can be the standard PyPI or Conda package, a\nrequirements.txt file, a custom local package, or even a Git package.</p>\n<div class=\"highlight-ipython3 notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"kn\">import</span> <span class=\"nn\">runhouse</span> <span class=\"k\">as</span> <span class=\"nn\">rh</span>\n</pre></div>\n</div>\n<div class=\"highlight-ipython3 notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">pip_package</span> <span class=\"o\">=</span> <span class=\"n\">rh</span><span class=\"o\">.</span><span class=\"n\">Package</span><span class=\"o\">.</span><span class=\"n\">from_string</span><span class=\"p\">(</span><span class=\"s2\">&quot;pip:numpy&quot;</span><span class=\"p\">)</span>\n<span class=\"n\">conda_package</span> <span class=\"o\">=</span> <span class=\"n\">rh</span><span class=\"o\">.</span><span class=\"n\">Package</span><span class=\"o\">.</span><span class=\"n\">from_string</span><span class=\"p\">(</span><span class=\"s2\">&quot;conda:torch&quot;</span><span class=\"p\">)</span>\n<span class=\"n\">reqs_package</span> <span class=\"o\">=</span> <span class=\"n\">rh</span><span class=\"o\">.</span><span class=\"n\">Package</span><span class=\"o\">.</span><span class=\"n\">from_string</span><span class=\"p\">(</span><span class=\"s2\">&quot;reqs:./&quot;</span><span class=\"p\">)</span>\n<span class=\"n\">git_package</span> <span class=\"o\">=</span> <span class=\"n\">rh</span><span class=\"o\">.</span><span class=\"n\">GitPackage</span><span class=\"p\">(</span><span class=\"n\">git_url</span><span class=\"o\">=</span><span class=\"s1\">&#39;https://github.com/huggingface/diffusers.git&#39;</span><span class=\"p\">,</span>\n                            <span class=\"n\">install_method</span><span class=\"o\">=</span><span class=\"s1\">&#39;pip&#39;</span><span class=\"p\">,</span>\n                            <span class=\"n\">revision</span><span class=\"o\">=</span><span class=\"s1\">&#39;v0.11.1&#39;</span><span class=\"p\">)</span>\n</pre></div>\n</div>\n</section>\n<section id=\"envs\">\n<h2>Envs<a class=\"headerlink\" href=\"#envs\" title=\"Permalink to this heading\">\u00b6</a></h2>\n<p>The Runhouse environment represents a whole compute environment,\nconsisting of packages, environment variables, the working directory,\nand any secrets necessary for performing tasks within the environment.\nIt defines the environment on which Runhouse functions and modules run.</p>\n<p>Currently, both bare metal environments and Conda environments are\nsupported. Docker environment support is planned.</p>\n<section id=\"bare-metal-envs\">\n<h3>Bare Metal Envs<a class=\"headerlink\" href=\"#bare-metal-envs\" title=\"Permalink to this heading\">\u00b6</a></h3>\n<p>Envs can be constructed with the <code class=\"docutils literal notranslate\"><span class=\"pre\">rh.env()</span></code> factory function,\noptionally taking in a name, requirements (packages), environment\nvariables, secrets, and working directory.</p>\n<div class=\"highlight-ipython3 notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">env</span> <span class=\"o\">=</span> <span class=\"n\">rh</span><span class=\"o\">.</span><span class=\"n\">env</span><span class=\"p\">(</span>\n        <span class=\"n\">name</span><span class=\"o\">=</span><span class=\"s2\">&quot;fn_env&quot;</span><span class=\"p\">,</span>\n        <span class=\"n\">reqs</span><span class=\"o\">=</span><span class=\"p\">[</span><span class=\"s2\">&quot;numpy&quot;</span><span class=\"p\">,</span> <span class=\"s2\">&quot;torch&quot;</span><span class=\"p\">],</span>\n        <span class=\"n\">working_dir</span><span class=\"o\">=</span><span class=\"s2\">&quot;./&quot;</span><span class=\"p\">,</span>  <span class=\"c1\"># current working dir</span>\n        <span class=\"n\">env_vars</span><span class=\"o\">=</span><span class=\"p\">{</span><span class=\"s2\">&quot;USER&quot;</span><span class=\"p\">:</span> <span class=\"s2\">&quot;*****&quot;</span><span class=\"p\">},</span>\n        <span class=\"n\">secrets</span><span class=\"o\">=</span><span class=\"p\">[</span><span class=\"s2\">&quot;aws&quot;</span><span class=\"p\">],</span>\n<span class=\"p\">)</span>\n</pre></div>\n</div>\n<p>If no environment name is provided, it defaults to <code class=\"docutils literal notranslate\"><span class=\"pre\">&quot;base_env&quot;</span></code>, which\ncorresponds to the base, catch-all environment on the cluster. If\nmultiple \u201cbase_env\u201d environments are sent to a cluster, the dependencies\nand variables will continue to be synced on top of the existing base\nenvironment.</p>\n</section>\n<section id=\"conda-envs\">\n<h3>Conda Envs<a class=\"headerlink\" href=\"#conda-envs\" title=\"Permalink to this heading\">\u00b6</a></h3>\n<p>Conda Envs can be created using <code class=\"docutils literal notranslate\"><span class=\"pre\">rh.conda_env</span></code>. There are a couple of\nways to construct a Conda Env:</p>\n<ul class=\"simple\">\n<li><p><code class=\"docutils literal notranslate\"><span class=\"pre\">.yml</span></code> file corresponding to conda config</p></li>\n<li><p>dict corresponding to conda config</p></li>\n<li><p>name of already set up local conda env</p></li>\n<li><p>passing in reqs as a list</p></li>\n</ul>\n<p>Additional package dependencies can be passed in through the <code class=\"docutils literal notranslate\"><span class=\"pre\">reqs</span></code>\nargument, and env vars, secrets, and working dir is supported just as in\nthe bare metal env.</p>\n<div class=\"highlight-ipython3 notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">conda_env</span> <span class=\"o\">=</span> <span class=\"n\">rh</span><span class=\"o\">.</span><span class=\"n\">conda_env</span><span class=\"p\">(</span><span class=\"n\">conda_env</span><span class=\"o\">=</span><span class=\"s2\">&quot;conda_env.yml&quot;</span><span class=\"p\">,</span> <span class=\"n\">reqs</span><span class=\"o\">=</span><span class=\"p\">[</span><span class=\"s2\">&quot;numpy&quot;</span><span class=\"p\">,</span> <span class=\"s2\">&quot;diffusers&quot;</span><span class=\"p\">],</span> <span class=\"n\">name</span><span class=\"o\">=</span><span class=\"s2\">&quot;yaml_env&quot;</span><span class=\"p\">)</span>\n\n<span class=\"n\">conda_dict</span> <span class=\"o\">=</span> <span class=\"p\">{</span><span class=\"s2\">&quot;name&quot;</span><span class=\"p\">:</span> <span class=\"s2\">&quot;conda_env&quot;</span><span class=\"p\">,</span> <span class=\"s2\">&quot;channels&quot;</span><span class=\"p\">:</span> <span class=\"p\">[</span><span class=\"s2\">&quot;conda-forge&quot;</span><span class=\"p\">],</span> <span class=\"s2\">&quot;dependencies&quot;</span><span class=\"p\">:</span> <span class=\"p\">[</span><span class=\"s2\">&quot;python=3.10.0&quot;</span><span class=\"p\">]}</span>\n<span class=\"n\">conda_env</span> <span class=\"o\">=</span> <span class=\"n\">rh</span><span class=\"o\">.</span><span class=\"n\">env</span><span class=\"p\">(</span><span class=\"n\">conda_env</span><span class=\"o\">=</span><span class=\"n\">conda_dict</span><span class=\"p\">,</span> <span class=\"n\">name</span><span class=\"o\">=</span><span class=\"s2\">&quot;dict_env&quot;</span><span class=\"p\">)</span>\n\n<span class=\"n\">conda_env</span> <span class=\"o\">=</span> <span class=\"n\">rh</span><span class=\"o\">.</span><span class=\"n\">conda_env</span><span class=\"p\">(</span><span class=\"n\">conda_env</span><span class=\"o\">=</span><span class=\"s2\">&quot;local_conda_env&quot;</span><span class=\"p\">,</span> <span class=\"n\">name</span><span class=\"o\">=</span><span class=\"s2\">&quot;from_local_env&quot;</span><span class=\"p\">)</span>\n\n<span class=\"n\">conda_env</span> <span class=\"o\">=</span> <span class=\"n\">rh</span><span class=\"o\">.</span><span class=\"n\">conda_env</span><span class=\"p\">(</span><span class=\"n\">reqs</span><span class=\"o\">=</span><span class=\"p\">[</span><span class=\"s2\">&quot;numpy&quot;</span><span class=\"p\">,</span> <span class=\"s2\">&quot;diffusers&quot;</span><span class=\"p\">],</span> <span class=\"n\">name</span><span class=\"o\">=</span><span class=\"s2\">&quot;new_env&quot;</span><span class=\"p\">)</span>\n</pre></div>\n</div>\n</section>\n<section id=\"envs-on-the-cluster\">\n<h3>Envs on the Cluster<a class=\"headerlink\" href=\"#envs-on-the-cluster\" title=\"Permalink to this heading\">\u00b6</a></h3>\n<p>Runhouse environments are generic environments, and the object itself is\nnot associated with a cluster. However, it is easy to set up an\nenvironment on the cluster, by simply calling the <code class=\"docutils literal notranslate\"><span class=\"pre\">env.to(cluster)</span></code>\nAPI, or by sending your module/function to the env with the\n<code class=\"docutils literal notranslate\"><span class=\"pre\">&lt;rh_fn&gt;.to(cluster=cluster,</span> <span class=\"pre\">env=env)</span></code> API, which will construct and\ncache the environment on the remote cluster.</p>\n<div class=\"highlight-ipython3 notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"c1\"># Function, cluster, and env setup</span>\n<span class=\"k\">def</span> <span class=\"nf\">np_sum</span><span class=\"p\">(</span><span class=\"n\">a</span><span class=\"p\">,</span> <span class=\"n\">b</span><span class=\"p\">):</span>\n    <span class=\"kn\">import</span> <span class=\"nn\">numpy</span> <span class=\"k\">as</span> <span class=\"nn\">np</span>\n    <span class=\"k\">return</span> <span class=\"n\">np</span><span class=\"o\">.</span><span class=\"n\">sum</span><span class=\"p\">([</span><span class=\"n\">a</span><span class=\"p\">,</span> <span class=\"n\">b</span><span class=\"p\">])</span>\n\n<span class=\"n\">cluster</span> <span class=\"o\">=</span> <span class=\"n\">rh</span><span class=\"o\">.</span><span class=\"n\">ondemand_cluster</span><span class=\"p\">(</span><span class=\"s2\">&quot;rh-cluster&quot;</span><span class=\"p\">,</span> <span class=\"n\">instance_type</span><span class=\"o\">=</span><span class=\"s2\">&quot;CPU:2+&quot;</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">up_if_not</span><span class=\"p\">()</span>\n<span class=\"n\">env</span> <span class=\"o\">=</span> <span class=\"n\">rh</span><span class=\"o\">.</span><span class=\"n\">env</span><span class=\"p\">(</span><span class=\"n\">name</span><span class=\"o\">=</span><span class=\"s2\">&quot;np_env&quot;</span><span class=\"p\">,</span> <span class=\"n\">reqs</span><span class=\"o\">=</span><span class=\"p\">[</span><span class=\"s2\">&quot;numpy&quot;</span><span class=\"p\">])</span>\n</pre></div>\n</div>\n<div class=\"highlight-ipython3 notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">remote_np_sum</span> <span class=\"o\">=</span> <span class=\"n\">rh</span><span class=\"o\">.</span><span class=\"n\">function</span><span class=\"p\">(</span><span class=\"n\">np_sum</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">to</span><span class=\"p\">(</span><span class=\"n\">cluster</span><span class=\"p\">,</span> <span class=\"n\">env</span><span class=\"o\">=</span><span class=\"n\">env</span><span class=\"p\">)</span>\n</pre></div>\n</div>\n<div class=\"code-output highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">INFO</span> <span class=\"o\">|</span> <span class=\"mi\">2024</span><span class=\"o\">-</span><span class=\"mi\">02</span><span class=\"o\">-</span><span class=\"mi\">28</span> <span class=\"mi\">21</span><span class=\"p\">:</span><span class=\"mi\">24</span><span class=\"p\">:</span><span class=\"mf\">52.915177</span> <span class=\"o\">|</span> <span class=\"n\">Writing</span> <span class=\"n\">out</span> <span class=\"n\">function</span> <span class=\"n\">to</span> <span class=\"o\">/</span><span class=\"n\">Users</span><span class=\"o\">/</span><span class=\"n\">caroline</span><span class=\"o\">/</span><span class=\"n\">Documents</span><span class=\"o\">/</span><span class=\"n\">runhouse</span><span class=\"o\">/</span><span class=\"n\">notebooks</span><span class=\"o\">/</span><span class=\"n\">docs</span><span class=\"o\">/</span><span class=\"n\">np_sum_fn</span><span class=\"o\">.</span><span class=\"n\">py</span><span class=\"o\">.</span> <span class=\"n\">Please</span> <span class=\"n\">make</span> <span class=\"n\">sure</span> <span class=\"n\">the</span> <span class=\"n\">function</span> <span class=\"n\">does</span> <span class=\"ow\">not</span> <span class=\"n\">rely</span> <span class=\"n\">on</span> <span class=\"nb\">any</span> <span class=\"n\">local</span> <span class=\"n\">variables</span><span class=\"p\">,</span> <span class=\"n\">including</span> <span class=\"n\">imports</span> <span class=\"p\">(</span><span class=\"n\">which</span> <span class=\"n\">should</span> <span class=\"n\">be</span> <span class=\"n\">moved</span> <span class=\"n\">inside</span> <span class=\"n\">the</span> <span class=\"n\">function</span> <span class=\"n\">body</span><span class=\"p\">)</span><span class=\"o\">.</span>\n<span class=\"n\">INFO</span> <span class=\"o\">|</span> <span class=\"mi\">2024</span><span class=\"o\">-</span><span class=\"mi\">02</span><span class=\"o\">-</span><span class=\"mi\">28</span> <span class=\"mi\">21</span><span class=\"p\">:</span><span class=\"mi\">25</span><span class=\"p\">:</span><span class=\"mf\">03.923658</span> <span class=\"o\">|</span> <span class=\"n\">SSH</span> <span class=\"n\">tunnel</span> <span class=\"n\">on</span> <span class=\"n\">to</span> <span class=\"n\">server</span><span class=\"s1\">&#39;s port 32300 via server&#39;</span><span class=\"n\">s</span> <span class=\"n\">ssh</span> <span class=\"n\">port</span> <span class=\"mi\">22</span> <span class=\"n\">already</span> <span class=\"n\">created</span> <span class=\"k\">with</span> <span class=\"n\">the</span> <span class=\"n\">cluster</span><span class=\"o\">.</span>\n<span class=\"n\">INFO</span> <span class=\"o\">|</span> <span class=\"mi\">2024</span><span class=\"o\">-</span><span class=\"mi\">02</span><span class=\"o\">-</span><span class=\"mi\">28</span> <span class=\"mi\">21</span><span class=\"p\">:</span><span class=\"mi\">25</span><span class=\"p\">:</span><span class=\"mf\">04.162828</span> <span class=\"o\">|</span> <span class=\"n\">Server</span> <span class=\"n\">rh</span><span class=\"o\">-</span><span class=\"n\">cluster</span> <span class=\"ow\">is</span> <span class=\"n\">up</span><span class=\"o\">.</span>\n<span class=\"n\">INFO</span> <span class=\"o\">|</span> <span class=\"mi\">2024</span><span class=\"o\">-</span><span class=\"mi\">02</span><span class=\"o\">-</span><span class=\"mi\">28</span> <span class=\"mi\">21</span><span class=\"p\">:</span><span class=\"mi\">25</span><span class=\"p\">:</span><span class=\"mf\">04.166104</span> <span class=\"o\">|</span> <span class=\"n\">Copying</span> <span class=\"n\">package</span> <span class=\"kn\">from</span> <span class=\"nn\">file</span><span class=\"p\">:</span><span class=\"o\">///</span><span class=\"n\">Users</span><span class=\"o\">/</span><span class=\"n\">caroline</span><span class=\"o\">/</span><span class=\"n\">Documents</span><span class=\"o\">/</span><span class=\"n\">runhouse</span><span class=\"o\">/</span><span class=\"n\">notebooks</span> <span class=\"n\">to</span><span class=\"p\">:</span> <span class=\"n\">rh</span><span class=\"o\">-</span><span class=\"n\">cluster</span>\n</pre></div>\n</div>\n<div class=\"code-output highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">INFO</span> <span class=\"o\">|</span> <span class=\"mi\">2024</span><span class=\"o\">-</span><span class=\"mi\">02</span><span class=\"o\">-</span><span class=\"mi\">28</span> <span class=\"mi\">21</span><span class=\"p\">:</span><span class=\"mi\">25</span><span class=\"p\">:</span><span class=\"mf\">07.356780</span> <span class=\"o\">|</span> <span class=\"n\">Calling</span> <span class=\"n\">np_env</span><span class=\"o\">.</span><span class=\"n\">install</span>\n</pre></div>\n</div>\n<div class=\"code-output highlight-default notranslate\"><div class=\"highlight\"><pre><span></span>----------\n\u001b[36mrh-cluster\u001b[0m\n----------\n\u001b[36mInstalling Package: numpy with method pip.\n\u001b[0m\u001b[36mRunning: pip install numpy\n\u001b[0m\u001b[36mInstalling Package: notebooks with method reqs.\n\u001b[0m\u001b[36mreqs path: notebooks/requirements.txt\n\u001b[0m\u001b[36mnotebooks/requirements.txt not found, skipping\n\u001b[0m\n</pre></div>\n</div>\n<div class=\"code-output highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">INFO</span> <span class=\"o\">|</span> <span class=\"mi\">2024</span><span class=\"o\">-</span><span class=\"mi\">02</span><span class=\"o\">-</span><span class=\"mi\">28</span> <span class=\"mi\">21</span><span class=\"p\">:</span><span class=\"mi\">25</span><span class=\"p\">:</span><span class=\"mf\">09.601131</span> <span class=\"o\">|</span> <span class=\"n\">Time</span> <span class=\"n\">to</span> <span class=\"n\">call</span> <span class=\"n\">np_env</span><span class=\"o\">.</span><span class=\"n\">install</span><span class=\"p\">:</span> <span class=\"mf\">2.24</span> <span class=\"n\">seconds</span>\n</pre></div>\n</div>\n<div class=\"code-output highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">INFO</span> <span class=\"o\">|</span> <span class=\"mi\">2024</span><span class=\"o\">-</span><span class=\"mi\">02</span><span class=\"o\">-</span><span class=\"mi\">28</span> <span class=\"mi\">21</span><span class=\"p\">:</span><span class=\"mi\">25</span><span class=\"p\">:</span><span class=\"mf\">16.987243</span> <span class=\"o\">|</span> <span class=\"n\">Sending</span> <span class=\"n\">module</span> <span class=\"n\">np_sum</span> <span class=\"n\">to</span> <span class=\"n\">rh</span><span class=\"o\">-</span><span class=\"n\">cluster</span>\n</pre></div>\n</div>\n<div class=\"highlight-ipython3 notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">remote_np_sum</span><span class=\"p\">(</span><span class=\"mi\">2</span><span class=\"p\">,</span> <span class=\"mi\">3</span><span class=\"p\">)</span>\n</pre></div>\n</div>\n<div class=\"code-output highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">INFO</span> <span class=\"o\">|</span> <span class=\"mi\">2024</span><span class=\"o\">-</span><span class=\"mi\">02</span><span class=\"o\">-</span><span class=\"mi\">28</span> <span class=\"mi\">21</span><span class=\"p\">:</span><span class=\"mi\">38</span><span class=\"p\">:</span><span class=\"mf\">18.997808</span> <span class=\"o\">|</span> <span class=\"n\">Calling</span> <span class=\"n\">np_sum</span><span class=\"o\">.</span><span class=\"n\">call</span>\n<span class=\"n\">INFO</span> <span class=\"o\">|</span> <span class=\"mi\">2024</span><span class=\"o\">-</span><span class=\"mi\">02</span><span class=\"o\">-</span><span class=\"mi\">28</span> <span class=\"mi\">21</span><span class=\"p\">:</span><span class=\"mi\">38</span><span class=\"p\">:</span><span class=\"mf\">20.047907</span> <span class=\"o\">|</span> <span class=\"n\">Time</span> <span class=\"n\">to</span> <span class=\"n\">call</span> <span class=\"n\">np_sum</span><span class=\"o\">.</span><span class=\"n\">call</span><span class=\"p\">:</span> <span class=\"mf\">1.05</span> <span class=\"n\">seconds</span>\n</pre></div>\n</div>\n<div class=\"code-output highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"mi\">5</span>\n</pre></div>\n</div>\n<p>On the cluster, each environment is associated with its own Ray Actor\nservlet, which handles all the activities within the environment\n(installing packages, getting or putting objects, calling functions,\netc). Each env servlet has its own local object store where objects\npersist in Python, and lives in its own process, reducing interprocess\noverhead and eliminating launch overhead for calls made in the same env.</p>\n<section id=\"cluster-default-env\">\n<h4>Cluster Default Env<a class=\"headerlink\" href=\"#cluster-default-env\" title=\"Permalink to this heading\">\u00b6</a></h4>\n<p>The cluster also has a concept of a base default env, which is the\nenvironment on which the runhouse server will be started from. It is the\nenvironment in which cluster calls and computations, such as commands\nand functions, will default to running on, if no other env is specified.</p>\n<p>During cluster initialization, you can specify the default env for the\ncluster. It is constructed as with any other runhouse env, using\n<code class=\"docutils literal notranslate\"><span class=\"pre\">rh.env()</span></code>, and contains any package installations, commands to run,\nor env vars to set prior to starting the Runhouse server, or even a\nparticular conda env to isolate your Runhouse environment. If no default\nenv is specified, runs on the base environment on the cluster (after\nsourcing bash).</p>\n<div class=\"highlight-ipython3 notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"kn\">import</span> <span class=\"nn\">runhouse</span> <span class=\"k\">as</span> <span class=\"nn\">rh</span>\n</pre></div>\n</div>\n<div class=\"highlight-ipython3 notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">default_env</span> <span class=\"o\">=</span> <span class=\"n\">rh</span><span class=\"o\">.</span><span class=\"n\">conda_env</span><span class=\"p\">(</span>\n    <span class=\"n\">name</span><span class=\"o\">=</span><span class=\"s2\">&quot;cluster_default&quot;</span><span class=\"p\">,</span>\n    <span class=\"n\">reqs</span><span class=\"o\">=</span><span class=\"p\">[</span><span class=\"s2\">&quot;skypilot&quot;</span><span class=\"p\">],</span>  <span class=\"c1\"># to enable autostop, which requires skypilot library</span>\n    <span class=\"n\">working_dir</span><span class=\"o\">=</span><span class=\"s2\">&quot;./&quot;</span><span class=\"p\">,</span>\n    <span class=\"n\">env_vars</span><span class=\"o\">=</span><span class=\"p\">{</span><span class=\"s2\">&quot;my_token&quot;</span><span class=\"p\">:</span> <span class=\"s2\">&quot;TOKEN_VAL&quot;</span><span class=\"p\">}</span>\n<span class=\"p\">)</span>\n<span class=\"n\">cluster</span> <span class=\"o\">=</span> <span class=\"n\">rh</span><span class=\"o\">.</span><span class=\"n\">ondemand_cluster</span><span class=\"p\">(</span>\n    <span class=\"n\">name</span><span class=\"o\">=</span><span class=\"s2\">&quot;rh-cpu&quot;</span><span class=\"p\">,</span>\n    <span class=\"n\">instance_type</span><span class=\"o\">=</span><span class=\"s2\">&quot;CPU:2+&quot;</span><span class=\"p\">,</span>\n    <span class=\"n\">provider</span><span class=\"o\">=</span><span class=\"s2\">&quot;aws&quot;</span><span class=\"p\">,</span>\n    <span class=\"n\">default_env</span><span class=\"o\">=</span><span class=\"n\">default_env</span><span class=\"p\">,</span>\n<span class=\"p\">)</span>\n<span class=\"n\">cluster</span><span class=\"o\">.</span><span class=\"n\">up_if_not</span><span class=\"p\">()</span>\n</pre></div>\n</div>\n<p>Now, as we see in the examples below, running a command or sending over\na function without specifying an env will default the default conda env\nthat we have specified for the cluster.</p>\n<div class=\"highlight-ipython3 notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">cluster</span><span class=\"o\">.</span><span class=\"n\">run</span><span class=\"p\">(</span><span class=\"s2\">&quot;conda env list | grep &#39;*&#39;&quot;</span><span class=\"p\">)</span>\n</pre></div>\n</div>\n<div class=\"code-output highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">INFO</span> <span class=\"o\">|</span> <span class=\"mi\">2024</span><span class=\"o\">-</span><span class=\"mi\">05</span><span class=\"o\">-</span><span class=\"mi\">20</span> <span class=\"mi\">18</span><span class=\"p\">:</span><span class=\"mi\">08</span><span class=\"p\">:</span><span class=\"mf\">42.460946</span> <span class=\"o\">|</span> <span class=\"n\">Calling</span> <span class=\"n\">cluster_default</span><span class=\"o\">.</span><span class=\"n\">_run_command</span>\n</pre></div>\n</div>\n<div class=\"code-output highlight-default notranslate\"><div class=\"highlight\"><pre><span></span>\u001b[36mRunning command in cluster_default: conda run -n cluster_default conda env list | grep &#39;*&#39;\n\u001b[0m\u001b[36mcluster_default       *  /opt/conda/envs/cluster_default\n\u001b[0m\n</pre></div>\n</div>\n<div class=\"code-output highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">INFO</span> <span class=\"o\">|</span> <span class=\"mi\">2024</span><span class=\"o\">-</span><span class=\"mi\">05</span><span class=\"o\">-</span><span class=\"mi\">20</span> <span class=\"mi\">18</span><span class=\"p\">:</span><span class=\"mi\">08</span><span class=\"p\">:</span><span class=\"mf\">45.130137</span> <span class=\"o\">|</span> <span class=\"n\">Time</span> <span class=\"n\">to</span> <span class=\"n\">call</span> <span class=\"n\">cluster_default</span><span class=\"o\">.</span><span class=\"n\">_run_command</span><span class=\"p\">:</span> <span class=\"mf\">2.67</span> <span class=\"n\">seconds</span>\n</pre></div>\n</div>\n<pre class=\"code-output literal-block\">[(0, 'cluster_default       *  /opt/conda/envs/cluster_defaultn', '')]</pre>\n<div class=\"highlight-ipython3 notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"k\">def</span> <span class=\"nf\">check_import</span><span class=\"p\">():</span>\n    <span class=\"kn\">import</span> <span class=\"nn\">sky</span>\n    <span class=\"k\">return</span> <span class=\"s2\">&quot;import succeeded&quot;</span>\n</pre></div>\n</div>\n<div class=\"highlight-ipython3 notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">check_remote_import</span> <span class=\"o\">=</span> <span class=\"n\">rh</span><span class=\"o\">.</span><span class=\"n\">function</span><span class=\"p\">(</span><span class=\"n\">check_import</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">to</span><span class=\"p\">(</span><span class=\"n\">cluster</span><span class=\"p\">)</span>\n</pre></div>\n</div>\n<div class=\"highlight-ipython3 notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">check_remote_import</span><span class=\"p\">()</span>\n</pre></div>\n</div>\n<div class=\"code-output highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">INFO</span> <span class=\"o\">|</span> <span class=\"mi\">2024</span><span class=\"o\">-</span><span class=\"mi\">05</span><span class=\"o\">-</span><span class=\"mi\">20</span> <span class=\"mi\">18</span><span class=\"p\">:</span><span class=\"mi\">30</span><span class=\"p\">:</span><span class=\"mf\">05.128009</span> <span class=\"o\">|</span> <span class=\"n\">Calling</span> <span class=\"n\">check_import</span><span class=\"o\">.</span><span class=\"n\">call</span>\n<span class=\"n\">INFO</span> <span class=\"o\">|</span> <span class=\"mi\">2024</span><span class=\"o\">-</span><span class=\"mi\">05</span><span class=\"o\">-</span><span class=\"mi\">20</span> <span class=\"mi\">18</span><span class=\"p\">:</span><span class=\"mi\">30</span><span class=\"p\">:</span><span class=\"mf\">05.691348</span> <span class=\"o\">|</span> <span class=\"n\">Time</span> <span class=\"n\">to</span> <span class=\"n\">call</span> <span class=\"n\">check_import</span><span class=\"o\">.</span><span class=\"n\">call</span><span class=\"p\">:</span> <span class=\"mf\">0.56</span> <span class=\"n\">seconds</span>\n</pre></div>\n</div>\n<div class=\"code-output highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"s1\">&#39;import succeeded&#39;</span>\n</pre></div>\n</div>\n</section>\n</section>\n</section>\n</section>\n\n    <script type=\"text/x-thebe-config\">\n    {\n        requestKernel: true,\n        binderOptions: {\n            repo: \"binder-examples/jupyter-stacks-datascience\",\n            ref: \"master\",\n        },\n        codeMirrorConfig: {\n            theme: \"abcdef\",\n            mode: \"python\"\n        },\n        kernelOptions: {\n            kernelName: \"python3\",\n            path: \"./tutorials\"\n        },\n        predefinedOutput: true\n    }\n    </script>\n    <script>kernelName = 'python3'</script>", "metatags": "<meta name=\"generator\" content=\"Docutils 0.18.1: http://docutils.sourceforge.net/\" />\n", "rellinks": [["genindex", "General Index", "I", "index"], ["py-modindex", "Python Module Index", "", "modules"], ["tutorials/api-folders", "Folders", "N", "next"], ["tutorials/api-modules", "Functions and Modules", "P", "previous"]], "sourcename": "tutorials/api-envs.rst.txt", "toc": "<ul>\n<li><a class=\"reference internal\" href=\"#\">Envs and Packages</a><ul>\n<li><a class=\"reference internal\" href=\"#packages\">Packages</a></li>\n<li><a class=\"reference internal\" href=\"#envs\">Envs</a><ul>\n<li><a class=\"reference internal\" href=\"#bare-metal-envs\">Bare Metal Envs</a></li>\n<li><a class=\"reference internal\" href=\"#conda-envs\">Conda Envs</a></li>\n<li><a class=\"reference internal\" href=\"#envs-on-the-cluster\">Envs on the Cluster</a><ul>\n<li><a class=\"reference internal\" href=\"#cluster-default-env\">Cluster Default Env</a></li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n", "display_toc": true, "page_source_suffix": ".rst", "globaltoc": "<p class=\"caption\" role=\"heading\"><span class=\"caption-text\">Getting Started</span></p>\n<ul>\n<li class=\"toctree-l1\"><a class=\"reference internal\" href=\"tutorials/quick-start-cloud/\">Cloud Quick Start</a></li>\n<li class=\"toctree-l1\"><a class=\"reference internal\" href=\"tutorials/quick-start-local/\">Local Quick Start</a></li>\n<li class=\"toctree-l1\"><a class=\"reference internal\" href=\"tutorials/quick-start-den/\">Den Quick Start</a></li>\n</ul>\n<p class=\"caption\" role=\"heading\"><span class=\"caption-text\">API Basics</span></p>\n<ul>\n<li class=\"toctree-l1\"><a class=\"reference internal\" href=\"tutorials/api-clusters/\">Clusters</a></li>\n<li class=\"toctree-l1\"><a class=\"reference internal\" href=\"tutorials/api-modules/\">Functions and Modules</a></li>\n<li class=\"toctree-l1\"><a class=\"reference internal\" href=\"tutorials/api-envs/\">Envs and Packages</a></li>\n<li class=\"toctree-l1\"><a class=\"reference internal\" href=\"tutorials/api-folders/\">Folders</a></li>\n<li class=\"toctree-l1\"><a class=\"reference internal\" href=\"tutorials/api-secrets/\">Secrets</a></li>\n<li class=\"toctree-l1\"><a class=\"reference internal\" href=\"tutorials/api-resources/\">Resource Management</a></li>\n</ul>\n<p class=\"caption\" role=\"heading\"><span class=\"caption-text\">API Reference</span></p>\n<ul>\n<li class=\"toctree-l1\"><a class=\"reference internal\" href=\"api/python/\">Python API</a><ul>\n<li class=\"toctree-l2\"><a class=\"reference internal\" href=\"api/python/resource/\">Resource</a></li>\n<li class=\"toctree-l2\"><a class=\"reference internal\" href=\"api/python/function/\">Function</a></li>\n<li class=\"toctree-l2\"><a class=\"reference internal\" href=\"api/python/cluster/\">Cluster</a></li>\n<li class=\"toctree-l2\"><a class=\"reference internal\" href=\"api/python/env/\">Env</a></li>\n<li class=\"toctree-l2\"><a class=\"reference internal\" href=\"api/python/package/\">Package</a></li>\n<li class=\"toctree-l2\"><a class=\"reference internal\" href=\"api/python/module/\">Module</a></li>\n<li class=\"toctree-l2\"><a class=\"reference internal\" href=\"api/python/mapper/\">Mapper</a></li>\n<li class=\"toctree-l2\"><a class=\"reference internal\" href=\"api/python/folder/\">Folder</a></li>\n<li class=\"toctree-l2\"><a class=\"reference internal\" href=\"api/python/table/\">Table</a></li>\n<li class=\"toctree-l2\"><a class=\"reference internal\" href=\"api/python/blob/\">Blob</a></li>\n<li class=\"toctree-l2\"><a class=\"reference internal\" href=\"api/python/file/\">File</a></li>\n<li class=\"toctree-l2\"><a class=\"reference internal\" href=\"api/python/secrets/\">Secrets</a></li>\n<li class=\"toctree-l2\"><a class=\"reference internal\" href=\"api/python/login/\">Login/Logout</a></li>\n</ul>\n</li>\n<li class=\"toctree-l1\"><a class=\"reference internal\" href=\"api/cli/\">Command Line Interface</a></li>\n</ul>\n<p class=\"caption\" role=\"heading\"><span class=\"caption-text\">Other Topics</span></p>\n<ul>\n<li class=\"toctree-l1\"><a class=\"reference internal\" href=\"tutorials/async/\">Asynchronous Programming</a></li>\n<li class=\"toctree-l1\"><a class=\"reference internal\" href=\"architecture/\">Architecture Overview</a></li>\n<li class=\"toctree-l1\"><a class=\"reference internal\" href=\"debugging-logging/\">Debugging and Logging</a></li>\n<li class=\"toctree-l1\"><a class=\"reference internal\" href=\"docker/\">Docker Runtime Env</a></li>\n<li class=\"toctree-l1\"><a class=\"reference internal\" href=\"troubleshooting/\">Manual Setup and Troubleshooting</a></li>\n<li class=\"toctree-l1\"><a class=\"reference internal\" href=\"security-and-authentication/\">Security and Authentication</a></li>\n</ul>\n", "current_page_name": "tutorials/api-envs", "sidebars": ["about.html", "navigation.html", "relations.html", "searchbox.html", "donate.html"], "customsidebar": null, "favicon_url": null, "logo_url": null, "alabaster_version": "0.7.12"}