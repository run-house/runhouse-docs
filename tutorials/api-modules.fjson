{"parents": [], "prev": {"link": "../api-clusters/", "title": "Clusters"}, "next": {"link": "../api-folders/", "title": "Folders"}, "title": "Functions and Modules", "meta": {}, "body": "<section id=\"functions-and-modules\">\n<h1>Functions and Modules<a class=\"headerlink\" href=\"#functions-and-modules\" title=\"Permalink to this heading\">\u00b6</a></h1>\n<p><a href=\"https://colab.research.google.com/github/run-house/notebooks/blob/stable/docs/api-modules.ipynb\">\n<img height=\"20px\" width=\"117px\" src=\"https://colab.research.google.com/assets/colab-badge.svg\" alt=\"Open In Colab\"/></a></p><p>Runhouse makes Python functions and modules portable. Runhouse functions\nand modules are wrappers around Python code for functions and classes,\nthat can live on remote compute and be run remotely. Once constructed,\nthey can be called natively in Python from your local environment, and\nthey come with a suite of built-in, ready-to-use features like logging,\nstreaming, and mapping.</p>\n<section id=\"setup\">\n<h2>Setup<a class=\"headerlink\" href=\"#setup\" title=\"Permalink to this heading\">\u00b6</a></h2>\n<p>We first construct a Runhouse Cluster resource, which is the compute to\nwhich we will be sending and running our remote Python code on. You can\nread more in the <a class=\"reference external\" href=\"https://www.run.house/docs/tutorials/api-clusters\">Cluster\ntutorial</a>.</p>\n<div class=\"highlight-ipython3 notranslate\"><div class=\"highlight\"><pre><span></span>import runhouse as rh\n</pre></div>\n</div>\n<div class=\"highlight-ipython3 notranslate\"><div class=\"highlight\"><pre><span></span>cluster = rh.cluster(\n    name=&quot;rh-cluster&quot;,\n    instance_type=&quot;CPU:2+&quot;,\n    provider=&quot;aws&quot;,\n)\ncluster.up_if_not()\n</pre></div>\n</div>\n</section>\n<section id=\"runhouse-functions\">\n<h2>Runhouse Functions<a class=\"headerlink\" href=\"#runhouse-functions\" title=\"Permalink to this heading\">\u00b6</a></h2>\n<p>A Runhouse Function wraps a function, and can be send to remote hardware\nto be run as a subroutine or service.</p>\n<p>Let\u2019s start by defining a Python function locally. This function uses\nthe <code class=\"docutils literal notranslate\"><span class=\"pre\">numpy</span></code> package to return the sum of the two input arguments.</p>\n<div class=\"highlight-ipython3 notranslate\"><div class=\"highlight\"><pre><span></span>def np_sum(a, b):\n    import numpy as np\n    return np.sum([a, b])\n</pre></div>\n</div>\n<p>We set up the function on the cluster by</p>\n<ul class=\"simple\">\n<li><p>wrapping it with <code class=\"docutils literal notranslate\"><span class=\"pre\">rh.function(np_env)</span></code></p></li>\n<li><p>sending it <code class=\"docutils literal notranslate\"><span class=\"pre\">.to(cluster)</span></code></p></li>\n</ul>\n<p>When this is called, the underlying code is synced over and dependencies\nare set up.</p>\n<div class=\"highlight-ipython3 notranslate\"><div class=\"highlight\"><pre><span></span>remote_np_sum = rh.function(np_sum).to(cluster)\n</pre></div>\n</div>\n<div class=\"code-output highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">INFO</span> <span class=\"o\">|</span> <span class=\"mi\">2024</span><span class=\"o\">-</span><span class=\"mi\">02</span><span class=\"o\">-</span><span class=\"mi\">27</span> <span class=\"mi\">20</span><span class=\"p\">:</span><span class=\"mi\">21</span><span class=\"p\">:</span><span class=\"mf\">54.329646</span> <span class=\"o\">|</span> <span class=\"n\">Writing</span> <span class=\"n\">out</span> <span class=\"n\">function</span> <span class=\"n\">to</span> <span class=\"o\">/</span><span class=\"n\">Users</span><span class=\"o\">/</span><span class=\"n\">caroline</span><span class=\"o\">/</span><span class=\"n\">Documents</span><span class=\"o\">/</span><span class=\"n\">runhouse</span><span class=\"o\">/</span><span class=\"n\">notebooks</span><span class=\"o\">/</span><span class=\"n\">docs</span><span class=\"o\">/</span><span class=\"n\">np_sum_fn</span><span class=\"o\">.</span><span class=\"n\">py</span><span class=\"o\">.</span> <span class=\"n\">Please</span> <span class=\"n\">make</span> <span class=\"n\">sure</span> <span class=\"n\">the</span> <span class=\"n\">function</span> <span class=\"n\">does</span> <span class=\"ow\">not</span> <span class=\"n\">rely</span> <span class=\"n\">on</span> <span class=\"nb\">any</span> <span class=\"n\">local</span> <span class=\"n\">variables</span><span class=\"p\">,</span> <span class=\"n\">including</span> <span class=\"n\">imports</span> <span class=\"p\">(</span><span class=\"n\">which</span> <span class=\"n\">should</span> <span class=\"n\">be</span> <span class=\"n\">moved</span> <span class=\"n\">inside</span> <span class=\"n\">the</span> <span class=\"n\">function</span> <span class=\"n\">body</span><span class=\"p\">)</span><span class=\"o\">.</span>\n<span class=\"n\">INFO</span> <span class=\"o\">|</span> <span class=\"mi\">2024</span><span class=\"o\">-</span><span class=\"mi\">02</span><span class=\"o\">-</span><span class=\"mi\">27</span> <span class=\"mi\">20</span><span class=\"p\">:</span><span class=\"mi\">21</span><span class=\"p\">:</span><span class=\"mf\">55.378194</span> <span class=\"o\">|</span> <span class=\"n\">Server</span> <span class=\"n\">rh</span><span class=\"o\">-</span><span class=\"n\">cluster</span> <span class=\"ow\">is</span> <span class=\"n\">up</span><span class=\"o\">.</span>\n<span class=\"n\">INFO</span> <span class=\"o\">|</span> <span class=\"mi\">2024</span><span class=\"o\">-</span><span class=\"mi\">02</span><span class=\"o\">-</span><span class=\"mi\">27</span> <span class=\"mi\">20</span><span class=\"p\">:</span><span class=\"mi\">21</span><span class=\"p\">:</span><span class=\"mf\">55.384844</span> <span class=\"o\">|</span> <span class=\"n\">Copying</span> <span class=\"n\">package</span> <span class=\"kn\">from</span> <span class=\"nn\">file</span><span class=\"p\">:</span><span class=\"o\">///</span><span class=\"n\">Users</span><span class=\"o\">/</span><span class=\"n\">caroline</span><span class=\"o\">/</span><span class=\"n\">Documents</span><span class=\"o\">/</span><span class=\"n\">runhouse</span><span class=\"o\">/</span><span class=\"n\">notebooks</span> <span class=\"n\">to</span><span class=\"p\">:</span> <span class=\"n\">rh</span><span class=\"o\">-</span><span class=\"n\">cluster</span>\n<span class=\"n\">INFO</span> <span class=\"o\">|</span> <span class=\"mi\">2024</span><span class=\"o\">-</span><span class=\"mi\">02</span><span class=\"o\">-</span><span class=\"mi\">27</span> <span class=\"mi\">20</span><span class=\"p\">:</span><span class=\"mi\">22</span><span class=\"p\">:</span><span class=\"mf\">06.614361</span> <span class=\"o\">|</span> <span class=\"n\">Calling</span> <span class=\"n\">base_env</span><span class=\"o\">.</span><span class=\"n\">install</span>\n</pre></div>\n</div>\n<div class=\"code-output highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"o\">----------</span>\n<span class=\"p\">[</span><span class=\"mi\">36</span><span class=\"n\">mrh</span><span class=\"o\">-</span><span class=\"n\">cluster</span><span class=\"p\">[</span><span class=\"mi\">0</span><span class=\"n\">m</span>\n<span class=\"o\">----------</span>\n<span class=\"p\">[</span><span class=\"mi\">36</span><span class=\"n\">mInstalling</span> <span class=\"n\">Package</span><span class=\"p\">:</span> <span class=\"n\">numpy</span> <span class=\"k\">with</span> <span class=\"n\">method</span> <span class=\"n\">pip</span><span class=\"o\">.</span>\n<span class=\"p\">[</span><span class=\"mi\">0</span><span class=\"n\">m</span><span class=\"p\">[</span><span class=\"mi\">36</span><span class=\"n\">mRunning</span><span class=\"p\">:</span> <span class=\"n\">pip</span> <span class=\"n\">install</span> <span class=\"n\">numpy</span>\n<span class=\"p\">[</span><span class=\"mi\">0</span><span class=\"n\">m</span><span class=\"p\">[</span><span class=\"mi\">36</span><span class=\"n\">mInstalling</span> <span class=\"n\">Package</span><span class=\"p\">:</span> <span class=\"n\">notebooks</span> <span class=\"k\">with</span> <span class=\"n\">method</span> <span class=\"n\">reqs</span><span class=\"o\">.</span>\n<span class=\"p\">[</span><span class=\"mi\">0</span><span class=\"n\">m</span><span class=\"p\">[</span><span class=\"mi\">36</span><span class=\"n\">mreqs</span> <span class=\"n\">path</span><span class=\"p\">:</span> <span class=\"n\">notebooks</span><span class=\"o\">/</span><span class=\"n\">requirements</span><span class=\"o\">.</span><span class=\"n\">txt</span>\n<span class=\"p\">[</span><span class=\"mi\">0</span><span class=\"n\">m</span><span class=\"p\">[</span><span class=\"mi\">36</span><span class=\"n\">mnotebooks</span><span class=\"o\">/</span><span class=\"n\">requirements</span><span class=\"o\">.</span><span class=\"n\">txt</span> <span class=\"ow\">not</span> <span class=\"n\">found</span><span class=\"p\">,</span> <span class=\"n\">skipping</span>\n</pre></div>\n</div>\n<div class=\"code-output highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">INFO</span> <span class=\"o\">|</span> <span class=\"mi\">2024</span><span class=\"o\">-</span><span class=\"mi\">02</span><span class=\"o\">-</span><span class=\"mi\">27</span> <span class=\"mi\">20</span><span class=\"p\">:</span><span class=\"mi\">22</span><span class=\"p\">:</span><span class=\"mf\">09.486367</span> <span class=\"o\">|</span> <span class=\"n\">Time</span> <span class=\"n\">to</span> <span class=\"n\">call</span> <span class=\"n\">base_env</span><span class=\"o\">.</span><span class=\"n\">install</span><span class=\"p\">:</span> <span class=\"mf\">2.87</span> <span class=\"n\">seconds</span>\n<span class=\"n\">INFO</span> <span class=\"o\">|</span> <span class=\"mi\">2024</span><span class=\"o\">-</span><span class=\"mi\">02</span><span class=\"o\">-</span><span class=\"mi\">27</span> <span class=\"mi\">20</span><span class=\"p\">:</span><span class=\"mi\">22</span><span class=\"p\">:</span><span class=\"mf\">18.091062</span> <span class=\"o\">|</span> <span class=\"n\">Sending</span> <span class=\"n\">module</span> <span class=\"n\">np_sum</span> <span class=\"n\">to</span> <span class=\"n\">rh</span><span class=\"o\">-</span><span class=\"n\">cluster</span>\n</pre></div>\n</div>\n<p>Running the function remotely is as simple as if you were running it\nlocally. Below, the function runs remotely on the cluster, and returns\nthe results to your local environment.</p>\n<div class=\"highlight-ipython3 notranslate\"><div class=\"highlight\"><pre><span></span>remote_np_sum(1, 5)\n</pre></div>\n</div>\n<div class=\"code-output highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">INFO</span> <span class=\"o\">|</span> <span class=\"mi\">2024</span><span class=\"o\">-</span><span class=\"mi\">02</span><span class=\"o\">-</span><span class=\"mi\">27</span> <span class=\"mi\">20</span><span class=\"p\">:</span><span class=\"mi\">49</span><span class=\"p\">:</span><span class=\"mf\">41.688705</span> <span class=\"o\">|</span> <span class=\"n\">Calling</span> <span class=\"n\">np_sum</span><span class=\"o\">.</span><span class=\"n\">call</span>\n<span class=\"n\">INFO</span> <span class=\"o\">|</span> <span class=\"mi\">2024</span><span class=\"o\">-</span><span class=\"mi\">02</span><span class=\"o\">-</span><span class=\"mi\">27</span> <span class=\"mi\">20</span><span class=\"p\">:</span><span class=\"mi\">49</span><span class=\"p\">:</span><span class=\"mf\">42.944473</span> <span class=\"o\">|</span> <span class=\"n\">Time</span> <span class=\"n\">to</span> <span class=\"n\">call</span> <span class=\"n\">np_sum</span><span class=\"o\">.</span><span class=\"n\">call</span><span class=\"p\">:</span> <span class=\"mf\">1.26</span> <span class=\"n\">seconds</span>\n</pre></div>\n</div>\n<div class=\"code-output highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"mi\">6</span>\n</pre></div>\n</div>\n</section>\n<section id=\"runhouse-modules\">\n<h2>Runhouse Modules<a class=\"headerlink\" href=\"#runhouse-modules\" title=\"Permalink to this heading\">\u00b6</a></h2>\n<p>A Function is a subclass of a more generic Runhouse concept called a\nModule, which represents the class analogue to a function. Like a\nFunction, you can send a Module to a remote cluster and interact with it\nnatively by calling its methods, but it can also persist and utilize\nlive state via instance methods.</p>\n<p>Introducing state into a service means being able to spin up, connect,\nand secure auxiliary services like Redis, Celery, etc. In Runhouse,\nstate is built in, and lives natively in-memory in Python so it\u2019s\nridiculously fast.</p>\n<section id=\"converting-existing-class-to-runhouse-module\">\n<h3>Converting Existing Class to Runhouse Module<a class=\"headerlink\" href=\"#converting-existing-class-to-runhouse-module\" title=\"Permalink to this heading\">\u00b6</a></h3>\n<p>If you have a native Python class that you would like to run remotely,\nyou can directly convert it into a Runhouse Module via the <code class=\"docutils literal notranslate\"><span class=\"pre\">rh.module</span></code>\nfactory function.</p>\n<ul class=\"simple\">\n<li><p>Pass in the Python class to <code class=\"docutils literal notranslate\"><span class=\"pre\">rh.module()</span></code></p></li>\n<li><p>Call <code class=\"docutils literal notranslate\"><span class=\"pre\">.to(cluster)</span></code> to sync the class across to the cluster</p></li>\n<li><p>Create a class instance and call their functions just as you would a\nlocally defined class. The function runs remotely, and returns the\nresult locally.</p></li>\n</ul>\n<div class=\"highlight-ipython3 notranslate\"><div class=\"highlight\"><pre><span></span>%%writefile bert_module.py\n\nfrom transformers import AutoModel, AutoTokenizer\nimport runhouse as rh\n\n\nclass BERT:\n    def __init__(self, model_id=&quot;google-bert/bert-base-uncased&quot;):\n        self.model_id = model_id\n        self.model = None\n        self.tokenizer = None\n\n    def load_model(self):\n        self.tokenizer = AutoTokenizer.from_pretrained(self.model_id)\n        self.model = AutoModel.from_pretrained(self.model_id)\n\n    def embed(self, samples):\n        if not self.model:\n            self.load_model()\n        tokens = self.tokenizer(samples, return_tensors=&quot;pt&quot;, padding=True, truncation=True)\n        return self.model(tokens.input_ids, attention_mask=tokens.attention_mask).last_hidden_state\n</pre></div>\n</div>\n<div class=\"code-output highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">Writing</span> <span class=\"n\">bert_module</span><span class=\"o\">.</span><span class=\"n\">py</span>\n</pre></div>\n</div>\n<div class=\"highlight-ipython3 notranslate\"><div class=\"highlight\"><pre><span></span>from bert_module import BERT\n\nimg = rh.Image(&quot;my_image&quot;).install_packages([&quot;torch&quot;, &quot;transformers&quot;])\n\nmy_gpu = rh.cluster(name=&quot;rh-a10g&quot;, instance_type=&quot;A10G:1&quot;, image = img).up_if_not()\nRemoteBERT = rh.module(BERT).to(my_gpu)\n</pre></div>\n</div>\n<div class=\"code-output highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">INFO</span> <span class=\"o\">|</span> <span class=\"mi\">2024</span><span class=\"o\">-</span><span class=\"mi\">06</span><span class=\"o\">-</span><span class=\"mi\">28</span> <span class=\"mi\">13</span><span class=\"p\">:</span><span class=\"mi\">38</span><span class=\"p\">:</span><span class=\"mf\">52.123093</span> <span class=\"o\">|</span> <span class=\"n\">SSH</span> <span class=\"n\">tunnel</span> <span class=\"n\">on</span> <span class=\"n\">to</span> <span class=\"n\">server</span><span class=\"s1\">&#39;s port 32300 via server&#39;</span><span class=\"n\">s</span> <span class=\"n\">ssh</span> <span class=\"n\">port</span> <span class=\"mi\">22</span> <span class=\"n\">already</span> <span class=\"n\">created</span> <span class=\"k\">with</span> <span class=\"n\">the</span> <span class=\"n\">cluster</span><span class=\"o\">.</span>\n<span class=\"n\">INFO</span> <span class=\"o\">|</span> <span class=\"mi\">2024</span><span class=\"o\">-</span><span class=\"mi\">06</span><span class=\"o\">-</span><span class=\"mi\">28</span> <span class=\"mi\">13</span><span class=\"p\">:</span><span class=\"mi\">38</span><span class=\"p\">:</span><span class=\"mf\">52.672446</span> <span class=\"o\">|</span> <span class=\"n\">Server</span> <span class=\"n\">rh</span><span class=\"o\">-</span><span class=\"n\">a10g</span> <span class=\"ow\">is</span> <span class=\"n\">up</span><span class=\"o\">.</span>\n<span class=\"n\">INFO</span> <span class=\"o\">|</span> <span class=\"mi\">2024</span><span class=\"o\">-</span><span class=\"mi\">06</span><span class=\"o\">-</span><span class=\"mi\">28</span> <span class=\"mi\">13</span><span class=\"p\">:</span><span class=\"mi\">38</span><span class=\"p\">:</span><span class=\"mf\">52.685503</span> <span class=\"o\">|</span> <span class=\"n\">Copying</span> <span class=\"n\">package</span> <span class=\"kn\">from</span> <span class=\"nn\">file</span><span class=\"p\">:</span><span class=\"o\">///</span><span class=\"n\">Users</span><span class=\"o\">/</span><span class=\"n\">josh</span><span class=\"o\">.</span><span class=\"n\">l</span><span class=\"o\">/</span><span class=\"n\">dev</span><span class=\"o\">/</span><span class=\"n\">notebooks</span> <span class=\"n\">to</span><span class=\"p\">:</span> <span class=\"n\">rh</span><span class=\"o\">-</span><span class=\"n\">a10g</span>\n<span class=\"n\">INFO</span> <span class=\"o\">|</span> <span class=\"mi\">2024</span><span class=\"o\">-</span><span class=\"mi\">06</span><span class=\"o\">-</span><span class=\"mi\">28</span> <span class=\"mi\">13</span><span class=\"p\">:</span><span class=\"mi\">38</span><span class=\"p\">:</span><span class=\"mf\">55.339610</span> <span class=\"o\">|</span> <span class=\"n\">Calling</span> <span class=\"n\">_cluster_default_env</span><span class=\"o\">.</span><span class=\"n\">_install_reqs</span>\n</pre></div>\n</div>\n<div class=\"code-output highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"o\">-------</span>\n<span class=\"p\">[</span><span class=\"mi\">36</span><span class=\"n\">mrh</span><span class=\"o\">-</span><span class=\"n\">a10g</span>\n<span class=\"o\">-------</span>\n<span class=\"p\">[</span><span class=\"mi\">36</span><span class=\"n\">mInstalling</span> <span class=\"n\">Package</span><span class=\"p\">:</span> <span class=\"n\">torch</span> <span class=\"k\">with</span> <span class=\"n\">method</span> <span class=\"n\">pip</span><span class=\"o\">.</span>\n<span class=\"p\">[</span><span class=\"mi\">0</span><span class=\"n\">m</span><span class=\"p\">[</span><span class=\"mi\">36</span><span class=\"n\">mInstalling</span> <span class=\"n\">Package</span><span class=\"p\">:</span> <span class=\"n\">transformers</span> <span class=\"k\">with</span> <span class=\"n\">method</span> <span class=\"n\">pip</span><span class=\"o\">.</span>\n<span class=\"p\">[</span><span class=\"mi\">0</span><span class=\"n\">m</span><span class=\"p\">[</span><span class=\"mi\">36</span><span class=\"n\">mInstalling</span> <span class=\"n\">Package</span><span class=\"p\">:</span> <span class=\"o\">~/</span><span class=\"n\">notebooks</span> <span class=\"k\">with</span> <span class=\"n\">method</span> <span class=\"n\">reqs</span><span class=\"o\">.</span>\n<span class=\"p\">[</span><span class=\"mi\">0</span><span class=\"n\">m</span><span class=\"p\">[</span><span class=\"mi\">36</span><span class=\"n\">m</span><span class=\"o\">/</span><span class=\"n\">home</span><span class=\"o\">/</span><span class=\"n\">ubuntu</span><span class=\"o\">/</span><span class=\"n\">notebooks</span><span class=\"o\">/</span><span class=\"n\">requirements</span><span class=\"o\">.</span><span class=\"n\">txt</span> <span class=\"ow\">not</span> <span class=\"n\">found</span><span class=\"p\">,</span> <span class=\"n\">skipping</span>\n</pre></div>\n</div>\n<div class=\"code-output highlight-default notranslate\"><div class=\"highlight\"><pre><span></span>INFO | 2024-06-28 13:38:59.514676 | Time to call _cluster_default_env._install_reqs: 4.18 seconds\nINFO | 2024-06-28 13:38:59.528542 | Calling _cluster_default_env._run_setup_cmds\nINFO | 2024-06-28 13:39:00.183951 | Time to call _cluster_default_env._run_setup_cmds: 0.66 seconds\nINFO | 2024-06-28 13:39:00.196598 | Sending module BERT of type &lt;class &#39;runhouse.resources.module.BERT&#39;&gt; to rh-a10g\n</pre></div>\n</div>\n<div class=\"highlight-ipython3 notranslate\"><div class=\"highlight\"><pre><span></span>remote_model = RemoteBERT(&quot;google-bert/bert-base-uncased&quot;)\nprint(remote_model.embed([&quot;Hello, world!&quot;]))\n</pre></div>\n</div>\n<div class=\"code-output highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">INFO</span> <span class=\"o\">|</span> <span class=\"mi\">2024</span><span class=\"o\">-</span><span class=\"mi\">06</span><span class=\"o\">-</span><span class=\"mi\">28</span> <span class=\"mi\">13</span><span class=\"p\">:</span><span class=\"mi\">39</span><span class=\"p\">:</span><span class=\"mf\">19.756608</span> <span class=\"o\">|</span> <span class=\"n\">Calling</span> <span class=\"n\">BERT</span><span class=\"o\">.</span><span class=\"n\">_remote_init</span>\n<span class=\"n\">INFO</span> <span class=\"o\">|</span> <span class=\"mi\">2024</span><span class=\"o\">-</span><span class=\"mi\">06</span><span class=\"o\">-</span><span class=\"mi\">28</span> <span class=\"mi\">13</span><span class=\"p\">:</span><span class=\"mi\">39</span><span class=\"p\">:</span><span class=\"mf\">20.416427</span> <span class=\"o\">|</span> <span class=\"n\">Time</span> <span class=\"n\">to</span> <span class=\"n\">call</span> <span class=\"n\">BERT</span><span class=\"o\">.</span><span class=\"n\">_remote_init</span><span class=\"p\">:</span> <span class=\"mf\">0.66</span> <span class=\"n\">seconds</span>\n<span class=\"n\">INFO</span> <span class=\"o\">|</span> <span class=\"mi\">2024</span><span class=\"o\">-</span><span class=\"mi\">06</span><span class=\"o\">-</span><span class=\"mi\">28</span> <span class=\"mi\">13</span><span class=\"p\">:</span><span class=\"mi\">39</span><span class=\"p\">:</span><span class=\"mf\">20.424210</span> <span class=\"o\">|</span> <span class=\"n\">Calling</span> <span class=\"n\">BERT</span><span class=\"o\">.</span><span class=\"n\">embed</span>\n<span class=\"n\">INFO</span> <span class=\"o\">|</span> <span class=\"mi\">2024</span><span class=\"o\">-</span><span class=\"mi\">06</span><span class=\"o\">-</span><span class=\"mi\">28</span> <span class=\"mi\">13</span><span class=\"p\">:</span><span class=\"mi\">39</span><span class=\"p\">:</span><span class=\"mf\">23.748200</span> <span class=\"o\">|</span> <span class=\"n\">Time</span> <span class=\"n\">to</span> <span class=\"n\">call</span> <span class=\"n\">BERT</span><span class=\"o\">.</span><span class=\"n\">embed</span><span class=\"p\">:</span> <span class=\"mf\">3.32</span> <span class=\"n\">seconds</span>\n</pre></div>\n</div>\n<div class=\"code-output highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">tensor</span><span class=\"p\">([[[</span><span class=\"o\">-</span><span class=\"mf\">0.0781</span><span class=\"p\">,</span>  <span class=\"mf\">0.1587</span><span class=\"p\">,</span>  <span class=\"mf\">0.0400</span><span class=\"p\">,</span>  <span class=\"o\">...</span><span class=\"p\">,</span> <span class=\"o\">-</span><span class=\"mf\">0.2805</span><span class=\"p\">,</span>  <span class=\"mf\">0.0248</span><span class=\"p\">,</span>  <span class=\"mf\">0.4081</span><span class=\"p\">],</span>\n         <span class=\"p\">[</span><span class=\"o\">-</span><span class=\"mf\">0.2016</span><span class=\"p\">,</span>  <span class=\"mf\">0.1781</span><span class=\"p\">,</span>  <span class=\"mf\">0.4184</span><span class=\"p\">,</span>  <span class=\"o\">...</span><span class=\"p\">,</span> <span class=\"o\">-</span><span class=\"mf\">0.2522</span><span class=\"p\">,</span>  <span class=\"mf\">0.3630</span><span class=\"p\">,</span> <span class=\"o\">-</span><span class=\"mf\">0.0979</span><span class=\"p\">],</span>\n         <span class=\"p\">[</span><span class=\"o\">-</span><span class=\"mf\">0.7156</span><span class=\"p\">,</span>  <span class=\"mf\">0.6751</span><span class=\"p\">,</span>  <span class=\"mf\">0.6017</span><span class=\"p\">,</span>  <span class=\"o\">...</span><span class=\"p\">,</span> <span class=\"o\">-</span><span class=\"mf\">1.1032</span><span class=\"p\">,</span>  <span class=\"mf\">0.0797</span><span class=\"p\">,</span>  <span class=\"mf\">0.0567</span><span class=\"p\">],</span>\n         <span class=\"p\">[</span> <span class=\"mf\">0.0527</span><span class=\"p\">,</span> <span class=\"o\">-</span><span class=\"mf\">0.1483</span><span class=\"p\">,</span>  <span class=\"mf\">1.3609</span><span class=\"p\">,</span>  <span class=\"o\">...</span><span class=\"p\">,</span> <span class=\"o\">-</span><span class=\"mf\">0.4513</span><span class=\"p\">,</span>  <span class=\"mf\">0.1274</span><span class=\"p\">,</span>  <span class=\"mf\">0.2655</span><span class=\"p\">],</span>\n         <span class=\"p\">[</span><span class=\"o\">-</span><span class=\"mf\">0.7122</span><span class=\"p\">,</span> <span class=\"o\">-</span><span class=\"mf\">0.4815</span><span class=\"p\">,</span> <span class=\"o\">-</span><span class=\"mf\">0.1438</span><span class=\"p\">,</span>  <span class=\"o\">...</span><span class=\"p\">,</span>  <span class=\"mf\">0.5602</span><span class=\"p\">,</span> <span class=\"o\">-</span><span class=\"mf\">0.1062</span><span class=\"p\">,</span> <span class=\"o\">-</span><span class=\"mf\">0.1301</span><span class=\"p\">],</span>\n         <span class=\"p\">[</span> <span class=\"mf\">0.9955</span><span class=\"p\">,</span>  <span class=\"mf\">0.1328</span><span class=\"p\">,</span> <span class=\"o\">-</span><span class=\"mf\">0.0621</span><span class=\"p\">,</span>  <span class=\"o\">...</span><span class=\"p\">,</span>  <span class=\"mf\">0.2460</span><span class=\"p\">,</span> <span class=\"o\">-</span><span class=\"mf\">0.6502</span><span class=\"p\">,</span> <span class=\"o\">-</span><span class=\"mf\">0.3296</span><span class=\"p\">]]],</span>\n       <span class=\"n\">requires_grad</span><span class=\"o\">=</span><span class=\"kc\">True</span><span class=\"p\">)</span>\n</pre></div>\n</div>\n</section>\n<section id=\"constructing-your-own-rh-module-class\">\n<h3>Constructing your own rh.Module Class<a class=\"headerlink\" href=\"#constructing-your-own-rh-module-class\" title=\"Permalink to this heading\">\u00b6</a></h3>\n<p>You can also construct a Module from scratch by subclassing\n<code class=\"docutils literal notranslate\"><span class=\"pre\">rh.Module</span></code>.</p>\n<p>Note that the class is constructed locally prior to sending it to a\nremote cluster. If there is a computationally heavy operation such as\nloading a dataset or model that you only want to take place remotely,\nyou probably want to wrap that operation in an instance method and call\nit only after it\u2019s sent to remote compute. One such way is through lazy\ninitialization, as in the data property of the module below.</p>\n<p>When working in a notebook setting, we define the class in another file,\n<code class=\"docutils literal notranslate\"><span class=\"pre\">pid_module.py</span></code>, because module code is synced to the cluster and\nthere isn\u2019t a robust standard for extracting code from notebooks. In\nnormal Python, you can use any Module as you would a normal Python\nclass.</p>\n<div class=\"highlight-ipython3 notranslate\"><div class=\"highlight\"><pre><span></span>%%writefile pid_module.py\n\nimport os\nimport runhouse as rh\n\nclass PIDModule(rh.Module):\n    def __init__(self, a: int=0):\n        super().__init__()\n        self.a = a\n\n    @property\n    def data(self):\n        if not hasattr(self, &#39;_data&#39;):\n            self._data = load_dataset()\n        return self._data\n\n    def getpid(self):\n        return os.getpid() + self.a\n</pre></div>\n</div>\n<div class=\"code-output highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">Writing</span> <span class=\"n\">pid_module</span><span class=\"o\">.</span><span class=\"n\">py</span>\n</pre></div>\n</div>\n<p>We can directly import the Module, and call <code class=\"docutils literal notranslate\"><span class=\"pre\">.to(cluster)</span></code> on it. Then\nuse it as you would with any local Python class, except that this it is\nbeing run on the cluster.</p>\n<div class=\"highlight-ipython3 notranslate\"><div class=\"highlight\"><pre><span></span>from pid_module import PIDModule\n\nremote_module = PIDModule(a=5).to(cluster)\nremote_module.getpid()\n</pre></div>\n</div>\n<div class=\"code-output highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">INFO</span> <span class=\"o\">|</span> <span class=\"mi\">2024</span><span class=\"o\">-</span><span class=\"mi\">02</span><span class=\"o\">-</span><span class=\"mi\">27</span> <span class=\"mi\">20</span><span class=\"p\">:</span><span class=\"mi\">56</span><span class=\"p\">:</span><span class=\"mf\">19.187985</span> <span class=\"o\">|</span> <span class=\"n\">Copying</span> <span class=\"n\">package</span> <span class=\"kn\">from</span> <span class=\"nn\">file</span><span class=\"p\">:</span><span class=\"o\">///</span><span class=\"n\">Users</span><span class=\"o\">/</span><span class=\"n\">caroline</span><span class=\"o\">/</span><span class=\"n\">Documents</span><span class=\"o\">/</span><span class=\"n\">runhouse</span><span class=\"o\">/</span><span class=\"n\">notebooks</span> <span class=\"n\">to</span><span class=\"p\">:</span> <span class=\"n\">rh</span><span class=\"o\">-</span><span class=\"n\">cluster</span>\n<span class=\"n\">INFO</span> <span class=\"o\">|</span> <span class=\"mi\">2024</span><span class=\"o\">-</span><span class=\"mi\">02</span><span class=\"o\">-</span><span class=\"mi\">27</span> <span class=\"mi\">20</span><span class=\"p\">:</span><span class=\"mi\">56</span><span class=\"p\">:</span><span class=\"mf\">24.220264</span> <span class=\"o\">|</span> <span class=\"n\">Calling</span> <span class=\"n\">base_env</span><span class=\"o\">.</span><span class=\"n\">install</span>\n</pre></div>\n</div>\n<div class=\"code-output highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"p\">[</span><span class=\"mi\">36</span><span class=\"n\">mInstalling</span> <span class=\"n\">Package</span><span class=\"p\">:</span> <span class=\"n\">notebooks</span> <span class=\"k\">with</span> <span class=\"n\">method</span> <span class=\"n\">reqs</span><span class=\"o\">.</span>\n<span class=\"p\">[</span><span class=\"mi\">0</span><span class=\"n\">m</span><span class=\"p\">[</span><span class=\"mi\">36</span><span class=\"n\">mreqs</span> <span class=\"n\">path</span><span class=\"p\">:</span> <span class=\"n\">notebooks</span><span class=\"o\">/</span><span class=\"n\">requirements</span><span class=\"o\">.</span><span class=\"n\">txt</span>\n<span class=\"p\">[</span><span class=\"mi\">0</span><span class=\"n\">m</span><span class=\"p\">[</span><span class=\"mi\">36</span><span class=\"n\">mnotebooks</span><span class=\"o\">/</span><span class=\"n\">requirements</span><span class=\"o\">.</span><span class=\"n\">txt</span> <span class=\"ow\">not</span> <span class=\"n\">found</span><span class=\"p\">,</span> <span class=\"n\">skipping</span>\n</pre></div>\n</div>\n<div class=\"code-output highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">INFO</span> <span class=\"o\">|</span> <span class=\"mi\">2024</span><span class=\"o\">-</span><span class=\"mi\">02</span><span class=\"o\">-</span><span class=\"mi\">27</span> <span class=\"mi\">20</span><span class=\"p\">:</span><span class=\"mi\">56</span><span class=\"p\">:</span><span class=\"mf\">25.343078</span> <span class=\"o\">|</span> <span class=\"n\">Time</span> <span class=\"n\">to</span> <span class=\"n\">call</span> <span class=\"n\">base_env</span><span class=\"o\">.</span><span class=\"n\">install</span><span class=\"p\">:</span> <span class=\"mf\">1.12</span> <span class=\"n\">seconds</span>\n<span class=\"n\">INFO</span> <span class=\"o\">|</span> <span class=\"mi\">2024</span><span class=\"o\">-</span><span class=\"mi\">02</span><span class=\"o\">-</span><span class=\"mi\">27</span> <span class=\"mi\">20</span><span class=\"p\">:</span><span class=\"mi\">56</span><span class=\"p\">:</span><span class=\"mf\">35.126382</span> <span class=\"o\">|</span> <span class=\"n\">Sending</span> <span class=\"n\">module</span> <span class=\"n\">PIDModule</span> <span class=\"n\">to</span> <span class=\"n\">rh</span><span class=\"o\">-</span><span class=\"n\">cluster</span>\n<span class=\"n\">INFO</span> <span class=\"o\">|</span> <span class=\"mi\">2024</span><span class=\"o\">-</span><span class=\"mi\">02</span><span class=\"o\">-</span><span class=\"mi\">27</span> <span class=\"mi\">20</span><span class=\"p\">:</span><span class=\"mi\">56</span><span class=\"p\">:</span><span class=\"mf\">44.887485</span> <span class=\"o\">|</span> <span class=\"n\">Calling</span> <span class=\"n\">PIDModule</span><span class=\"o\">.</span><span class=\"n\">getpid</span>\n<span class=\"n\">INFO</span> <span class=\"o\">|</span> <span class=\"mi\">2024</span><span class=\"o\">-</span><span class=\"mi\">02</span><span class=\"o\">-</span><span class=\"mi\">27</span> <span class=\"mi\">20</span><span class=\"p\">:</span><span class=\"mi\">56</span><span class=\"p\">:</span><span class=\"mf\">45.938380</span> <span class=\"o\">|</span> <span class=\"n\">Time</span> <span class=\"n\">to</span> <span class=\"n\">call</span> <span class=\"n\">PIDModule</span><span class=\"o\">.</span><span class=\"n\">getpid</span><span class=\"p\">:</span> <span class=\"mf\">1.05</span> <span class=\"n\">seconds</span>\n</pre></div>\n</div>\n<div class=\"code-output highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"mi\">31607</span>\n</pre></div>\n</div>\n</section>\n</section>\n</section>\n\n    <script type=\"text/x-thebe-config\">\n    {\n        requestKernel: true,\n        binderOptions: {\n            repo: \"binder-examples/jupyter-stacks-datascience\",\n            ref: \"master\",\n        },\n        codeMirrorConfig: {\n            theme: \"abcdef\",\n            mode: \"python\"\n        },\n        kernelOptions: {\n            name: \"python3\",\n            path: \"./tutorials\"\n        },\n        predefinedOutput: true\n    }\n    </script>\n    <script>kernelName = 'python3'</script>", "metatags": "<meta name=\"generator\" content=\"Docutils 0.19: https://docutils.sourceforge.io/\" />\n", "rellinks": [["genindex", "General Index", "I", "index"], ["py-modindex", "Python Module Index", "", "modules"], ["tutorials/api-folders", "Folders", "N", "next"], ["tutorials/api-clusters", "Clusters", "P", "previous"]], "sourcename": "tutorials/api-modules.rst.txt", "toc": "<ul>\n<li><a class=\"reference internal\" href=\"#\">Functions and Modules</a><ul>\n<li><a class=\"reference internal\" href=\"#setup\">Setup</a></li>\n<li><a class=\"reference internal\" href=\"#runhouse-functions\">Runhouse Functions</a></li>\n<li><a class=\"reference internal\" href=\"#runhouse-modules\">Runhouse Modules</a><ul>\n<li><a class=\"reference internal\" href=\"#converting-existing-class-to-runhouse-module\">Converting Existing Class to Runhouse Module</a></li>\n<li><a class=\"reference internal\" href=\"#constructing-your-own-rh-module-class\">Constructing your own rh.Module Class</a></li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n", "display_toc": true, "page_source_suffix": ".rst", "globaltoc": "<p class=\"caption\" role=\"heading\"><span class=\"caption-text\">Getting Started</span></p>\n<ul>\n<li class=\"toctree-l1\"><a class=\"reference internal\" href=\"tutorials/quick-start-cloud/\">Quick Start</a></li>\n<li class=\"toctree-l1\"><a class=\"reference internal\" href=\"tutorials/quick-start-den/\">Den Quick Start</a></li>\n<li class=\"toctree-l1\"><a class=\"reference internal\" href=\"how-to-use-runhouse/\">How to Use Runhouse</a></li>\n<li class=\"toctree-l1\"><a class=\"reference internal\" href=\"runhouse-in-your-stack/\">Working with Common Libraries and Tools</a></li>\n</ul>\n<p class=\"caption\" role=\"heading\"><span class=\"caption-text\">API Basics</span></p>\n<ul>\n<li class=\"toctree-l1\"><a class=\"reference internal\" href=\"tutorials/api-clusters/\">Clusters</a></li>\n<li class=\"toctree-l1\"><a class=\"reference internal\" href=\"tutorials/api-modules/\">Functions and Modules</a></li>\n<li class=\"toctree-l1\"><a class=\"reference internal\" href=\"tutorials/api-folders/\">Folders</a></li>\n<li class=\"toctree-l1\"><a class=\"reference internal\" href=\"tutorials/api-secrets/\">Secrets</a></li>\n<li class=\"toctree-l1\"><a class=\"reference internal\" href=\"tutorials/api-resources/\">Resource Management</a></li>\n</ul>\n<p class=\"caption\" role=\"heading\"><span class=\"caption-text\">API Reference</span></p>\n<ul>\n<li class=\"toctree-l1\"><a class=\"reference internal\" href=\"api/python/\">Python API</a><ul>\n<li class=\"toctree-l2\"><a class=\"reference internal\" href=\"api/python/resource/\">Resource</a></li>\n<li class=\"toctree-l2\"><a class=\"reference internal\" href=\"api/python/function/\">Function</a></li>\n<li class=\"toctree-l2\"><a class=\"reference internal\" href=\"api/python/cluster/\">Cluster</a></li>\n<li class=\"toctree-l2\"><a class=\"reference internal\" href=\"api/python/image/\">Image</a></li>\n<li class=\"toctree-l2\"><a class=\"reference internal\" href=\"api/python/package/\">Package</a></li>\n<li class=\"toctree-l2\"><a class=\"reference internal\" href=\"api/python/module/\">Module</a></li>\n<li class=\"toctree-l2\"><a class=\"reference internal\" href=\"api/python/folder/\">Folder</a></li>\n<li class=\"toctree-l2\"><a class=\"reference internal\" href=\"api/python/secrets/\">Secrets</a></li>\n<li class=\"toctree-l2\"><a class=\"reference internal\" href=\"api/python/login/\">Login/Logout</a></li>\n</ul>\n</li>\n<li class=\"toctree-l1\"><a class=\"reference internal\" href=\"api/cli/\">Command Line Interface</a></li>\n</ul>\n<p class=\"caption\" role=\"heading\"><span class=\"caption-text\">Other Topics</span></p>\n<ul>\n<li class=\"toctree-l1\"><a class=\"reference internal\" href=\"tutorials/async/\">Asynchronous Programming</a></li>\n<li class=\"toctree-l1\"><a class=\"reference internal\" href=\"installation/\">Installation and Setup</a></li>\n<li class=\"toctree-l1\"><a class=\"reference internal\" href=\"debugging-logging/\">Debugging and Logging</a></li>\n<li class=\"toctree-l1\"><a class=\"reference internal\" href=\"docker-setup/\">Docker: Cluster Setup</a></li>\n<li class=\"toctree-l1\"><a class=\"reference internal\" href=\"docker-workflows/\">Docker: Dev and Prod Workflows</a></li>\n<li class=\"toctree-l1\"><a class=\"reference internal\" href=\"troubleshooting/\">Manual Setup and Troubleshooting</a></li>\n<li class=\"toctree-l1\"><a class=\"reference internal\" href=\"security-and-authentication/\">Security and Authentication</a></li>\n</ul>\n", "current_page_name": "tutorials/api-modules", "sidebars": ["about.html", "navigation.html", "relations.html", "searchbox.html", "donate.html"], "customsidebar": null, "alabaster_version": "0.7.16", "alabaster_version_info": [0, 7, 16]}