{"parents": [], "prev": {"link": "../api-folders/", "title": "Folders"}, "next": {"link": "../api-resources/", "title": "Resource Management"}, "title": "Secrets", "meta": {}, "body": "<section id=\"secrets\">\n<h1>Secrets<a class=\"headerlink\" href=\"#secrets\" title=\"Permalink to this heading\">\u00b6</a></h1>\n<p><a href=\"https://colab.research.google.com/github/run-house/notebooks/blob/stable/docs/api-secrets.ipynb\">\n<img height=\"20px\" width=\"117px\" src=\"https://colab.research.google.com/assets/colab-badge.svg\" alt=\"Open In Colab\"/></a></p><p>Secrets are a Runhouse resource that provides a simple interface for\nhandling your secrets, such as provider credentials and API keys, across\nenvironments. With Runhouse APIs, easily</p>\n<ul class=\"simple\">\n<li><p>construct a secret object, based on local variables, files, or\nenvironment variables</p></li>\n<li><p>save new secrets and reload existing ones</p></li>\n<li><p>set secrets across clusters, environments, and functions</p></li>\n</ul>\n<p>For a more detailed API documentation, you can refer to our <a class=\"reference external\" href=\"https://www.run.house/docs/api/python/secrets\">Runhouse\ndocs</a>.</p>\n<section id=\"constructing-secrets\">\n<h2>Constructing Secrets<a class=\"headerlink\" href=\"#constructing-secrets\" title=\"Permalink to this heading\">\u00b6</a></h2>\n<p>Secrets are constructed using the <code class=\"docutils literal notranslate\"><span class=\"pre\">rh.secret</span></code> or\n<code class=\"docutils literal notranslate\"><span class=\"pre\">rh.provider_secret</span></code> factory functions.</p>\n<div class=\"highlight-ipython3 notranslate\"><div class=\"highlight\"><pre><span></span>import runhouse as rh\n</pre></div>\n</div>\n<section id=\"base-secret\">\n<h3>Base Secret<a class=\"headerlink\" href=\"#base-secret\" title=\"Permalink to this heading\">\u00b6</a></h3>\n<p>Base secrets are constructed with <code class=\"docutils literal notranslate\"><span class=\"pre\">rh.secret</span></code>, and consist of a values\ndictionary mapping secret keys to values.</p>\n<div class=\"highlight-ipython3 notranslate\"><div class=\"highlight\"><pre><span></span>my_secret = rh.secret(name=&quot;my_secret&quot;, values={&quot;key&quot;: &quot;secret_val&quot;})\nmy_secret.save()\ndel my_secret\n</pre></div>\n</div>\n<div class=\"code-output highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">INFO</span> <span class=\"o\">|</span> <span class=\"mi\">2023</span><span class=\"o\">-</span><span class=\"mi\">12</span><span class=\"o\">-</span><span class=\"mi\">20</span> <span class=\"mi\">05</span><span class=\"p\">:</span><span class=\"mi\">59</span><span class=\"p\">:</span><span class=\"mf\">57.445868</span> <span class=\"o\">|</span> <span class=\"n\">Saving</span> <span class=\"n\">config</span> <span class=\"k\">for</span> <span class=\"o\">~/</span><span class=\"n\">my_secret</span> <span class=\"n\">to</span><span class=\"p\">:</span> <span class=\"o\">/</span><span class=\"n\">Users</span><span class=\"o\">/</span><span class=\"n\">caroline</span><span class=\"o\">/.</span><span class=\"n\">rh</span><span class=\"o\">/</span><span class=\"n\">secrets</span><span class=\"o\">/</span><span class=\"n\">my_secret</span><span class=\"o\">.</span><span class=\"n\">json</span>\n</pre></div>\n</div>\n<div class=\"highlight-ipython3 notranslate\"><div class=\"highlight\"><pre><span></span>my_secret = rh.secret(&quot;my_secret&quot;)\nmy_secret.values\n</pre></div>\n</div>\n<div class=\"code-output highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">INFO</span> <span class=\"o\">|</span> <span class=\"mi\">2023</span><span class=\"o\">-</span><span class=\"mi\">12</span><span class=\"o\">-</span><span class=\"mi\">20</span> <span class=\"mi\">05</span><span class=\"p\">:</span><span class=\"mi\">59</span><span class=\"p\">:</span><span class=\"mf\">57.772553</span> <span class=\"o\">|</span> <span class=\"n\">Loading</span> <span class=\"n\">config</span> <span class=\"kn\">from</span><span class=\"w\"> </span><span class=\"nn\">local</span> <span class=\"n\">file</span> <span class=\"o\">/</span><span class=\"n\">Users</span><span class=\"o\">/</span><span class=\"n\">caroline</span><span class=\"o\">/.</span><span class=\"n\">rh</span><span class=\"o\">/</span><span class=\"n\">secrets</span><span class=\"o\">/</span><span class=\"n\">my_secret</span><span class=\"o\">.</span><span class=\"n\">json</span>\n</pre></div>\n</div>\n<div class=\"code-output highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"p\">{</span><span class=\"s1\">&#39;key&#39;</span><span class=\"p\">:</span> <span class=\"s1\">&#39;secret_val&#39;</span><span class=\"p\">}</span>\n</pre></div>\n</div>\n</section>\n<section id=\"provider-secret\">\n<h3>Provider Secret<a class=\"headerlink\" href=\"#provider-secret\" title=\"Permalink to this heading\">\u00b6</a></h3>\n<p>Provider secrets are constructed with <code class=\"docutils literal notranslate\"><span class=\"pre\">rh.provider_secret</span></code> and are\nassociated with a provider type. These can be constructed by passing in\na <code class=\"docutils literal notranslate\"><span class=\"pre\">values</span></code> key-pair mapping, or by providing the local file, or local\nenvironment variables associated with the keys, and as a result, have\nadditional functionality such as being able to write to a file or\nenvironment variables. There are various supported builtin provider\ntypes, such as cluster providers (aws, azure, \u2026), api key based\nproviders (openai, anthropic, \u2026), and ssh keys. These secret classes\nhave default locations (file path or environment variables) that\nRunhouse will use to extract the secret values from out-of-the-box, if\nthe <code class=\"docutils literal notranslate\"><span class=\"pre\">values</span></code> are not explicitly provided.</p>\n<div class=\"highlight-ipython3 notranslate\"><div class=\"highlight\"><pre><span></span>rh.Secret.builtin_providers(as_str=True)\n</pre></div>\n</div>\n<div class=\"code-output highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"p\">[</span><span class=\"s1\">&#39;aws&#39;</span><span class=\"p\">,</span>\n <span class=\"s1\">&#39;azure&#39;</span><span class=\"p\">,</span>\n <span class=\"s1\">&#39;gcp&#39;</span><span class=\"p\">,</span>\n <span class=\"s1\">&#39;github&#39;</span><span class=\"p\">,</span>\n <span class=\"s1\">&#39;huggingface&#39;</span><span class=\"p\">,</span>\n <span class=\"s1\">&#39;lambda&#39;</span><span class=\"p\">,</span>\n <span class=\"s1\">&#39;ssh&#39;</span><span class=\"p\">,</span>\n <span class=\"s1\">&#39;sky&#39;</span><span class=\"p\">,</span>\n <span class=\"s1\">&#39;anthropic&#39;</span><span class=\"p\">,</span>\n <span class=\"s1\">&#39;cohere&#39;</span><span class=\"p\">,</span>\n <span class=\"s1\">&#39;langchain&#39;</span><span class=\"p\">,</span>\n <span class=\"s1\">&#39;openai&#39;</span><span class=\"p\">,</span>\n <span class=\"s1\">&#39;pinecone&#39;</span><span class=\"p\">,</span>\n <span class=\"s1\">&#39;wandb&#39;</span><span class=\"p\">]</span>\n</pre></div>\n</div>\n<section id=\"compute-providers\">\n<h4>Compute Providers<a class=\"headerlink\" href=\"#compute-providers\" title=\"Permalink to this heading\">\u00b6</a></h4>\n<p>Here, we construct a default AWS provider secret. We locally have dummy\nvariables stored in the default path ~/.aws/credentials, and we see that\nthis is automatically set.</p>\n<div class=\"highlight-ipython3 notranslate\"><div class=\"highlight\"><pre><span></span>!cat ~/.aws/credentials\n</pre></div>\n</div>\n<div class=\"code-output highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"p\">[</span><span class=\"n\">default</span><span class=\"p\">]</span>\n<span class=\"n\">aws_access_key_id</span> <span class=\"o\">=</span> <span class=\"n\">ABCD_KEY</span>\n<span class=\"n\">aws_secret_access_key</span> <span class=\"o\">=</span> <span class=\"mi\">1234</span><span class=\"n\">_KEY</span>\n</pre></div>\n</div>\n<div class=\"highlight-ipython3 notranslate\"><div class=\"highlight\"><pre><span></span># default provider secret for AWS. Will pull in values from expected default configuration when used.\naws_secret = rh.provider_secret(&quot;aws&quot;)\n\nprint(f&quot;extracted path: {aws_secret.path}&quot;)\nprint(f&quot;extracted values: {aws_secret.values}&quot;)\n</pre></div>\n</div>\n<div class=\"code-output highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">extracted</span> <span class=\"n\">path</span><span class=\"p\">:</span> <span class=\"o\">~/.</span><span class=\"n\">aws</span><span class=\"o\">/</span><span class=\"n\">credentials</span>\n<span class=\"n\">extracted</span> <span class=\"n\">values</span><span class=\"p\">:</span> <span class=\"p\">{</span><span class=\"s1\">&#39;access_key&#39;</span><span class=\"p\">:</span> <span class=\"s1\">&#39;ABCD_KEY&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;secret_key&#39;</span><span class=\"p\">:</span> <span class=\"s1\">&#39;1234_KEY&#39;</span><span class=\"p\">}</span>\n</pre></div>\n</div>\n<p>You can also instantiate secrets by directly passing in their secret\nvalues (if it isn\u2019t locally set up yet), and optionally save it down\nlocally.</p>\n<div class=\"highlight-ipython3 notranslate\"><div class=\"highlight\"><pre><span></span># provider secret constructed from values dictionary, for LambdaLabs.\nlambda_secret = rh.provider_secret(&quot;lambda&quot;, values={&quot;api_key&quot;: &quot;lambda_key&quot;})\n\nprint(f&quot;values: {lambda_secret.values}&quot;)\n\nlambda_secret = lambda_secret.write()\nprint(f&quot;path: {lambda_secret.path}&quot;)\n</pre></div>\n</div>\n<div class=\"code-output highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">INFO</span> <span class=\"o\">|</span> <span class=\"mi\">2023</span><span class=\"o\">-</span><span class=\"mi\">12</span><span class=\"o\">-</span><span class=\"mi\">20</span> <span class=\"mi\">17</span><span class=\"p\">:</span><span class=\"mi\">37</span><span class=\"p\">:</span><span class=\"mf\">57.775584</span> <span class=\"o\">|</span> <span class=\"n\">Secrets</span> <span class=\"n\">already</span> <span class=\"n\">exist</span> <span class=\"ow\">in</span> <span class=\"o\">~/.</span><span class=\"n\">lambda_cloud</span><span class=\"o\">/</span><span class=\"n\">lambda_keys</span><span class=\"o\">.</span>\n</pre></div>\n</div>\n<div class=\"code-output highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">values</span><span class=\"p\">:</span> <span class=\"p\">{</span><span class=\"s1\">&#39;api_key&#39;</span><span class=\"p\">:</span> <span class=\"s1\">&#39;lambda_key&#39;</span><span class=\"p\">}</span>\n<span class=\"n\">path</span><span class=\"p\">:</span> <span class=\"o\">~/.</span><span class=\"n\">lambda_cloud</span><span class=\"o\">/</span><span class=\"n\">lambda_keys</span>\n</pre></div>\n</div>\n<p>Or, you can construct a secret with a non-default path, and Runhouse\nwill extract out the values.</p>\n<div class=\"highlight-ipython3 notranslate\"><div class=\"highlight\"><pre><span></span>!cat ~/.aws/credentials_custom\n</pre></div>\n</div>\n<div class=\"code-output highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"p\">[</span><span class=\"n\">default</span><span class=\"p\">]</span>\n<span class=\"n\">aws_access_key_id</span> <span class=\"o\">=</span> <span class=\"n\">ABCD_KEY_CUSTOM</span>\n<span class=\"n\">aws_secret_access_key</span> <span class=\"o\">=</span> <span class=\"mi\">1234</span><span class=\"n\">_KEY_CUSTOM</span>\n</pre></div>\n</div>\n<div class=\"highlight-ipython3 notranslate\"><div class=\"highlight\"><pre><span></span>aws_secret_custom = rh.provider_secret(&quot;aws&quot;, path=&quot;~/.aws/credentials_custom&quot;)\n\nprint(f&quot;path: {aws_secret_custom.path}&quot;)\nprint(f&quot;values: {aws_secret_custom.values}&quot;)\n</pre></div>\n</div>\n<div class=\"code-output highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">path</span><span class=\"p\">:</span> <span class=\"o\">~/.</span><span class=\"n\">aws</span><span class=\"o\">/</span><span class=\"n\">credentials_custom</span>\n<span class=\"n\">values</span><span class=\"p\">:</span> <span class=\"p\">{</span><span class=\"s1\">&#39;access_key&#39;</span><span class=\"p\">:</span> <span class=\"s1\">&#39;ABCD_KEY_CUSTOM&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;secret_key&#39;</span><span class=\"p\">:</span> <span class=\"s1\">&#39;1234_KEY_CUSTOM&#39;</span><span class=\"p\">}</span>\n</pre></div>\n</div>\n</section>\n<section id=\"api-keys\">\n<h4>API Keys<a class=\"headerlink\" href=\"#api-keys\" title=\"Permalink to this heading\">\u00b6</a></h4>\n<p>These provider secrets consist of a single API key, associated with a\ndefault environment variable key, often <code class=\"docutils literal notranslate\"><span class=\"pre\">PROVIDER_API_KEY</span></code>. They can\nbe constructed by passing in a values dict mapping <code class=\"docutils literal notranslate\"><span class=\"pre\">api_key</span></code> to the\nvalue, or the value will be inferred from the environment variables.\nCalling <code class=\"docutils literal notranslate\"><span class=\"pre\">.write()</span></code> will set the environment variable in the current\nprocess.</p>\n<p>Secrets from inferred env value:</p>\n<div class=\"highlight-ipython3 notranslate\"><div class=\"highlight\"><pre><span></span>import os\nos.environ[&quot;OPENAI_API_KEY&quot;] = &quot;openai_key&quot;\n</pre></div>\n</div>\n<div class=\"highlight-ipython3 notranslate\"><div class=\"highlight\"><pre><span></span>openai_secret = rh.provider_secret(&quot;openai&quot;)\nopenai_secret.values\n</pre></div>\n</div>\n<div class=\"code-output highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"p\">{</span><span class=\"s1\">&#39;api_key&#39;</span><span class=\"p\">:</span> <span class=\"s1\">&#39;openai_key&#39;</span><span class=\"p\">}</span>\n</pre></div>\n</div>\n<p>Passing in value to the constructor:</p>\n<div class=\"highlight-ipython3 notranslate\"><div class=\"highlight\"><pre><span></span>anthropic_secret = rh.provider_secret(&quot;anthropic&quot;, values={&quot;api_key&quot;: &quot;ahthropic_key&quot;})\nanthropic_secret.write()\n\nos.environ[&quot;ANTHROPIC_API_KEY&quot;]\n</pre></div>\n</div>\n<div class=\"code-output highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"s1\">&#39;ahthropic_key&#39;</span>\n</pre></div>\n</div>\n</section>\n<section id=\"ssh-keys\">\n<h4>SSH Keys<a class=\"headerlink\" href=\"#ssh-keys\" title=\"Permalink to this heading\">\u00b6</a></h4>\n<p>SSH public and private key pairs are another type of supported builtin\nprovider type. Simply pass in <code class=\"docutils literal notranslate\"><span class=\"pre\">provider=&quot;ssh&quot;</span></code> and <code class=\"docutils literal notranslate\"><span class=\"pre\">name=&lt;key&gt;</span></code>.</p>\n<div class=\"highlight-ipython3 notranslate\"><div class=\"highlight\"><pre><span></span>!cat ~/.ssh/example\n</pre></div>\n</div>\n<pre class=\"code-output literal-block\"><strong>private key values</strong></pre>\n<div class=\"highlight-ipython3 notranslate\"><div class=\"highlight\"><pre><span></span>!cat ~/.ssh/example.pub\n</pre></div>\n</div>\n<pre class=\"code-output literal-block\"><strong>public key values</strong></pre>\n<div class=\"highlight-ipython3 notranslate\"><div class=\"highlight\"><pre><span></span>ssh_secret = rh.provider_secret(provider=&quot;ssh&quot;, name=&quot;example&quot;)\nssh_secret.values\n</pre></div>\n</div>\n<pre class=\"code-output literal-block\">{'public_key': '<strong>public key values</strong>n',\n 'private_key': '<strong>private key values</strong>n'}</pre>\n</section>\n</section>\n</section>\n<section id=\"sending-secrets\">\n<h2>Sending Secrets<a class=\"headerlink\" href=\"#sending-secrets\" title=\"Permalink to this heading\">\u00b6</a></h2>\n<p>You can directly send secrets to a cluster using the <code class=\"docutils literal notranslate\"><span class=\"pre\">secret.to()</span></code>\nAPI, bulk sync secrets using <code class=\"docutils literal notranslate\"><span class=\"pre\">cluster.sync_secrets()</span></code>, or by including\nthem as part of a <code class=\"docutils literal notranslate\"><span class=\"pre\">rh.env()</span></code>.</p>\n<div class=\"highlight-ipython3 notranslate\"><div class=\"highlight\"><pre><span></span>cluster = rh.ondemand_cluster(&quot;example-cluster&quot;)\n</pre></div>\n</div>\n<section id=\"secret-to-system-env\">\n<h3><code class=\"docutils literal notranslate\"><span class=\"pre\">secret.to(system,</span> <span class=\"pre\">env)</span></code><a class=\"headerlink\" href=\"#secret-to-system-env\" title=\"Permalink to this heading\">\u00b6</a></h3>\n<div class=\"highlight-ipython3 notranslate\"><div class=\"highlight\"><pre><span></span>lambda_secret.path\n</pre></div>\n</div>\n<div class=\"code-output highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"s1\">&#39;~/.lambda_cloud/lambda_keys&#39;</span>\n</pre></div>\n</div>\n<div class=\"highlight-ipython3 notranslate\"><div class=\"highlight\"><pre><span></span># path secret\nlambda_secret.to(cluster)\nrh.file(path=lambda_secret.path, system=cluster).fetch(mode=&quot;r&quot;, deserialize=False)\n</pre></div>\n</div>\n<div class=\"code-output highlight-default notranslate\"><div class=\"highlight\"><pre><span></span>INFO | 2023-12-20 17:43:02.929930 | Connected (version 2.0, client OpenSSH_8.2p1)\nINFO | 2023-12-20 17:43:03.168593 | Authentication (publickey) successful!\nINFO | 2023-12-20 17:43:03.171218 | Connecting to server via SSH, port forwarding via port 32300.\nINFO | 2023-12-20 17:43:03.172050 | Checking server example-cluster\nINFO | 2023-12-20 17:43:03.677092 | Server example-cluster is up.\nINFO | 2023-12-20 17:43:03.820783 | Calling lambda._write_to_file\n</pre></div>\n</div>\n<div class=\"code-output highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">base</span> <span class=\"n\">servlet</span><span class=\"p\">:</span> <span class=\"n\">Calling</span> <span class=\"n\">method</span> <span class=\"n\">_write_to_file</span> <span class=\"n\">on</span> <span class=\"n\">module</span> <span class=\"k\">lambda</span>\n</pre></div>\n</div>\n<div class=\"code-output highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">INFO</span> <span class=\"o\">|</span> <span class=\"mi\">2023</span><span class=\"o\">-</span><span class=\"mi\">12</span><span class=\"o\">-</span><span class=\"mi\">20</span> <span class=\"mi\">17</span><span class=\"p\">:</span><span class=\"mi\">43</span><span class=\"p\">:</span><span class=\"mf\">04.110755</span> <span class=\"o\">|</span> <span class=\"n\">Time</span> <span class=\"n\">to</span> <span class=\"n\">call</span> <span class=\"k\">lambda</span><span class=\"o\">.</span><span class=\"n\">_write_to_file</span><span class=\"p\">:</span> <span class=\"mf\">0.29</span> <span class=\"n\">seconds</span>\n<span class=\"n\">INFO</span> <span class=\"o\">|</span> <span class=\"mi\">2023</span><span class=\"o\">-</span><span class=\"mi\">12</span><span class=\"o\">-</span><span class=\"mi\">20</span> <span class=\"mi\">17</span><span class=\"p\">:</span><span class=\"mi\">43</span><span class=\"p\">:</span><span class=\"mf\">04.523570</span> <span class=\"o\">|</span> <span class=\"n\">Getting</span> <span class=\"n\">file_20231220_124304</span>\n<span class=\"n\">INFO</span> <span class=\"o\">|</span> <span class=\"mi\">2023</span><span class=\"o\">-</span><span class=\"mi\">12</span><span class=\"o\">-</span><span class=\"mi\">20</span> <span class=\"mi\">17</span><span class=\"p\">:</span><span class=\"mi\">43</span><span class=\"p\">:</span><span class=\"mf\">04.633602</span> <span class=\"o\">|</span> <span class=\"n\">Time</span> <span class=\"n\">to</span> <span class=\"n\">get</span> <span class=\"n\">file_20231220_124304</span><span class=\"p\">:</span> <span class=\"mf\">0.11</span> <span class=\"n\">seconds</span>\n</pre></div>\n</div>\n<pre class=\"code-output literal-block\">'api_key = lambda_keyn'</pre>\n<div class=\"highlight-ipython3 notranslate\"><div class=\"highlight\"><pre><span></span>env = rh.env()\nopenai_secret.to(cluster, env=env)\n</pre></div>\n</div>\n<div class=\"code-output highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">INFO</span> <span class=\"o\">|</span> <span class=\"mi\">2023</span><span class=\"o\">-</span><span class=\"mi\">12</span><span class=\"o\">-</span><span class=\"mi\">20</span> <span class=\"mi\">17</span><span class=\"p\">:</span><span class=\"mi\">43</span><span class=\"p\">:</span><span class=\"mf\">11.602308</span> <span class=\"o\">|</span> <span class=\"n\">Getting</span> <span class=\"n\">base_env</span>\n<span class=\"n\">INFO</span> <span class=\"o\">|</span> <span class=\"mi\">2023</span><span class=\"o\">-</span><span class=\"mi\">12</span><span class=\"o\">-</span><span class=\"mi\">20</span> <span class=\"mi\">17</span><span class=\"p\">:</span><span class=\"mi\">43</span><span class=\"p\">:</span><span class=\"mf\">13.070980</span> <span class=\"o\">|</span> <span class=\"n\">Calling</span> <span class=\"n\">base_env</span><span class=\"o\">.</span><span class=\"n\">_set_env_vars</span>\n</pre></div>\n</div>\n<div class=\"code-output highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">base_env</span> <span class=\"n\">servlet</span><span class=\"p\">:</span> <span class=\"n\">Calling</span> <span class=\"n\">method</span> <span class=\"n\">_set_env_vars</span> <span class=\"n\">on</span> <span class=\"n\">module</span> <span class=\"n\">base_env</span>\n</pre></div>\n</div>\n<div class=\"code-output highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">INFO</span> <span class=\"o\">|</span> <span class=\"mi\">2023</span><span class=\"o\">-</span><span class=\"mi\">12</span><span class=\"o\">-</span><span class=\"mi\">20</span> <span class=\"mi\">17</span><span class=\"p\">:</span><span class=\"mi\">43</span><span class=\"p\">:</span><span class=\"mf\">13.432078</span> <span class=\"o\">|</span> <span class=\"n\">Time</span> <span class=\"n\">to</span> <span class=\"n\">call</span> <span class=\"n\">base_env</span><span class=\"o\">.</span><span class=\"n\">_set_env_vars</span><span class=\"p\">:</span> <span class=\"mf\">0.36</span> <span class=\"n\">seconds</span>\n</pre></div>\n</div>\n<div class=\"code-output highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"o\">&lt;</span><span class=\"n\">runhouse</span><span class=\"o\">.</span><span class=\"n\">resources</span><span class=\"o\">.</span><span class=\"n\">secrets</span><span class=\"o\">.</span><span class=\"n\">provider_secrets</span><span class=\"o\">.</span><span class=\"n\">openai_secret</span><span class=\"o\">.</span><span class=\"n\">OpenAISecret</span> <span class=\"n\">at</span> <span class=\"mh\">0x17fe7f1f0</span><span class=\"o\">&gt;</span>\n</pre></div>\n</div>\n<div class=\"highlight-ipython3 notranslate\"><div class=\"highlight\"><pre><span></span>def _get_env_var(var):\n    import os\n    return os.environ[var]\n\nget_env_var = rh.function(_get_env_var, system=cluster, env=env)\nget_env_var(&quot;OPENAI_API_KEY&quot;)\n</pre></div>\n</div>\n<div class=\"code-output highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">INFO</span> <span class=\"o\">|</span> <span class=\"mi\">2023</span><span class=\"o\">-</span><span class=\"mi\">12</span><span class=\"o\">-</span><span class=\"mi\">20</span> <span class=\"mi\">17</span><span class=\"p\">:</span><span class=\"mi\">43</span><span class=\"p\">:</span><span class=\"mf\">16.529605</span> <span class=\"o\">|</span> <span class=\"n\">Because</span> <span class=\"n\">this</span> <span class=\"n\">function</span> <span class=\"ow\">is</span> <span class=\"n\">defined</span> <span class=\"ow\">in</span> <span class=\"n\">a</span> <span class=\"n\">notebook</span><span class=\"p\">,</span> <span class=\"n\">writing</span> <span class=\"n\">it</span> <span class=\"n\">out</span> <span class=\"n\">to</span> <span class=\"n\">a</span> <span class=\"n\">file</span> <span class=\"n\">to</span> <span class=\"n\">make</span> <span class=\"n\">it</span> <span class=\"n\">importable</span><span class=\"o\">.</span> <span class=\"n\">Please</span> <span class=\"n\">make</span> <span class=\"n\">sure</span> <span class=\"n\">the</span> <span class=\"n\">function</span> <span class=\"n\">does</span> <span class=\"ow\">not</span> <span class=\"n\">rely</span> <span class=\"n\">on</span> <span class=\"nb\">any</span> <span class=\"n\">local</span> <span class=\"n\">variables</span><span class=\"p\">,</span> <span class=\"n\">including</span> <span class=\"n\">imports</span> <span class=\"p\">(</span><span class=\"n\">which</span> <span class=\"n\">should</span> <span class=\"n\">be</span> <span class=\"n\">moved</span> <span class=\"n\">inside</span> <span class=\"n\">the</span> <span class=\"n\">function</span> <span class=\"n\">body</span><span class=\"p\">)</span><span class=\"o\">.</span> <span class=\"n\">Functions</span> <span class=\"n\">defined</span> <span class=\"ow\">in</span> <span class=\"n\">Python</span> <span class=\"n\">files</span> <span class=\"n\">can</span> <span class=\"n\">be</span> <span class=\"n\">used</span> <span class=\"n\">normally</span><span class=\"o\">.</span>\n<span class=\"n\">INFO</span> <span class=\"o\">|</span> <span class=\"mi\">2023</span><span class=\"o\">-</span><span class=\"mi\">12</span><span class=\"o\">-</span><span class=\"mi\">20</span> <span class=\"mi\">17</span><span class=\"p\">:</span><span class=\"mi\">43</span><span class=\"p\">:</span><span class=\"mf\">16.540215</span> <span class=\"o\">|</span> <span class=\"n\">Setting</span> <span class=\"n\">up</span> <span class=\"n\">Function</span> <span class=\"n\">on</span> <span class=\"n\">cluster</span><span class=\"o\">.</span>\n<span class=\"n\">INFO</span> <span class=\"o\">|</span> <span class=\"mi\">2023</span><span class=\"o\">-</span><span class=\"mi\">12</span><span class=\"o\">-</span><span class=\"mi\">20</span> <span class=\"mi\">17</span><span class=\"p\">:</span><span class=\"mi\">43</span><span class=\"p\">:</span><span class=\"mf\">16.543037</span> <span class=\"o\">|</span> <span class=\"n\">Copying</span> <span class=\"n\">package</span> <span class=\"kn\">from</span><span class=\"w\"> </span><span class=\"nn\">file</span><span class=\"p\">:</span><span class=\"o\">///</span><span class=\"n\">Users</span><span class=\"o\">/</span><span class=\"n\">caroline</span><span class=\"o\">/</span><span class=\"n\">Documents</span><span class=\"o\">/</span><span class=\"n\">runhouse</span><span class=\"o\">/</span><span class=\"n\">runhouse</span> <span class=\"n\">to</span><span class=\"p\">:</span> <span class=\"n\">example</span><span class=\"o\">-</span><span class=\"n\">cluster</span>\n<span class=\"n\">INFO</span> <span class=\"o\">|</span> <span class=\"mi\">2023</span><span class=\"o\">-</span><span class=\"mi\">12</span><span class=\"o\">-</span><span class=\"mi\">20</span> <span class=\"mi\">17</span><span class=\"p\">:</span><span class=\"mi\">43</span><span class=\"p\">:</span><span class=\"mf\">16.544655</span> <span class=\"o\">|</span> <span class=\"n\">Running</span> <span class=\"n\">command</span><span class=\"p\">:</span> <span class=\"n\">ssh</span> <span class=\"o\">-</span><span class=\"n\">T</span> <span class=\"o\">-</span><span class=\"n\">i</span> <span class=\"o\">~/.</span><span class=\"n\">ssh</span><span class=\"o\">/</span><span class=\"n\">sky</span><span class=\"o\">-</span><span class=\"n\">key</span> <span class=\"o\">-</span><span class=\"n\">o</span> <span class=\"n\">Port</span><span class=\"o\">=</span><span class=\"mi\">22</span> <span class=\"o\">-</span><span class=\"n\">o</span> <span class=\"n\">StrictHostKeyChecking</span><span class=\"o\">=</span><span class=\"n\">no</span> <span class=\"o\">-</span><span class=\"n\">o</span> <span class=\"n\">UserKnownHostsFile</span><span class=\"o\">=/</span><span class=\"n\">dev</span><span class=\"o\">/</span><span class=\"n\">null</span> <span class=\"o\">-</span><span class=\"n\">o</span> <span class=\"n\">IdentitiesOnly</span><span class=\"o\">=</span><span class=\"n\">yes</span> <span class=\"o\">-</span><span class=\"n\">o</span> <span class=\"n\">ExitOnForwardFailure</span><span class=\"o\">=</span><span class=\"n\">yes</span> <span class=\"o\">-</span><span class=\"n\">o</span> <span class=\"n\">ServerAliveInterval</span><span class=\"o\">=</span><span class=\"mi\">5</span> <span class=\"o\">-</span><span class=\"n\">o</span> <span class=\"n\">ServerAliveCountMax</span><span class=\"o\">=</span><span class=\"mi\">3</span> <span class=\"o\">-</span><span class=\"n\">o</span> <span class=\"n\">ConnectTimeout</span><span class=\"o\">=</span><span class=\"mi\">30</span><span class=\"n\">s</span> <span class=\"o\">-</span><span class=\"n\">o</span> <span class=\"n\">ForwardAgent</span><span class=\"o\">=</span><span class=\"n\">yes</span> <span class=\"o\">-</span><span class=\"n\">o</span> <span class=\"n\">ControlMaster</span><span class=\"o\">=</span><span class=\"n\">auto</span> <span class=\"o\">-</span><span class=\"n\">o</span> <span class=\"n\">ControlPath</span><span class=\"o\">=/</span><span class=\"n\">tmp</span><span class=\"o\">/</span><span class=\"n\">skypilot_ssh_caroline</span><span class=\"o\">/</span><span class=\"mi\">41014</span><span class=\"n\">bb4d3</span><span class=\"o\">/%</span><span class=\"n\">C</span> <span class=\"o\">-</span><span class=\"n\">o</span> <span class=\"n\">ControlPersist</span><span class=\"o\">=</span><span class=\"mi\">300</span><span class=\"n\">s</span> <span class=\"n\">ubuntu</span><span class=\"o\">@</span><span class=\"mf\">44.201.245.202</span> <span class=\"s1\">&#39;bash --login -c -i &#39;</span><span class=\"s2\">&quot;&#39;&quot;</span><span class=\"s1\">&#39;true &amp;&amp; source ~/.bashrc &amp;&amp; export OMP_NUM_THREADS=1 PYTHONWARNINGS=ignore &amp;&amp; (mkdir -p ~/runhouse/)&#39;</span><span class=\"s2\">&quot;&#39;&quot;</span><span class=\"s1\">&#39; 2&gt;&amp;1&#39;</span>\n<span class=\"n\">INFO</span> <span class=\"o\">|</span> <span class=\"mi\">2023</span><span class=\"o\">-</span><span class=\"mi\">12</span><span class=\"o\">-</span><span class=\"mi\">20</span> <span class=\"mi\">17</span><span class=\"p\">:</span><span class=\"mi\">43</span><span class=\"p\">:</span><span class=\"mf\">22.149570</span> <span class=\"o\">|</span> <span class=\"n\">Calling</span> <span class=\"n\">base_env</span><span class=\"o\">.</span><span class=\"n\">install</span>\n</pre></div>\n</div>\n<div class=\"code-output highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">base_env</span> <span class=\"n\">servlet</span><span class=\"p\">:</span> <span class=\"n\">Calling</span> <span class=\"n\">method</span> <span class=\"n\">install</span> <span class=\"n\">on</span> <span class=\"n\">module</span> <span class=\"n\">base_env</span>\n<span class=\"n\">Installing</span> <span class=\"n\">package</span><span class=\"p\">:</span> <span class=\"n\">Package</span><span class=\"p\">:</span> <span class=\"n\">runhouse</span>\n<span class=\"n\">Installing</span> <span class=\"n\">Package</span><span class=\"p\">:</span> <span class=\"n\">runhouse</span> <span class=\"k\">with</span> <span class=\"n\">method</span> <span class=\"n\">reqs</span><span class=\"o\">.</span>\n<span class=\"n\">reqs</span> <span class=\"n\">path</span><span class=\"p\">:</span> <span class=\"n\">runhouse</span><span class=\"o\">/</span><span class=\"n\">requirements</span><span class=\"o\">.</span><span class=\"n\">txt</span>\n<span class=\"n\">pip</span> <span class=\"n\">installing</span> <span class=\"n\">requirements</span> <span class=\"kn\">from</span><span class=\"w\"> </span><span class=\"nn\">runhouse</span><span class=\"o\">/</span><span class=\"n\">requirements</span><span class=\"o\">.</span><span class=\"n\">txt</span> <span class=\"k\">with</span><span class=\"p\">:</span> <span class=\"o\">-</span><span class=\"n\">r</span> <span class=\"n\">runhouse</span><span class=\"o\">/</span><span class=\"n\">requirements</span><span class=\"o\">.</span><span class=\"n\">txt</span>\n<span class=\"n\">Running</span><span class=\"p\">:</span> <span class=\"o\">/</span><span class=\"n\">opt</span><span class=\"o\">/</span><span class=\"n\">conda</span><span class=\"o\">/</span><span class=\"nb\">bin</span><span class=\"o\">/</span><span class=\"n\">python3</span><span class=\"mf\">.10</span> <span class=\"o\">-</span><span class=\"n\">m</span> <span class=\"n\">pip</span> <span class=\"n\">install</span> <span class=\"o\">-</span><span class=\"n\">r</span> <span class=\"n\">runhouse</span><span class=\"o\">/</span><span class=\"n\">requirements</span><span class=\"o\">.</span><span class=\"n\">txt</span>\n</pre></div>\n</div>\n<div class=\"code-output highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">INFO</span> <span class=\"o\">|</span> <span class=\"mi\">2023</span><span class=\"o\">-</span><span class=\"mi\">12</span><span class=\"o\">-</span><span class=\"mi\">20</span> <span class=\"mi\">17</span><span class=\"p\">:</span><span class=\"mi\">43</span><span class=\"p\">:</span><span class=\"mf\">26.164394</span> <span class=\"o\">|</span> <span class=\"n\">Time</span> <span class=\"n\">to</span> <span class=\"n\">call</span> <span class=\"n\">base_env</span><span class=\"o\">.</span><span class=\"n\">install</span><span class=\"p\">:</span> <span class=\"mf\">4.01</span> <span class=\"n\">seconds</span>\n<span class=\"n\">INFO</span> <span class=\"o\">|</span> <span class=\"mi\">2023</span><span class=\"o\">-</span><span class=\"mi\">12</span><span class=\"o\">-</span><span class=\"mi\">20</span> <span class=\"mi\">17</span><span class=\"p\">:</span><span class=\"mi\">43</span><span class=\"p\">:</span><span class=\"mf\">26.420370</span> <span class=\"o\">|</span> <span class=\"n\">Function</span> <span class=\"n\">setup</span> <span class=\"n\">complete</span><span class=\"o\">.</span>\n<span class=\"n\">INFO</span> <span class=\"o\">|</span> <span class=\"mi\">2023</span><span class=\"o\">-</span><span class=\"mi\">12</span><span class=\"o\">-</span><span class=\"mi\">20</span> <span class=\"mi\">17</span><span class=\"p\">:</span><span class=\"mi\">43</span><span class=\"p\">:</span><span class=\"mf\">26.427886</span> <span class=\"o\">|</span> <span class=\"n\">Calling</span> <span class=\"n\">_get_env_var</span><span class=\"o\">.</span><span class=\"n\">call</span>\n</pre></div>\n</div>\n<div class=\"code-output highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">base_env</span> <span class=\"n\">servlet</span><span class=\"p\">:</span> <span class=\"n\">Calling</span> <span class=\"n\">method</span> <span class=\"n\">call</span> <span class=\"n\">on</span> <span class=\"n\">module</span> <span class=\"n\">_get_env_var</span>\n</pre></div>\n</div>\n<div class=\"code-output highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">INFO</span> <span class=\"o\">|</span> <span class=\"mi\">2023</span><span class=\"o\">-</span><span class=\"mi\">12</span><span class=\"o\">-</span><span class=\"mi\">20</span> <span class=\"mi\">17</span><span class=\"p\">:</span><span class=\"mi\">43</span><span class=\"p\">:</span><span class=\"mf\">26.686193</span> <span class=\"o\">|</span> <span class=\"n\">Time</span> <span class=\"n\">to</span> <span class=\"n\">call</span> <span class=\"n\">_get_env_var</span><span class=\"o\">.</span><span class=\"n\">call</span><span class=\"p\">:</span> <span class=\"mf\">0.26</span> <span class=\"n\">seconds</span>\n</pre></div>\n</div>\n<div class=\"code-output highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"s1\">&#39;openai_key&#39;</span>\n</pre></div>\n</div>\n</section>\n<section id=\"cluster-sync-secrets\">\n<h3>cluster.sync_secrets()<a class=\"headerlink\" href=\"#cluster-sync-secrets\" title=\"Permalink to this heading\">\u00b6</a></h3>\n<p>You can pass in a list of secrets along with an env into\n<code class=\"docutils literal notranslate\"><span class=\"pre\">cluster.sync_secrets</span></code> to be synced over from local to a cluster. The\nlist can consist of secrets resources or the string corresponding to the\nprovider/name.</p>\n<div class=\"highlight-ipython3 notranslate\"><div class=\"highlight\"><pre><span></span>cluster.sync_secrets([&quot;aws&quot;, &quot;gcp&quot;, openai_secret])\n</pre></div>\n</div>\n<div class=\"code-output highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">INFO</span> <span class=\"o\">|</span> <span class=\"mi\">2023</span><span class=\"o\">-</span><span class=\"mi\">12</span><span class=\"o\">-</span><span class=\"mi\">20</span> <span class=\"mi\">17</span><span class=\"p\">:</span><span class=\"mi\">43</span><span class=\"p\">:</span><span class=\"mf\">32.041330</span> <span class=\"o\">|</span> <span class=\"n\">Calling</span> <span class=\"n\">aws</span><span class=\"o\">.</span><span class=\"n\">_write_to_file</span>\n</pre></div>\n</div>\n<div class=\"code-output highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">base</span> <span class=\"n\">servlet</span><span class=\"p\">:</span> <span class=\"n\">Calling</span> <span class=\"n\">method</span> <span class=\"n\">_write_to_file</span> <span class=\"n\">on</span> <span class=\"n\">module</span> <span class=\"n\">aws</span>\n<span class=\"n\">Secrets</span> <span class=\"n\">already</span> <span class=\"n\">exist</span> <span class=\"ow\">in</span> <span class=\"o\">~/.</span><span class=\"n\">aws</span><span class=\"o\">/</span><span class=\"n\">credentials</span><span class=\"o\">.</span>\n</pre></div>\n</div>\n<div class=\"code-output highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">INFO</span> <span class=\"o\">|</span> <span class=\"mi\">2023</span><span class=\"o\">-</span><span class=\"mi\">12</span><span class=\"o\">-</span><span class=\"mi\">20</span> <span class=\"mi\">17</span><span class=\"p\">:</span><span class=\"mi\">43</span><span class=\"p\">:</span><span class=\"mf\">32.293934</span> <span class=\"o\">|</span> <span class=\"n\">Time</span> <span class=\"n\">to</span> <span class=\"n\">call</span> <span class=\"n\">aws</span><span class=\"o\">.</span><span class=\"n\">_write_to_file</span><span class=\"p\">:</span> <span class=\"mf\">0.25</span> <span class=\"n\">seconds</span>\n<span class=\"n\">INFO</span> <span class=\"o\">|</span> <span class=\"mi\">2023</span><span class=\"o\">-</span><span class=\"mi\">12</span><span class=\"o\">-</span><span class=\"mi\">20</span> <span class=\"mi\">17</span><span class=\"p\">:</span><span class=\"mi\">43</span><span class=\"p\">:</span><span class=\"mf\">32.676000</span> <span class=\"o\">|</span> <span class=\"n\">Calling</span> <span class=\"n\">gcp</span><span class=\"o\">.</span><span class=\"n\">_write_to_file</span>\n</pre></div>\n</div>\n<div class=\"code-output highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">base</span> <span class=\"n\">servlet</span><span class=\"p\">:</span> <span class=\"n\">Calling</span> <span class=\"n\">method</span> <span class=\"n\">_write_to_file</span> <span class=\"n\">on</span> <span class=\"n\">module</span> <span class=\"n\">gcp</span>\n<span class=\"n\">Secrets</span> <span class=\"n\">already</span> <span class=\"n\">exist</span> <span class=\"ow\">in</span> <span class=\"o\">~/.</span><span class=\"n\">config</span><span class=\"o\">/</span><span class=\"n\">gcloud</span><span class=\"o\">/</span><span class=\"n\">application_default_credentials</span><span class=\"o\">.</span><span class=\"n\">json</span><span class=\"o\">.</span>\n</pre></div>\n</div>\n<div class=\"code-output highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">INFO</span> <span class=\"o\">|</span> <span class=\"mi\">2023</span><span class=\"o\">-</span><span class=\"mi\">12</span><span class=\"o\">-</span><span class=\"mi\">20</span> <span class=\"mi\">17</span><span class=\"p\">:</span><span class=\"mi\">43</span><span class=\"p\">:</span><span class=\"mf\">32.936027</span> <span class=\"o\">|</span> <span class=\"n\">Time</span> <span class=\"n\">to</span> <span class=\"n\">call</span> <span class=\"n\">gcp</span><span class=\"o\">.</span><span class=\"n\">_write_to_file</span><span class=\"p\">:</span> <span class=\"mf\">0.26</span> <span class=\"n\">seconds</span>\n<span class=\"n\">INFO</span> <span class=\"o\">|</span> <span class=\"mi\">2023</span><span class=\"o\">-</span><span class=\"mi\">12</span><span class=\"o\">-</span><span class=\"mi\">20</span> <span class=\"mi\">17</span><span class=\"p\">:</span><span class=\"mi\">43</span><span class=\"p\">:</span><span class=\"mf\">33.315656</span> <span class=\"o\">|</span> <span class=\"n\">Getting</span> <span class=\"kc\">None</span>\n<span class=\"n\">INFO</span> <span class=\"o\">|</span> <span class=\"mi\">2023</span><span class=\"o\">-</span><span class=\"mi\">12</span><span class=\"o\">-</span><span class=\"mi\">20</span> <span class=\"mi\">17</span><span class=\"p\">:</span><span class=\"mi\">43</span><span class=\"p\">:</span><span class=\"mf\">33.551578</span> <span class=\"o\">|</span> <span class=\"n\">Calling</span> <span class=\"n\">env_20231220_174256</span><span class=\"o\">.</span><span class=\"n\">_set_env_vars</span>\n</pre></div>\n</div>\n<div class=\"code-output highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">base</span> <span class=\"n\">servlet</span><span class=\"p\">:</span> <span class=\"n\">Calling</span> <span class=\"n\">method</span> <span class=\"n\">_set_env_vars</span> <span class=\"n\">on</span> <span class=\"n\">module</span> <span class=\"n\">env_20231220_174256</span>\n</pre></div>\n</div>\n<div class=\"code-output highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">INFO</span> <span class=\"o\">|</span> <span class=\"mi\">2023</span><span class=\"o\">-</span><span class=\"mi\">12</span><span class=\"o\">-</span><span class=\"mi\">20</span> <span class=\"mi\">17</span><span class=\"p\">:</span><span class=\"mi\">43</span><span class=\"p\">:</span><span class=\"mf\">33.790339</span> <span class=\"o\">|</span> <span class=\"n\">Time</span> <span class=\"n\">to</span> <span class=\"n\">call</span> <span class=\"n\">env_20231220_174256</span><span class=\"o\">.</span><span class=\"n\">_set_env_vars</span><span class=\"p\">:</span> <span class=\"mf\">0.24</span> <span class=\"n\">seconds</span>\n</pre></div>\n</div>\n</section>\n<section id=\"rh-env\">\n<h3>rh.env<a class=\"headerlink\" href=\"#rh-env\" title=\"Permalink to this heading\">\u00b6</a></h3>\n<p>You can also include a list of secrets in a Runhouse env object. When\nthe env is then sent to a cluster, as part of a function or directly,\nthe secrets will be synced onto the environment as well, and accessible\nfrom function and system calls running in the environment.</p>\n<div class=\"highlight-ipython3 notranslate\"><div class=\"highlight\"><pre><span></span>secrets_env = rh.env(secrets=[&quot;aws&quot;, openai_secret])\n\nget_env_var = rh.function(_get_env_var, system=cluster, env=secrets_env)\nget_env_var(&quot;OPENAI_API_KEY&quot;)\n</pre></div>\n</div>\n<div class=\"code-output highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">INFO</span> <span class=\"o\">|</span> <span class=\"mi\">2023</span><span class=\"o\">-</span><span class=\"mi\">12</span><span class=\"o\">-</span><span class=\"mi\">20</span> <span class=\"mi\">17</span><span class=\"p\">:</span><span class=\"mi\">48</span><span class=\"p\">:</span><span class=\"mf\">29.631094</span> <span class=\"o\">|</span> <span class=\"n\">Because</span> <span class=\"n\">this</span> <span class=\"n\">function</span> <span class=\"ow\">is</span> <span class=\"n\">defined</span> <span class=\"ow\">in</span> <span class=\"n\">a</span> <span class=\"n\">notebook</span><span class=\"p\">,</span> <span class=\"n\">writing</span> <span class=\"n\">it</span> <span class=\"n\">out</span> <span class=\"n\">to</span> <span class=\"n\">a</span> <span class=\"n\">file</span> <span class=\"n\">to</span> <span class=\"n\">make</span> <span class=\"n\">it</span> <span class=\"n\">importable</span><span class=\"o\">.</span> <span class=\"n\">Please</span> <span class=\"n\">make</span> <span class=\"n\">sure</span> <span class=\"n\">the</span> <span class=\"n\">function</span> <span class=\"n\">does</span> <span class=\"ow\">not</span> <span class=\"n\">rely</span> <span class=\"n\">on</span> <span class=\"nb\">any</span> <span class=\"n\">local</span> <span class=\"n\">variables</span><span class=\"p\">,</span> <span class=\"n\">including</span> <span class=\"n\">imports</span> <span class=\"p\">(</span><span class=\"n\">which</span> <span class=\"n\">should</span> <span class=\"n\">be</span> <span class=\"n\">moved</span> <span class=\"n\">inside</span> <span class=\"n\">the</span> <span class=\"n\">function</span> <span class=\"n\">body</span><span class=\"p\">)</span><span class=\"o\">.</span> <span class=\"n\">Functions</span> <span class=\"n\">defined</span> <span class=\"ow\">in</span> <span class=\"n\">Python</span> <span class=\"n\">files</span> <span class=\"n\">can</span> <span class=\"n\">be</span> <span class=\"n\">used</span> <span class=\"n\">normally</span><span class=\"o\">.</span>\n<span class=\"n\">INFO</span> <span class=\"o\">|</span> <span class=\"mi\">2023</span><span class=\"o\">-</span><span class=\"mi\">12</span><span class=\"o\">-</span><span class=\"mi\">20</span> <span class=\"mi\">17</span><span class=\"p\">:</span><span class=\"mi\">48</span><span class=\"p\">:</span><span class=\"mf\">29.662722</span> <span class=\"o\">|</span> <span class=\"n\">Setting</span> <span class=\"n\">up</span> <span class=\"n\">Function</span> <span class=\"n\">on</span> <span class=\"n\">cluster</span><span class=\"o\">.</span>\n<span class=\"n\">INFO</span> <span class=\"o\">|</span> <span class=\"mi\">2023</span><span class=\"o\">-</span><span class=\"mi\">12</span><span class=\"o\">-</span><span class=\"mi\">20</span> <span class=\"mi\">17</span><span class=\"p\">:</span><span class=\"mi\">48</span><span class=\"p\">:</span><span class=\"mf\">29.664560</span> <span class=\"o\">|</span> <span class=\"n\">Copying</span> <span class=\"n\">package</span> <span class=\"kn\">from</span><span class=\"w\"> </span><span class=\"nn\">file</span><span class=\"p\">:</span><span class=\"o\">///</span><span class=\"n\">Users</span><span class=\"o\">/</span><span class=\"n\">caroline</span><span class=\"o\">/</span><span class=\"n\">Documents</span><span class=\"o\">/</span><span class=\"n\">runhouse</span><span class=\"o\">/</span><span class=\"n\">runhouse</span> <span class=\"n\">to</span><span class=\"p\">:</span> <span class=\"n\">example</span><span class=\"o\">-</span><span class=\"n\">cluster</span>\n<span class=\"n\">INFO</span> <span class=\"o\">|</span> <span class=\"mi\">2023</span><span class=\"o\">-</span><span class=\"mi\">12</span><span class=\"o\">-</span><span class=\"mi\">20</span> <span class=\"mi\">17</span><span class=\"p\">:</span><span class=\"mi\">48</span><span class=\"p\">:</span><span class=\"mf\">29.665912</span> <span class=\"o\">|</span> <span class=\"n\">Running</span> <span class=\"n\">command</span><span class=\"p\">:</span> <span class=\"n\">ssh</span> <span class=\"o\">-</span><span class=\"n\">T</span> <span class=\"o\">-</span><span class=\"n\">i</span> <span class=\"o\">~/.</span><span class=\"n\">ssh</span><span class=\"o\">/</span><span class=\"n\">sky</span><span class=\"o\">-</span><span class=\"n\">key</span> <span class=\"o\">-</span><span class=\"n\">o</span> <span class=\"n\">Port</span><span class=\"o\">=</span><span class=\"mi\">22</span> <span class=\"o\">-</span><span class=\"n\">o</span> <span class=\"n\">StrictHostKeyChecking</span><span class=\"o\">=</span><span class=\"n\">no</span> <span class=\"o\">-</span><span class=\"n\">o</span> <span class=\"n\">UserKnownHostsFile</span><span class=\"o\">=/</span><span class=\"n\">dev</span><span class=\"o\">/</span><span class=\"n\">null</span> <span class=\"o\">-</span><span class=\"n\">o</span> <span class=\"n\">IdentitiesOnly</span><span class=\"o\">=</span><span class=\"n\">yes</span> <span class=\"o\">-</span><span class=\"n\">o</span> <span class=\"n\">ExitOnForwardFailure</span><span class=\"o\">=</span><span class=\"n\">yes</span> <span class=\"o\">-</span><span class=\"n\">o</span> <span class=\"n\">ServerAliveInterval</span><span class=\"o\">=</span><span class=\"mi\">5</span> <span class=\"o\">-</span><span class=\"n\">o</span> <span class=\"n\">ServerAliveCountMax</span><span class=\"o\">=</span><span class=\"mi\">3</span> <span class=\"o\">-</span><span class=\"n\">o</span> <span class=\"n\">ConnectTimeout</span><span class=\"o\">=</span><span class=\"mi\">30</span><span class=\"n\">s</span> <span class=\"o\">-</span><span class=\"n\">o</span> <span class=\"n\">ForwardAgent</span><span class=\"o\">=</span><span class=\"n\">yes</span> <span class=\"o\">-</span><span class=\"n\">o</span> <span class=\"n\">ControlMaster</span><span class=\"o\">=</span><span class=\"n\">auto</span> <span class=\"o\">-</span><span class=\"n\">o</span> <span class=\"n\">ControlPath</span><span class=\"o\">=/</span><span class=\"n\">tmp</span><span class=\"o\">/</span><span class=\"n\">skypilot_ssh_caroline</span><span class=\"o\">/</span><span class=\"mi\">41014</span><span class=\"n\">bb4d3</span><span class=\"o\">/%</span><span class=\"n\">C</span> <span class=\"o\">-</span><span class=\"n\">o</span> <span class=\"n\">ControlPersist</span><span class=\"o\">=</span><span class=\"mi\">300</span><span class=\"n\">s</span> <span class=\"n\">ubuntu</span><span class=\"o\">@</span><span class=\"mf\">44.201.245.202</span> <span class=\"s1\">&#39;bash --login -c -i &#39;</span><span class=\"s2\">&quot;&#39;&quot;</span><span class=\"s1\">&#39;true &amp;&amp; source ~/.bashrc &amp;&amp; export OMP_NUM_THREADS=1 PYTHONWARNINGS=ignore &amp;&amp; (mkdir -p ~/runhouse/)&#39;</span><span class=\"s2\">&quot;&#39;&quot;</span><span class=\"s1\">&#39; 2&gt;&amp;1&#39;</span>\n<span class=\"n\">INFO</span> <span class=\"o\">|</span> <span class=\"mi\">2023</span><span class=\"o\">-</span><span class=\"mi\">12</span><span class=\"o\">-</span><span class=\"mi\">20</span> <span class=\"mi\">17</span><span class=\"p\">:</span><span class=\"mi\">48</span><span class=\"p\">:</span><span class=\"mf\">31.562203</span> <span class=\"o\">|</span> <span class=\"n\">Calling</span> <span class=\"n\">aws</span><span class=\"o\">.</span><span class=\"n\">_write_to_file</span>\n</pre></div>\n</div>\n<div class=\"code-output highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">base</span> <span class=\"n\">servlet</span><span class=\"p\">:</span> <span class=\"n\">Calling</span> <span class=\"n\">method</span> <span class=\"n\">_write_to_file</span> <span class=\"n\">on</span> <span class=\"n\">module</span> <span class=\"n\">aws</span>\n<span class=\"n\">Secrets</span> <span class=\"n\">already</span> <span class=\"n\">exist</span> <span class=\"ow\">in</span> <span class=\"o\">~/.</span><span class=\"n\">aws</span><span class=\"o\">/</span><span class=\"n\">credentials</span><span class=\"o\">.</span>\n</pre></div>\n</div>\n<div class=\"code-output highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">INFO</span> <span class=\"o\">|</span> <span class=\"mi\">2023</span><span class=\"o\">-</span><span class=\"mi\">12</span><span class=\"o\">-</span><span class=\"mi\">20</span> <span class=\"mi\">17</span><span class=\"p\">:</span><span class=\"mi\">48</span><span class=\"p\">:</span><span class=\"mf\">31.783056</span> <span class=\"o\">|</span> <span class=\"n\">Time</span> <span class=\"n\">to</span> <span class=\"n\">call</span> <span class=\"n\">aws</span><span class=\"o\">.</span><span class=\"n\">_write_to_file</span><span class=\"p\">:</span> <span class=\"mf\">0.22</span> <span class=\"n\">seconds</span>\n<span class=\"n\">INFO</span> <span class=\"o\">|</span> <span class=\"mi\">2023</span><span class=\"o\">-</span><span class=\"mi\">12</span><span class=\"o\">-</span><span class=\"mi\">20</span> <span class=\"mi\">17</span><span class=\"p\">:</span><span class=\"mi\">48</span><span class=\"p\">:</span><span class=\"mf\">32.119017</span> <span class=\"o\">|</span> <span class=\"n\">Getting</span> <span class=\"n\">base_env</span>\n<span class=\"n\">INFO</span> <span class=\"o\">|</span> <span class=\"mi\">2023</span><span class=\"o\">-</span><span class=\"mi\">12</span><span class=\"o\">-</span><span class=\"mi\">20</span> <span class=\"mi\">17</span><span class=\"p\">:</span><span class=\"mi\">48</span><span class=\"p\">:</span><span class=\"mf\">32.227256</span> <span class=\"o\">|</span> <span class=\"n\">Time</span> <span class=\"n\">to</span> <span class=\"n\">get</span> <span class=\"n\">base_env</span><span class=\"p\">:</span> <span class=\"mf\">0.11</span> <span class=\"n\">seconds</span>\n<span class=\"n\">INFO</span> <span class=\"o\">|</span> <span class=\"mi\">2023</span><span class=\"o\">-</span><span class=\"mi\">12</span><span class=\"o\">-</span><span class=\"mi\">20</span> <span class=\"mi\">17</span><span class=\"p\">:</span><span class=\"mi\">48</span><span class=\"p\">:</span><span class=\"mf\">32.229612</span> <span class=\"o\">|</span> <span class=\"n\">Calling</span> <span class=\"n\">base_env</span><span class=\"o\">.</span><span class=\"n\">_set_env_vars</span>\n</pre></div>\n</div>\n<div class=\"code-output highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">base_env</span> <span class=\"n\">servlet</span><span class=\"p\">:</span> <span class=\"n\">Calling</span> <span class=\"n\">method</span> <span class=\"n\">_set_env_vars</span> <span class=\"n\">on</span> <span class=\"n\">module</span> <span class=\"n\">base_env</span>\n</pre></div>\n</div>\n<div class=\"code-output highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">INFO</span> <span class=\"o\">|</span> <span class=\"mi\">2023</span><span class=\"o\">-</span><span class=\"mi\">12</span><span class=\"o\">-</span><span class=\"mi\">20</span> <span class=\"mi\">17</span><span class=\"p\">:</span><span class=\"mi\">48</span><span class=\"p\">:</span><span class=\"mf\">32.474858</span> <span class=\"o\">|</span> <span class=\"n\">Time</span> <span class=\"n\">to</span> <span class=\"n\">call</span> <span class=\"n\">base_env</span><span class=\"o\">.</span><span class=\"n\">_set_env_vars</span><span class=\"p\">:</span> <span class=\"mf\">0.25</span> <span class=\"n\">seconds</span>\n<span class=\"n\">INFO</span> <span class=\"o\">|</span> <span class=\"mi\">2023</span><span class=\"o\">-</span><span class=\"mi\">12</span><span class=\"o\">-</span><span class=\"mi\">20</span> <span class=\"mi\">17</span><span class=\"p\">:</span><span class=\"mi\">48</span><span class=\"p\">:</span><span class=\"mf\">32.678774</span> <span class=\"o\">|</span> <span class=\"n\">Calling</span> <span class=\"n\">base_env</span><span class=\"o\">.</span><span class=\"n\">install</span>\n</pre></div>\n</div>\n<div class=\"code-output highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">base_env</span> <span class=\"n\">servlet</span><span class=\"p\">:</span> <span class=\"n\">Calling</span> <span class=\"n\">method</span> <span class=\"n\">install</span> <span class=\"n\">on</span> <span class=\"n\">module</span> <span class=\"n\">base_env</span>\n<span class=\"n\">Env</span> <span class=\"n\">already</span> <span class=\"n\">installed</span><span class=\"p\">,</span> <span class=\"n\">skipping</span>\n</pre></div>\n</div>\n<div class=\"code-output highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">INFO</span> <span class=\"o\">|</span> <span class=\"mi\">2023</span><span class=\"o\">-</span><span class=\"mi\">12</span><span class=\"o\">-</span><span class=\"mi\">20</span> <span class=\"mi\">17</span><span class=\"p\">:</span><span class=\"mi\">48</span><span class=\"p\">:</span><span class=\"mf\">32.917056</span> <span class=\"o\">|</span> <span class=\"n\">Time</span> <span class=\"n\">to</span> <span class=\"n\">call</span> <span class=\"n\">base_env</span><span class=\"o\">.</span><span class=\"n\">install</span><span class=\"p\">:</span> <span class=\"mf\">0.24</span> <span class=\"n\">seconds</span>\n<span class=\"n\">INFO</span> <span class=\"o\">|</span> <span class=\"mi\">2023</span><span class=\"o\">-</span><span class=\"mi\">12</span><span class=\"o\">-</span><span class=\"mi\">20</span> <span class=\"mi\">17</span><span class=\"p\">:</span><span class=\"mi\">48</span><span class=\"p\">:</span><span class=\"mf\">33.114583</span> <span class=\"o\">|</span> <span class=\"n\">Function</span> <span class=\"n\">setup</span> <span class=\"n\">complete</span><span class=\"o\">.</span>\n<span class=\"n\">INFO</span> <span class=\"o\">|</span> <span class=\"mi\">2023</span><span class=\"o\">-</span><span class=\"mi\">12</span><span class=\"o\">-</span><span class=\"mi\">20</span> <span class=\"mi\">17</span><span class=\"p\">:</span><span class=\"mi\">48</span><span class=\"p\">:</span><span class=\"mf\">33.122322</span> <span class=\"o\">|</span> <span class=\"n\">Calling</span> <span class=\"n\">_get_env_var</span><span class=\"o\">.</span><span class=\"n\">call</span>\n</pre></div>\n</div>\n<div class=\"code-output highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">base_env</span> <span class=\"n\">servlet</span><span class=\"p\">:</span> <span class=\"n\">Calling</span> <span class=\"n\">method</span> <span class=\"n\">call</span> <span class=\"n\">on</span> <span class=\"n\">module</span> <span class=\"n\">_get_env_var</span>\n</pre></div>\n</div>\n<div class=\"code-output highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">INFO</span> <span class=\"o\">|</span> <span class=\"mi\">2023</span><span class=\"o\">-</span><span class=\"mi\">12</span><span class=\"o\">-</span><span class=\"mi\">20</span> <span class=\"mi\">17</span><span class=\"p\">:</span><span class=\"mi\">48</span><span class=\"p\">:</span><span class=\"mf\">33.352872</span> <span class=\"o\">|</span> <span class=\"n\">Time</span> <span class=\"n\">to</span> <span class=\"n\">call</span> <span class=\"n\">_get_env_var</span><span class=\"o\">.</span><span class=\"n\">call</span><span class=\"p\">:</span> <span class=\"mf\">0.23</span> <span class=\"n\">seconds</span>\n</pre></div>\n</div>\n<div class=\"code-output highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"s1\">&#39;openai_key&#39;</span>\n</pre></div>\n</div>\n</section>\n</section>\n<section id=\"saving-and-loading-secrets\">\n<h2>Saving and Loading Secrets<a class=\"headerlink\" href=\"#saving-and-loading-secrets\" title=\"Permalink to this heading\">\u00b6</a></h2>\n<p>You can save a secret using the <code class=\"docutils literal notranslate\"><span class=\"pre\">.save()</span></code> API, and reload a saved\nsecret by calling <code class=\"docutils literal notranslate\"><span class=\"pre\">rh.secret(&lt;name&gt;)</span></code>.</p>\n<p>If you are not logged in to your Runhouse account, the secret config\nwill be saved locally.</p>\n<p>If you have a Runhouse account, which you can create\n<a class=\"reference external\" href=\"https://www.run.house/login\">here</a> or by calling either the\n<code class=\"docutils literal notranslate\"><span class=\"pre\">runhouse</span> <span class=\"pre\">login</span></code> CLI command or <code class=\"docutils literal notranslate\"><span class=\"pre\">rh.login()</span></code> Python command, calling\n<code class=\"docutils literal notranslate\"><span class=\"pre\">.save()</span></code> will save the resource metadata on Runhouse servers, and the\nsecret values to Hashicorp Vault.</p>\n<section id=\"local-secret\">\n<h3>Local Secret<a class=\"headerlink\" href=\"#local-secret\" title=\"Permalink to this heading\">\u00b6</a></h3>\n<div class=\"highlight-ipython3 notranslate\"><div class=\"highlight\"><pre><span></span>local_secret = rh.provider_secret(provider=&quot;lambda&quot;, name=&quot;lambda_key&quot;)\nlocal_secret.save()\ndel local_secret\n</pre></div>\n</div>\n<div class=\"code-output highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">INFO</span> <span class=\"o\">|</span> <span class=\"mi\">2023</span><span class=\"o\">-</span><span class=\"mi\">12</span><span class=\"o\">-</span><span class=\"mi\">20</span> <span class=\"mi\">06</span><span class=\"p\">:</span><span class=\"mi\">03</span><span class=\"p\">:</span><span class=\"mf\">31.257864</span> <span class=\"o\">|</span> <span class=\"n\">Saving</span> <span class=\"n\">config</span> <span class=\"k\">for</span> <span class=\"o\">~/</span><span class=\"n\">lambda_key</span> <span class=\"n\">to</span><span class=\"p\">:</span> <span class=\"o\">/</span><span class=\"n\">Users</span><span class=\"o\">/</span><span class=\"n\">caroline</span><span class=\"o\">/.</span><span class=\"n\">rh</span><span class=\"o\">/</span><span class=\"n\">secrets</span><span class=\"o\">/</span><span class=\"n\">lambda_key</span><span class=\"o\">.</span><span class=\"n\">json</span>\n</pre></div>\n</div>\n<div class=\"highlight-ipython3 notranslate\"><div class=\"highlight\"><pre><span></span>reloaded_secret = rh.provider_secret(&quot;lambda_key&quot;)\nreloaded_secret.values\n</pre></div>\n</div>\n<div class=\"code-output highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">INFO</span> <span class=\"o\">|</span> <span class=\"mi\">2023</span><span class=\"o\">-</span><span class=\"mi\">12</span><span class=\"o\">-</span><span class=\"mi\">20</span> <span class=\"mi\">06</span><span class=\"p\">:</span><span class=\"mi\">03</span><span class=\"p\">:</span><span class=\"mf\">46.371170</span> <span class=\"o\">|</span> <span class=\"n\">Loading</span> <span class=\"n\">config</span> <span class=\"kn\">from</span><span class=\"w\"> </span><span class=\"nn\">local</span> <span class=\"n\">file</span> <span class=\"o\">/</span><span class=\"n\">Users</span><span class=\"o\">/</span><span class=\"n\">caroline</span><span class=\"o\">/.</span><span class=\"n\">rh</span><span class=\"o\">/</span><span class=\"n\">secrets</span><span class=\"o\">/</span><span class=\"n\">lambda_key</span><span class=\"o\">.</span><span class=\"n\">json</span>\n</pre></div>\n</div>\n<div class=\"code-output highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"p\">{</span><span class=\"s1\">&#39;api_key&#39;</span><span class=\"p\">:</span> <span class=\"s1\">&#39;lambda_key&#39;</span><span class=\"p\">}</span>\n</pre></div>\n</div>\n</section>\n<section id=\"den-secret\">\n<h3>Den Secret<a class=\"headerlink\" href=\"#den-secret\" title=\"Permalink to this heading\">\u00b6</a></h3>\n<p>If you have a Runhouse account, which you can create\n<a class=\"reference external\" href=\"https://www.run.house/login\">here</a> or by calling either the\n<code class=\"docutils literal notranslate\"><span class=\"pre\">runhouse</span> <span class=\"pre\">login</span></code> CLI command or <code class=\"docutils literal notranslate\"><span class=\"pre\">rh.login()</span></code> Python command, you can\nsave secret to your dashboard. The metadata for the Secret resource,\nsuch as the provider, any path or env vars, etc, will be saved into\nRunhouse Den servers, while the secrets values themselves will be stored\nsecurely in Hashicorp Vault.</p>\n<div class=\"highlight-ipython3 notranslate\"><div class=\"highlight\"><pre><span></span>! runhouse login\n</pre></div>\n</div>\n<div class=\"highlight-ipython3 notranslate\"><div class=\"highlight\"><pre><span></span>rh.provider_secret(&quot;gcp&quot;, name=&quot;gcp_secret&quot;).save()\n</pre></div>\n</div>\n<div class=\"code-output highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">INFO</span> <span class=\"o\">|</span> <span class=\"mi\">2023</span><span class=\"o\">-</span><span class=\"mi\">12</span><span class=\"o\">-</span><span class=\"mi\">20</span> <span class=\"mi\">06</span><span class=\"p\">:</span><span class=\"mi\">09</span><span class=\"p\">:</span><span class=\"mf\">17.712653</span> <span class=\"o\">|</span> <span class=\"n\">Saving</span> <span class=\"n\">config</span> <span class=\"k\">for</span> <span class=\"n\">gcp_secret</span> <span class=\"n\">to</span> <span class=\"n\">Den</span>\n<span class=\"n\">INFO</span> <span class=\"o\">|</span> <span class=\"mi\">2023</span><span class=\"o\">-</span><span class=\"mi\">12</span><span class=\"o\">-</span><span class=\"mi\">20</span> <span class=\"mi\">06</span><span class=\"p\">:</span><span class=\"mi\">09</span><span class=\"p\">:</span><span class=\"mf\">18.184111</span> <span class=\"o\">|</span> <span class=\"n\">Saving</span> <span class=\"n\">secrets</span> <span class=\"k\">for</span> <span class=\"n\">gcp_secret</span> <span class=\"n\">to</span> <span class=\"n\">Vault</span>\n</pre></div>\n</div>\n<div class=\"code-output highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"o\">&lt;</span><span class=\"n\">runhouse</span><span class=\"o\">.</span><span class=\"n\">resources</span><span class=\"o\">.</span><span class=\"n\">secrets</span><span class=\"o\">.</span><span class=\"n\">provider_secrets</span><span class=\"o\">.</span><span class=\"n\">gcp_secret</span><span class=\"o\">.</span><span class=\"n\">GCPSecret</span> <span class=\"n\">at</span> <span class=\"mh\">0x1650c7fd0</span><span class=\"o\">&gt;</span>\n</pre></div>\n</div>\n<div class=\"highlight-ipython3 notranslate\"><div class=\"highlight\"><pre><span></span>rh.provider_secret(&quot;gcp_secret&quot;)\n</pre></div>\n</div>\n<div class=\"code-output highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"o\">&lt;</span><span class=\"n\">runhouse</span><span class=\"o\">.</span><span class=\"n\">resources</span><span class=\"o\">.</span><span class=\"n\">secrets</span><span class=\"o\">.</span><span class=\"n\">provider_secrets</span><span class=\"o\">.</span><span class=\"n\">provider_secret</span><span class=\"o\">.</span><span class=\"n\">ProviderSecret</span> <span class=\"n\">at</span> <span class=\"mh\">0x10545efd0</span><span class=\"o\">&gt;</span>\n</pre></div>\n</div>\n</section>\n<section id=\"login-and-logout\">\n<h3>Login and Logout<a class=\"headerlink\" href=\"#login-and-logout\" title=\"Permalink to this heading\">\u00b6</a></h3>\n<p>The login flow gives you the option to upload locally detected builtin\nprovider secrets, or load down saved-down Vault secrets into your local\nenvironment. If loading down new secrets, the location (file or env var)\nof the new secrets will be logged in your runhouse config yaml at\n<code class=\"docutils literal notranslate\"><span class=\"pre\">~/.rh/config.yaml</span></code> as well. There are some useful APIs as well for\nseeing which secrets you have locally configured or stored in Vault.</p>\n<div class=\"highlight-ipython3 notranslate\"><div class=\"highlight\"><pre><span></span>runhouse.login(upload_secrets=True, download_secrets=True)\n\n# or, on CLI:\n# runhouse login --sync-secrets\n</pre></div>\n</div>\n<div class=\"highlight-ipython3 notranslate\"><div class=\"highlight\"><pre><span></span># list of my locally configured secrets\nlocally_configued_secrets = rh.Secret.extract_provider_secrets()\nlocally_configued_secrets\n</pre></div>\n</div>\n<div class=\"code-output highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"p\">{</span><span class=\"s1\">&#39;aws&#39;</span><span class=\"p\">:</span> <span class=\"o\">&lt;</span><span class=\"n\">runhouse</span><span class=\"o\">.</span><span class=\"n\">resources</span><span class=\"o\">.</span><span class=\"n\">secrets</span><span class=\"o\">.</span><span class=\"n\">provider_secrets</span><span class=\"o\">.</span><span class=\"n\">aws_secret</span><span class=\"o\">.</span><span class=\"n\">AWSSecret</span> <span class=\"n\">at</span> <span class=\"mh\">0x1631ccd90</span><span class=\"o\">&gt;</span><span class=\"p\">,</span>\n <span class=\"s1\">&#39;gcp&#39;</span><span class=\"p\">:</span> <span class=\"o\">&lt;</span><span class=\"n\">runhouse</span><span class=\"o\">.</span><span class=\"n\">resources</span><span class=\"o\">.</span><span class=\"n\">secrets</span><span class=\"o\">.</span><span class=\"n\">provider_secrets</span><span class=\"o\">.</span><span class=\"n\">gcp_secret</span><span class=\"o\">.</span><span class=\"n\">GCPSecret</span> <span class=\"n\">at</span> <span class=\"mh\">0x105f16fd0</span><span class=\"o\">&gt;</span><span class=\"p\">,</span>\n <span class=\"s1\">&#39;github&#39;</span><span class=\"p\">:</span> <span class=\"o\">&lt;</span><span class=\"n\">runhouse</span><span class=\"o\">.</span><span class=\"n\">resources</span><span class=\"o\">.</span><span class=\"n\">secrets</span><span class=\"o\">.</span><span class=\"n\">provider_secrets</span><span class=\"o\">.</span><span class=\"n\">github_secret</span><span class=\"o\">.</span><span class=\"n\">GitHubSecret</span> <span class=\"n\">at</span> <span class=\"mh\">0x1631c3d60</span><span class=\"o\">&gt;</span><span class=\"p\">,</span>\n <span class=\"s1\">&#39;lambda&#39;</span><span class=\"p\">:</span> <span class=\"o\">&lt;</span><span class=\"n\">runhouse</span><span class=\"o\">.</span><span class=\"n\">resources</span><span class=\"o\">.</span><span class=\"n\">secrets</span><span class=\"o\">.</span><span class=\"n\">provider_secrets</span><span class=\"o\">.</span><span class=\"n\">lambda_secret</span><span class=\"o\">.</span><span class=\"n\">LambdaSecret</span> <span class=\"n\">at</span> <span class=\"mh\">0x1631c3ac0</span><span class=\"o\">&gt;</span><span class=\"p\">,</span>\n <span class=\"s1\">&#39;sky&#39;</span><span class=\"p\">:</span> <span class=\"o\">&lt;</span><span class=\"n\">runhouse</span><span class=\"o\">.</span><span class=\"n\">resources</span><span class=\"o\">.</span><span class=\"n\">secrets</span><span class=\"o\">.</span><span class=\"n\">provider_secrets</span><span class=\"o\">.</span><span class=\"n\">sky_secret</span><span class=\"o\">.</span><span class=\"n\">SkySecret</span> <span class=\"n\">at</span> <span class=\"mh\">0x1631c3850</span><span class=\"o\">&gt;</span><span class=\"p\">,</span>\n <span class=\"s1\">&#39;ssh-sagemaker-ssh-gw&#39;</span><span class=\"p\">:</span> <span class=\"o\">&lt;</span><span class=\"n\">runhouse</span><span class=\"o\">.</span><span class=\"n\">resources</span><span class=\"o\">.</span><span class=\"n\">secrets</span><span class=\"o\">.</span><span class=\"n\">provider_secrets</span><span class=\"o\">.</span><span class=\"n\">ssh_secret</span><span class=\"o\">.</span><span class=\"n\">SSHSecret</span> <span class=\"n\">at</span> <span class=\"mh\">0x105f495e0</span><span class=\"o\">&gt;</span><span class=\"p\">,</span>\n <span class=\"s1\">&#39;ssh-id_rsa&#39;</span><span class=\"p\">:</span> <span class=\"o\">&lt;</span><span class=\"n\">runhouse</span><span class=\"o\">.</span><span class=\"n\">resources</span><span class=\"o\">.</span><span class=\"n\">secrets</span><span class=\"o\">.</span><span class=\"n\">provider_secrets</span><span class=\"o\">.</span><span class=\"n\">ssh_secret</span><span class=\"o\">.</span><span class=\"n\">SSHSecret</span> <span class=\"n\">at</span> <span class=\"mh\">0x105f49190</span><span class=\"o\">&gt;</span><span class=\"p\">,</span>\n <span class=\"s1\">&#39;ssh-id_rsa_tmp&#39;</span><span class=\"p\">:</span> <span class=\"o\">&lt;</span><span class=\"n\">runhouse</span><span class=\"o\">.</span><span class=\"n\">resources</span><span class=\"o\">.</span><span class=\"n\">secrets</span><span class=\"o\">.</span><span class=\"n\">provider_secrets</span><span class=\"o\">.</span><span class=\"n\">ssh_secret</span><span class=\"o\">.</span><span class=\"n\">SSHSecret</span> <span class=\"n\">at</span> <span class=\"mh\">0x105f492e0</span><span class=\"o\">&gt;</span><span class=\"p\">}</span>\n</pre></div>\n</div>\n<div class=\"highlight-ipython3 notranslate\"><div class=\"highlight\"><pre><span></span># if previously logged in and saved secrets to vault, can load down the secrets\nvault_secrets = rh.Secret.vault_secrets()\nvault_secrets\n</pre></div>\n</div>\n<div class=\"code-output highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"p\">[</span><span class=\"s1\">&#39;aws&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;gcp&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;github&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;huggingface&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;lambda&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;ssh-id_rsa&#39;</span><span class=\"p\">]</span>\n</pre></div>\n</div>\n<p>To save a secret to Vault, simply call <code class=\"docutils literal notranslate\"><span class=\"pre\">.save()</span></code> on the resource. This\nwill save both the values themselves, and relevant metadata such as the\npath where it is locally stored.</p>\n<p>You can manually construct and save a resource, or iterate through one\nof the lists above.</p>\n<div class=\"highlight-ipython3 notranslate\"><div class=\"highlight\"><pre><span></span>aws_secret_custom.save()\nlocally_configued_secrets[&quot;gcp&quot;].save()\n</pre></div>\n</div>\n<div class=\"code-output highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">INFO</span> <span class=\"o\">|</span> <span class=\"mi\">2023</span><span class=\"o\">-</span><span class=\"mi\">12</span><span class=\"o\">-</span><span class=\"mi\">11</span> <span class=\"mi\">17</span><span class=\"p\">:</span><span class=\"mi\">50</span><span class=\"p\">:</span><span class=\"mf\">58.715913</span> <span class=\"o\">|</span> <span class=\"n\">Saving</span> <span class=\"n\">config</span> <span class=\"k\">for</span> <span class=\"n\">aws</span> <span class=\"n\">to</span> <span class=\"n\">Den</span>\n<span class=\"n\">INFO</span> <span class=\"o\">|</span> <span class=\"mi\">2023</span><span class=\"o\">-</span><span class=\"mi\">12</span><span class=\"o\">-</span><span class=\"mi\">11</span> <span class=\"mi\">17</span><span class=\"p\">:</span><span class=\"mi\">50</span><span class=\"p\">:</span><span class=\"mf\">58.748314</span> <span class=\"o\">|</span> <span class=\"n\">Saving</span> <span class=\"n\">secrets</span> <span class=\"k\">for</span> <span class=\"n\">aws</span> <span class=\"n\">to</span> <span class=\"n\">Vault</span>\n<span class=\"n\">INFO</span> <span class=\"o\">|</span> <span class=\"mi\">2023</span><span class=\"o\">-</span><span class=\"mi\">12</span><span class=\"o\">-</span><span class=\"mi\">11</span> <span class=\"mi\">17</span><span class=\"p\">:</span><span class=\"mi\">50</span><span class=\"p\">:</span><span class=\"mf\">59.565812</span> <span class=\"o\">|</span> <span class=\"n\">Saving</span> <span class=\"n\">config</span> <span class=\"k\">for</span> <span class=\"n\">gcp</span> <span class=\"n\">to</span> <span class=\"n\">Den</span>\n<span class=\"n\">INFO</span> <span class=\"o\">|</span> <span class=\"mi\">2023</span><span class=\"o\">-</span><span class=\"mi\">12</span><span class=\"o\">-</span><span class=\"mi\">11</span> <span class=\"mi\">17</span><span class=\"p\">:</span><span class=\"mi\">50</span><span class=\"p\">:</span><span class=\"mf\">59.597261</span> <span class=\"o\">|</span> <span class=\"n\">Saving</span> <span class=\"n\">secrets</span> <span class=\"k\">for</span> <span class=\"n\">gcp</span> <span class=\"n\">to</span> <span class=\"n\">Vault</span>\n</pre></div>\n</div>\n<p>Logout will prompt you one by one the secrets that have been saved\nlocally, whether or not you\u2019d like to remove the associated file or env\nvars.</p>\n<div class=\"highlight-ipython3 notranslate\"><div class=\"highlight\"><pre><span></span>rh.logout()\n</pre></div>\n</div>\n<div class=\"code-output highlight-default notranslate\"><div class=\"highlight\"><pre><span></span>Delete credentials in [&#39;ANTHROPIC_API_KEY&#39;] for anthropic? [y/N]:\n</pre></div>\n</div>\n<div class=\"code-output highlight-default notranslate\"><div class=\"highlight\"><pre><span></span>Delete your local Runhouse config file? [y/N]:\n</pre></div>\n</div>\n<div class=\"code-output highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">INFO</span> <span class=\"o\">|</span> <span class=\"mi\">2023</span><span class=\"o\">-</span><span class=\"mi\">12</span><span class=\"o\">-</span><span class=\"mi\">20</span> <span class=\"mi\">17</span><span class=\"p\">:</span><span class=\"mi\">56</span><span class=\"p\">:</span><span class=\"mf\">54.337915</span> <span class=\"o\">|</span> <span class=\"n\">Successfully</span> <span class=\"n\">logged</span> <span class=\"n\">out</span> <span class=\"n\">of</span> <span class=\"n\">Runhouse</span><span class=\"o\">.</span>\n</pre></div>\n</div>\n</section>\n</section>\n</section>\n\n    <script type=\"text/x-thebe-config\">\n    {\n        requestKernel: true,\n        binderOptions: {\n            repo: \"binder-examples/jupyter-stacks-datascience\",\n            ref: \"master\",\n        },\n        codeMirrorConfig: {\n            theme: \"abcdef\",\n            mode: \"python\"\n        },\n        kernelOptions: {\n            name: \"python3\",\n            path: \"./tutorials\"\n        },\n        predefinedOutput: true\n    }\n    </script>\n    <script>kernelName = 'python3'</script>", "metatags": "<meta name=\"generator\" content=\"Docutils 0.19: https://docutils.sourceforge.io/\" />\n", "rellinks": [["genindex", "General Index", "I", "index"], ["tutorials/api-resources", "Resource Management", "N", "next"], ["tutorials/api-folders", "Folders", "P", "previous"]], "sourcename": "tutorials/api-secrets.rst.txt", "toc": "<ul>\n<li><a class=\"reference internal\" href=\"#\">Secrets</a><ul>\n<li><a class=\"reference internal\" href=\"#constructing-secrets\">Constructing Secrets</a><ul>\n<li><a class=\"reference internal\" href=\"#base-secret\">Base Secret</a></li>\n<li><a class=\"reference internal\" href=\"#provider-secret\">Provider Secret</a><ul>\n<li><a class=\"reference internal\" href=\"#compute-providers\">Compute Providers</a></li>\n<li><a class=\"reference internal\" href=\"#api-keys\">API Keys</a></li>\n<li><a class=\"reference internal\" href=\"#ssh-keys\">SSH Keys</a></li>\n</ul>\n</li>\n</ul>\n</li>\n<li><a class=\"reference internal\" href=\"#sending-secrets\">Sending Secrets</a><ul>\n<li><a class=\"reference internal\" href=\"#secret-to-system-env\"><code class=\"docutils literal notranslate\"><span class=\"pre\">secret.to(system,</span> <span class=\"pre\">env)</span></code></a></li>\n<li><a class=\"reference internal\" href=\"#cluster-sync-secrets\">cluster.sync_secrets()</a></li>\n<li><a class=\"reference internal\" href=\"#rh-env\">rh.env</a></li>\n</ul>\n</li>\n<li><a class=\"reference internal\" href=\"#saving-and-loading-secrets\">Saving and Loading Secrets</a><ul>\n<li><a class=\"reference internal\" href=\"#local-secret\">Local Secret</a></li>\n<li><a class=\"reference internal\" href=\"#den-secret\">Den Secret</a></li>\n<li><a class=\"reference internal\" href=\"#login-and-logout\">Login and Logout</a></li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n", "display_toc": true, "page_source_suffix": ".rst", "globaltoc": "<p class=\"caption\" role=\"heading\"><span class=\"caption-text\">Getting Started</span></p>\n<ul>\n<li class=\"toctree-l1\"><a class=\"reference internal\" href=\"tutorials/quick-start-cloud/\">Quick Start</a></li>\n<li class=\"toctree-l1\"><a class=\"reference internal\" href=\"tutorials/quick-start-den/\">Den Quick Start</a></li>\n<li class=\"toctree-l1\"><a class=\"reference internal\" href=\"how-to-use-runhouse/\">How to Use Runhouse</a></li>\n<li class=\"toctree-l1\"><a class=\"reference internal\" href=\"runhouse-in-your-stack/\">Working with Common Libraries and Tools</a></li>\n</ul>\n<p class=\"caption\" role=\"heading\"><span class=\"caption-text\">API Basics</span></p>\n<ul>\n<li class=\"toctree-l1\"><a class=\"reference internal\" href=\"tutorials/api-clusters/\">Clusters</a></li>\n<li class=\"toctree-l1\"><a class=\"reference internal\" href=\"tutorials/api-modules/\">Functions and Modules</a></li>\n<li class=\"toctree-l1\"><a class=\"reference internal\" href=\"tutorials/api-process/\">Processes</a></li>\n<li class=\"toctree-l1\"><a class=\"reference internal\" href=\"tutorials/api-images/\">Images</a></li>\n<li class=\"toctree-l1\"><a class=\"reference internal\" href=\"tutorials/api-folders/\">Folders</a></li>\n<li class=\"toctree-l1\"><a class=\"reference internal\" href=\"tutorials/api-secrets/\">Secrets</a></li>\n<li class=\"toctree-l1\"><a class=\"reference internal\" href=\"tutorials/api-resources/\">Resource Management</a></li>\n</ul>\n<p class=\"caption\" role=\"heading\"><span class=\"caption-text\">API Reference</span></p>\n<ul>\n<li class=\"toctree-l1\"><a class=\"reference internal\" href=\"api/python/\">Python API</a><ul>\n<li class=\"toctree-l2\"><a class=\"reference internal\" href=\"api/python/resource/\">Resource</a></li>\n<li class=\"toctree-l2\"><a class=\"reference internal\" href=\"api/python/function/\">Function</a></li>\n<li class=\"toctree-l2\"><a class=\"reference internal\" href=\"api/python/cluster/\">Cluster</a></li>\n<li class=\"toctree-l2\"><a class=\"reference internal\" href=\"api/python/image/\">Image</a></li>\n<li class=\"toctree-l2\"><a class=\"reference internal\" href=\"api/python/package/\">Package</a></li>\n<li class=\"toctree-l2\"><a class=\"reference internal\" href=\"api/python/module/\">Module</a></li>\n<li class=\"toctree-l2\"><a class=\"reference internal\" href=\"api/python/folder/\">Folder</a></li>\n<li class=\"toctree-l2\"><a class=\"reference internal\" href=\"api/python/secrets/\">Secrets</a></li>\n<li class=\"toctree-l2\"><a class=\"reference internal\" href=\"api/python/login/\">Login/Logout</a></li>\n</ul>\n</li>\n<li class=\"toctree-l1\"><a class=\"reference internal\" href=\"api/cli/\">Command Line Interface</a></li>\n</ul>\n<p class=\"caption\" role=\"heading\"><span class=\"caption-text\">Other Topics</span></p>\n<ul>\n<li class=\"toctree-l1\"><a class=\"reference internal\" href=\"tutorials/async/\">Asynchronous Programming</a></li>\n<li class=\"toctree-l1\"><a class=\"reference internal\" href=\"installation/\">Installation and Setup</a></li>\n<li class=\"toctree-l1\"><a class=\"reference internal\" href=\"debugging-logging/\">Debugging and Logging</a></li>\n<li class=\"toctree-l1\"><a class=\"reference internal\" href=\"docker-setup/\">Docker: Cluster Setup</a></li>\n<li class=\"toctree-l1\"><a class=\"reference internal\" href=\"docker-workflows/\">Docker: Dev and Prod Workflows with Runhouse</a></li>\n<li class=\"toctree-l1\"><a class=\"reference internal\" href=\"security-and-authentication/\">Security and Authentication</a></li>\n</ul>\n", "current_page_name": "tutorials/api-secrets", "sidebars": ["about.html", "navigation.html", "relations.html", "searchbox.html", "donate.html"], "customsidebar": null, "alabaster_version": "0.7.16", "alabaster_version_info": [0, 7, 16]}